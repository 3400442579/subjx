/*@license
* Drag/Rotate/Resize Library
* Released under the MIT license, 2018-2020
* Karen Sarksyan
* nichollascarter@gmail.com
*/
"use strict";const requestAnimFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||function(e){return setTimeout(e,1e3/60)},cancelAnimFrame=window.cancelAnimationFrame||window.mozCancelAnimationFrame||function(e){clearTimeout(e)},{forEach:forEach,slice:arrSlice,map:arrMap,reduce:arrReduce}=Array.prototype,{warn:warn}=console,isDef=e=>null!=e,isUndef=e=>null==e,isFunc=e=>"function"==typeof e,createMethod=e=>isFunc(e)?function(){e.call(this,...arguments)}:()=>{};class Helper{constructor(e){if("string"==typeof e){const t=document.querySelectorAll(e);this.length=t.length;for(let e=0;e<this.length;e++)this[e]=t[e]}else if("object"!=typeof e||1!==e.nodeType&&e!==document)if(e instanceof Helper){this.length=e.length;for(let t=0;t<this.length;t++)this[t]=e[t]}else{if(!isIterable(e))throw new Error("Passed parameter must be selector/element/elementArray");this.length=0;for(let t=0;t<this.length;t++)1===e.nodeType&&(this[t]=e[t],this.length++)}else this[0]=e,this.length=1}css(e){const t={setStyle(e){return((e,t)=>{let s=e.length;for(;s--;)for(const o in t)e[s].style[o]=t[o];return e.style})(this,e)},getStyle(){return(t=>{let s=t.length;for(;s--;)return t[s].currentStyle?t[s].currentStyle[e]:document.defaultView&&document.defaultView.getComputedStyle?document.defaultView.getComputedStyle(t[s],"")[e]:t[s].style[e]})(this)}};return"string"==typeof e?t.getStyle.apply(this,arrSlice.call(arguments,1)):"object"!=typeof e&&e?(warn(`Method ${e} does not exist`),!1):t.setStyle.apply(this,arguments)}on(){let e=this.length;for(;e--;)this[e].events||(this[e].events={},this[e].events[arguments[0]]=[]),"string"!=typeof arguments[1]?document.addEventListener?this[e].addEventListener(arguments[0],arguments[1],arguments[2]||{passive:!1}):document.attachEvent?this[e].attachEvent(`on${arguments[0]}`,arguments[1]):this[e][`on${arguments[0]}`]=arguments[1]:listenerDelegate(this[e],arguments[0],arguments[1],arguments[2],arguments[3],!0);return this}off(){let e=this.length;for(;e--;)this[e].events||(this[e].events={},this[e].events[arguments[0]]=[]),"string"!=typeof arguments[1]?document.removeEventListener?this[e].removeEventListener(arguments[0],arguments[1],arguments[2]):document.detachEvent?this[e].detachEvent(`on${arguments[0]}`,arguments[1]):this[e][`on${arguments[0]}`]=null:listenerDelegate(this[e],arguments[0],arguments[1],arguments[2],arguments[3],!1);return this}is(e){if(isUndef(e))return!1;const t=helper(e);let s=this.length;for(;s--;)if(this[s]===t[s])return!0;return!1}}function listenerDelegate(e,t,s,o,r,n){const i=function(e){let t=e.target;for(;t&&t!==this;)t.matches(s)&&o.call(t,e),t=t.parentNode};!0===n?document.addEventListener?e.addEventListener(t,i,r||{passive:!1}):document.attachEvent?e.attachEvent(`on${t}`,i):e[`on${t}`]=i:document.removeEventListener?e.removeEventListener(t,i,r||{passive:!1}):document.detachEvent?e.detachEvent(`on${t}`,i):e[`on${t}`]=null}function isIterable(e){return isDef(e)&&"object"==typeof e&&(Array.isArray(e)||isDef(window.Symbol)&&"function"==typeof e[window.Symbol.iterator]||isDef(e.forEach)||"number"==typeof e.length&&(0===e.length||e.length>0&&e.length-1 in e))}function helper(e){return new Helper(e)}class Observable{constructor(){this.observers={}}subscribe(e,t){const s=this.observers;return isUndef(s[e])&&Object.defineProperty(s,e,{value:[]}),s[e].push(t),this}unsubscribe(e,t){const s=this.observers;if(isDef(s[e])){const o=s[e].indexOf(t);s[e].splice(o,1)}return this}notify(e,t,s){isUndef(this.observers[e])||this.observers[e].forEach(o=>{if(t!==o)switch(e){case"onmove":o.notifyMove(s);break;case"onrotate":o.notifyRotate(s);break;case"onresize":o.notifyResize(s);break;case"onapply":o.notifyApply(s);break;case"ongetstate":o.notifyGetState(s)}})}}class Event{constructor(e){this.name=e,this.callbacks=[]}registerCallback(e){this.callbacks.push(e)}removeCallback(e){const t=this.callbacks(e);this.callbacks.splice(t,1)}}class EventDispatcher{constructor(){this.events={}}registerEvent(e){this.events[e]=new Event(e)}emit(e,t,s){this.events[t].callbacks.forEach(t=>{t.call(e,s)})}addEventListener(e,t){this.events[e].registerCallback(t)}removeEventListener(e,t){this.events[e].removeCallback(t)}}class SubjectModel{constructor(e){this.el=e,this.storage=null,this.proxyMethods=null,this.eventDispatcher=new EventDispatcher,this._onMouseDown=this._onMouseDown.bind(this),this._onTouchStart=this._onTouchStart.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this._onTouchMove=this._onTouchMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._onTouchEnd=this._onTouchEnd.bind(this),this._animate=this._animate.bind(this)}enable(e){this._processOptions(e),this._init(this.el),this.proxyMethods.onInit.call(this,this.el)}disable(){throwNotImplementedError()}_init(){throwNotImplementedError()}_destroy(){throwNotImplementedError()}_processOptions(){throwNotImplementedError()}_start(){throwNotImplementedError()}_moving(){throwNotImplementedError()}_end(){throwNotImplementedError()}_animate(){throwNotImplementedError()}_drag({dx:e,dy:t,...s}){const o={dx:e,dy:t,transform:this._processMove(e,t),...s};this.proxyMethods.onMove.call(this,o),this._emitEvent("drag",o)}_draw(){this._animate()}_onMouseDown(e){this._start(e),helper(document).on("mousemove",this._onMouseMove).on("mouseup",this._onMouseUp)}_onTouchStart(e){this._start(e.touches[0]),helper(document).on("touchmove",this._onTouchMove).on("touchend",this._onTouchEnd)}_onMouseMove(e){e.preventDefault&&e.preventDefault(),this._moving(e,this.el)}_onTouchMove(e){e.preventDefault&&e.preventDefault(),this._moving(e.touches[0],this.el)}_onMouseUp(e){helper(document).off("mousemove",this._onMouseMove).off("mouseup",this._onMouseUp),this._end(e,this.el)}_onTouchEnd(e){helper(document).off("touchmove",this._onTouchMove).off("touchend",this._onTouchEnd),0===e.touches.length&&this._end(e.changedTouches[0],this.el)}_emitEvent(){this.eventDispatcher.emit(this,...arguments)}on(e,t){return this.eventDispatcher.addEventListener(e,t),this}off(e,t){return this.eventDispatcher.removeEventListener(e,t),this}}const throwNotImplementedError=()=>{throw Error("Method not implemented")},EVENTS=["dragStart","drag","dragEnd","resizeStart","resize","resizeEnd","rotateStart","rotate","rotateEnd","setPointStart","setPointEnd"],snapToGrid=(e,t)=>{if(0===t)return e;{const s=snapCandidate(e,t);if(s-e<t)return s}},snapCandidate=(e,t)=>0===t?e:Math.round(e/t)*t,floatToFixed=(e,t=6)=>Number(e.toFixed(t)),getOffset=e=>e.getBoundingClientRect(),getTransform=e=>{return e.css("-webkit-transform")||e.css("-moz-transform")||e.css("-ms-transform")||e.css("-o-transform")||e.css("transform")||"none"},parseMatrix=e=>{const t=e.match(/[+\-]?(?:0|[1-9]\d*)(?:\.\d*)?(?:[eE][+\-]?\d+)?/g);return t?t.map(e=>parseFloat(e)):[1,0,0,1,0,0]},addClass=(e,t)=>{if(t){if(e.classList){if(!(t.indexOf(" ")>-1))return e.classList.add(t);t.split(/\s+/).forEach(t=>e.classList.add(t))}return e}},removeClass=(e,t)=>{if(t){if(e.classList){if(!(t.indexOf(" ")>-1))return e.classList.remove(t);t.split(/\s+/).forEach(t=>e.classList.remove(t))}return e}},matrixToCSS=e=>{const t=`matrix(${e.join()})`;return{transform:t,webkitTranform:t,mozTransform:t,msTransform:t,otransform:t}};class Transformable extends SubjectModel{constructor(e,t,s){if(super(e),this.constructor===Transformable)throw new TypeError("Cannot construct Transformable instances directly");this.observable=s,EVENTS.forEach(e=>{this.eventDispatcher.registerEvent(e)}),this.enable(t)}_cursorPoint(){throw Error("'_cursorPoint()' method not implemented")}_resize({dx:e,dy:t,...s}){const o={...this._processResize(e,t),dx:e,dy:t,...s};this.proxyMethods.onResize.call(this,o),this._emitEvent("resize",o)}_processOptions(e){const{el:t}=this;addClass(t,"sjx-drag");const s={x:10,y:10},o={move:!1,resize:!1};let r=null,n=!1,i="xy",a="auto",l="auto",c=!0,h=!0,d=null,u=null,f=null,p=()=>{},m=()=>{},v=()=>{},g=()=>{},x=()=>{},b=t.parentNode;if(isDef(e)){const{snap:y,each:_,axis:E,cursorMove:M,cursorResize:w,restrict:D,draggable:T,resizable:j,onInit:z,onDrop:S,onMove:C,onResize:N,onDestroy:X,container:Y,proportions:O,custom:F,resizeHandles:R,className:L}=e;if(isDef(y)){const{x:e,y:t}=y;s.x=isUndef(e)?10:e,s.y=isUndef(t)?10:t}if(isDef(_)){const{move:e,resize:t}=_;o.move=e||!1,o.resize=t||!1}isDef(D)&&(r="parent"===D?t.parentNode:helper(D)[0]||document),a=M||"auto",l=w||"auto",i=E||"xy",b=isDef(Y)&&helper(Y)[0]?helper(Y)[0]:b,n=O||!1,c=!isDef(T)||T,h=!isDef(j)||j,d="object"==typeof F&&F||null,u=isDef(R)?R:null,f=isDef(L)?L:null,p=createMethod(z),g=createMethod(S),m=createMethod(C),v=createMethod(N),x=createMethod(X)}this.options={axis:i,cursorMove:a,cursorResize:l,restrict:r,container:b,snap:s,each:o,proportions:n,draggable:c,resizable:h,custom:d,resizeHandles:u,className:f},this.proxyMethods={onInit:p,onDrop:g,onMove:m,onResize:v,onDestroy:x},this.subscribe(o)}_animate(){const e=this,{observable:t,storage:s,options:o}=e;if(isUndef(s))return;if(s.frame=requestAnimFrame(e._animate),!s.doDraw)return;s.doDraw=!1;let{dox:r,doy:n,clientX:i,clientY:a,doDrag:l,doResize:c,revX:h,revY:d}=s;const{snap:u,each:{move:f,resize:p},restrict:m,draggable:v,resizable:g}=o;if(c&&g){const{transform:o,cx:l,cy:c}=s,{x:f,y:m}=this._pointToElement({x:i,y:a});let v=r?snapToGrid(f-l,u.x/o.scX):0,g=n?snapToGrid(m-c,u.y/o.scY):0;const x={dx:v=r?h?-v:v:0,dy:g=n?d?-g:g:0,clientX:i,clientY:a};e._resize(x),p&&t.notify("onresize",e,x)}if(l&&v){const{restrictOffset:o,elementOffset:l,nx:c,ny:h}=s;if(isDef(m)){const{left:e,top:t}=o,{left:s,top:r,width:n,height:d}=l,u=c-i,f=h-a,p=m.clientWidth-n,v=m.clientHeight-d,g=r-t,x=s-e;g-f<0&&(a=h-r+t),x-u<0&&(i=c-s+e),g-f>v&&(a=v+(h-r+t)),x-u>p&&(i=p+(c-s+e))}const d={dx:r?snapToGrid(i-c,u.x):0,dy:n?snapToGrid(a-h,u.y):0,clientX:i,clientY:a};e._drag(d),f&&t.notify("onmove",e,d)}}_start(e){const{observable:t,storage:s,options:{axis:o,restrict:r,each:n},el:i}=this,a=this._compute(e);Object.keys(a).forEach(e=>{s[e]=a[e]});const{onRightEdge:l,onBottomEdge:c,onTopEdge:h,onLeftEdge:d,handle:u,factor:f,revX:p,revY:m,doW:v,doH:g}=a,x=l||c||h||d,{handles:b}=s,{radius:y}=b;isDef(y)&&removeClass(y,"sjx-hidden");const _=!x,{clientX:E,clientY:M}=e,{x:w,y:D}=this._cursorPoint({clientX:E,clientY:M}),{x:T,y:j}=this._pointToElement({x:w,y:D}),{x:z,y:S}=this._pointToControls({x:w,y:D}),C={clientX:E,clientY:M,nx:w,ny:D,cx:T,cy:j,bx:z,by:S,doResize:x,doDrag:_,onExecution:!0,cursor:null,elementOffset:getOffset(i),restrictOffset:isDef(r)?getOffset(r):null,dox:/\x/.test(o)&&(!x||(u.is(b.ml)||u.is(b.mr)||u.is(b.tl)||u.is(b.tr)||u.is(b.bl)||u.is(b.br))),doy:/\y/.test(o)&&(!x||(u.is(b.br)||u.is(b.bl)||u.is(b.bc)||u.is(b.tr)||u.is(b.tl)||u.is(b.tc)))};this.storage={...s,...C};const N={clientX:E,clientY:M};x?this._emitEvent("resizeStart",N):_&&this._emitEvent("dragStart",N);const{move:X,resize:Y}=n,O=x?"resize":"drag",F=x&&Y||_&&X;t.notify("ongetstate",this,{clientX:E,clientY:M,actionName:O,triggerEvent:F,factor:f,revX:p,revY:m,doW:v,doH:g}),this._draw()}_moving(e){const{storage:t,options:s}=this,{x:o,y:r}=this._cursorPoint(e);t.e=e,t.clientX=o,t.clientY=r,t.doDraw=!0;let{doDrag:n,doResize:i,cursor:a}=t;const{cursorMove:l,cursorResize:c}=s;isUndef(a)&&(n?a=l:i&&(a=c),helper(document.body).css({cursor:a}))}_end({clientX:e,clientY:t}){const{options:{each:s},observable:o,storage:r,proxyMethods:n}=this,{doResize:i,doDrag:a,frame:l,handles:{radius:c}}=r,h=i?"resize":"drag";r.doResize=!1,r.doDrag=!1,r.doSetCenter=!1,r.doDraw=!1,r.onExecution=!1,r.cursor=null,this._apply(h);const d={clientX:e,clientY:t};n.onDrop.call(this,d),i?this._emitEvent("resizeEnd",d):a&&this._emitEvent("dragEnd",d);const{move:u,resize:f}=s,p=i&&f||a&&u;o.notify("onapply",this,{clientX:e,clientY:t,actionName:h,triggerEvent:p}),cancelAnimFrame(l),helper(document.body).css({cursor:"auto"}),isDef(c)&&addClass(c,"sjx-hidden")}_compute(e){const{handles:t}=this.storage,s=helper(e.target),{revX:o,revY:r,doW:n,doH:i,...a}=this._checkHandles(s,t),l=this._getState({revX:o,revY:r,doW:n,doH:i}),{x:c,y:h}=this._cursorPoint(e),d=Math.atan2(h-l.center.y,c-l.center.x);return{...l,...a,handle:s,pressang:d}}_checkHandles(e,t){const{tl:s,tc:o,tr:r,bl:n,br:i,bc:a,ml:l,mr:c}=t,h=!!isDef(s)&&e.is(s),d=!!isDef(o)&&e.is(o),u=!!isDef(r)&&e.is(r),f=!!isDef(n)&&e.is(n),p=!!isDef(a)&&e.is(a),m=!!isDef(i)&&e.is(i),v=!!isDef(l)&&e.is(l),g=!!isDef(c)&&e.is(c);return{revX:h||v||f||d,revY:h||u||d||v,onTopEdge:d||u||h,onLeftEdge:h||v||f,onRightEdge:u||g||m,onBottomEdge:m||p||f,doW:v||g,doH:d||p}}notifyMove(){this._drag(...arguments)}notifyResize(){this._resize(...arguments)}notifyApply({clientX:e,clientY:t,actionName:s,triggerEvent:o}){this.proxyMethods.onDrop.call(this,{clientX:e,clientY:t}),o&&(this._apply(s),this._emitEvent(`${s}End`,{clientX:e,clientY:t}))}notifyGetState({clientX:e,clientY:t,actionName:s,triggerEvent:o,...r}){if(o){const o=this._getState(r);this.storage={...this.storage,...o},this._emitEvent(`${s}Start`,{clientX:e,clientY:t})}}subscribe({resize:e,move:t}){const{observable:s}=this;(t||e)&&s.subscribe("ongetstate",this).subscribe("onapply",this),t&&s.subscribe("onmove",this),e&&s.subscribe("onresize",this)}unsubscribe(){const{observable:e}=this;e.unsubscribe("ongetstate",this).unsubscribe("onapply",this).unsubscribe("onmove",this).unsubscribe("onresize",this)}disable(){const{storage:e,proxyMethods:t,el:s}=this;isUndef(e)||(e.onExecution&&(this._end(),helper(document).off("mousemove",this._onMouseMove).off("mouseup",this._onMouseUp).off("touchmove",this._onTouchMove).off("touchend",this._onTouchEnd)),removeClass(s,"sjx-drag"),this._destroy(),this.unsubscribe(),t.onDestroy.call(this,s),delete this.storage)}exeDrag({dx:e,dy:t}){const{draggable:s}=this.options;s&&(this.storage={...this.storage,...this._getState({revX:!1,revY:!1,doW:!1,doH:!1})},this._drag({dx:e,dy:t}),this._apply("drag"))}exeResize({dx:e,dy:t,revX:s,revY:o,doW:r,doH:n}){const{resizable:i}=this.options;i&&(this.storage={...this.storage,...this._getState({revX:s||!1,revY:o||!1,doW:r||!1,doH:n||!1})},this._resize({dx:e,dy:t}),this._apply("resize"))}}const matrixTransform=({x:e,y:t},s)=>{const[o,r,n,i,a,l]=s;return{x:o*e+n*t+a,y:r*e+i*t+l}},matrixInvert=e=>{const t=[[e[0],e[2],e[4]],[e[1],e[3],e[5]],[0,0,1]];if(t.length!==t[0].length)return;const s=t.length,o=[],r=[];for(let e=0;e<s;e+=1){o[o.length]=[],r[r.length]=[];for(let n=0;n<s;n+=1)o[e][n]=e==n?1:0,r[e][n]=t[e][n]}for(let e=0;e<s;e+=1){let t=r[e][e];if(0===t){for(let n=e+1;n<s;n+=1)if(0!==r[n][e]){for(let i=0;i<s;i++)t=r[e][i],r[e][i]=r[n][i],r[n][i]=t,t=o[e][i],o[e][i]=o[n][i],o[n][i]=t;break}if(0===(t=r[e][e]))return}for(let n=0;n<s;n++)r[e][n]=r[e][n]/t,o[e][n]=o[e][n]/t;for(let n=0;n<s;n++)if(n!=e){t=r[n][e];for(let i=0;i<s;i++)r[n][i]-=t*r[e][i],o[n][i]-=t*o[e][i]}}return[o[0][0],o[1][0],o[0][1],o[1][1],o[0][2],o[1][2]]},multiplyMatrix=([e,t,s,o,r,n],[i,a,l,c,h,d])=>{const u=[[e,s,r],[t,o,n],[0,0,1]],f=[[i,l,h],[a,c,d],[0,0,1]],p=[];for(let e=0;e<f.length;e++){p[e]=[];for(let t=0;t<u[0].length;t++){let s=0;for(let o=0;o<u.length;o++)s+=u[o][t]*f[e][o];p[e].push(s)}}return[p[0][0],p[1][0],p[0][1],p[1][1],p[0][2],p[1][2]]},rotatedTopLeft=(e,t,s,o,r,n,i,a,l)=>{const c=parseFloat(s)/2,h=parseFloat(o)/2,d=e+c,u=t+h,f=e-d,p=t-u,m=Math.atan2(a?0:p,l?0:f)+r,v=Math.sqrt(Math.pow(l?0:c,2)+Math.pow(a?0:h,2));let g=Math.cos(m),x=Math.sin(m);const b=u+v*(x=!0===i?-x:x);return{left:floatToFixed(d+v*(g=!0===n?-g:g)),top:floatToFixed(b)}},MIN_SIZE=2,CENTER_DELTA=7;class Draggable extends Transformable{_init(e){const{container:t,resizable:s,resizeHandles:o,className:r}=this.options,{left:n,top:i,width:a,height:l}=e.style,c=document.createElement("div");addClass(c,"sjx-wrapper"),isDef(r)&&addClass(c,r),t.appendChild(c);const h=helper(e),d=a||h.css("width"),u=l||h.css("height"),f={top:i||h.css("top"),left:n||h.css("left"),width:d,height:u,transform:getTransform(h)},p=document.createElement("div");addClass(p,"sjx-controls");const m={...s&&{tl:["sjx-hdl","sjx-hdl-t","sjx-hdl-l","sjx-hdl-tl"],tr:["sjx-hdl","sjx-hdl-t","sjx-hdl-r","sjx-hdl-tr"],br:["sjx-hdl","sjx-hdl-b","sjx-hdl-r","sjx-hdl-br"],bl:["sjx-hdl","sjx-hdl-b","sjx-hdl-l","sjx-hdl-bl"],tc:["sjx-hdl","sjx-hdl-t","sjx-hdl-c","sjx-hdl-tc"],bc:["sjx-hdl","sjx-hdl-b","sjx-hdl-c","sjx-hdl-bc"],ml:["sjx-hdl","sjx-hdl-m","sjx-hdl-l","sjx-hdl-ml"],mr:["sjx-hdl","sjx-hdl-m","sjx-hdl-r","sjx-hdl-mr"]}};if(Object.keys(m).forEach(e=>{const t=o[e];if(isDef(t)&&0==t)return;const s=m[e];if(isUndef(s))return;const r=createHandler(s);m[e]=r,p.appendChild(r)}),isDef(m.center)){helper(m.center).css({left:`${e.getAttribute("data-cx")}px`,top:`${e.getAttribute("data-cy")}px`})}c.appendChild(p);const v=helper(p);v.css(f),this.storage={controls:p,handles:m,radius:void 0,parent:e.parentNode},v.on("mousedown",this._onMouseDown).on("touchstart",this._onTouchStart)}_destroy(){const{controls:e}=this.storage;helper(e).off("mousedown",this._onMouseDown).off("touchstart",this._onTouchStart);const t=e.parentNode;t.parentNode.removeChild(t)}_pointToElement({x:e,y:t}){const{transform:s}=this.storage,o=[...s.matrix];return o[4]=o[5]=0,this._applyMatrixToPoint(matrixInvert(o),e,t)}_pointToControls(e){return this._pointToElement(e)}_applyMatrixToPoint(e,t,s){return matrixTransform({x:t,y:s},e)}_cursorPoint({clientX:e,clientY:t}){const{container:s}=this.options,o=parseMatrix(getTransform(helper(s)));return matrixTransform({x:e,y:t},matrixInvert(o))}_apply(){const{el:e,storage:t}=this,{controls:s,handles:o}=t,r=helper(s),n=parseFloat(r.css("width"))/2,i=parseFloat(r.css("height"))/2,{center:a}=o,l=isDef(a),c=l?parseFloat(helper(a).css("left")):n,h=l?parseFloat(helper(a).css("top")):i;e.setAttribute("data-cx",c),e.setAttribute("data-cy",h),this.storage.cached=null}_processResize(e,t){const{el:s,storage:o,options:{proportions:r}}=this,{controls:n,coords:i,cw:a,ch:l,transform:c,refang:h,revX:d,revY:u,doW:f,doH:p,restrictOffset:m,handle:v}=o,g=f||!f&&!p?(a+e)/a:(l+t)/l;let x=r?a*g:a+e,b=r?l*g:l+t;if(x<=MIN_SIZE||b<=MIN_SIZE)return;const y=[...c.matrix];isDef(m)&&(e>0&&(v[0].className.indexOf("sjx-hdl-l")>-1?y[4]-e<0&&(x=a+y[4]):x+y[4]>m.width&&(x=m.width-y[4])),t>0&&(v[0].className.indexOf("sjx-hdl-l")>-1?y[5]-e<0&&(x=l+y[5]):b+y[5]>m.height&&(b=m.height-y[5])));const _=rotatedTopLeft(y[4],y[5],x,b,h,d,u,f,p),E=i.left-_.left,M=i.top-_.top;y[4]+=E,y[5]+=M;const w=matrixToCSS(y);return w.width=`${x}px`,w.height=`${b}px`,helper(n).css(w),helper(s).css(w),o.cached={dx:E,dy:M},{width:x,height:b,ox:E,oy:M}}_processMove(e,t){const{el:s,storage:o}=this,{controls:r,transform:{matrix:n,parentMatrix:i}}=o,a=[...i];a[4]=a[5]=0;const l=[...n];l[4]=n[4]+e,l[5]=n[5]+t;const c=matrixToCSS(l);return helper(r).css(c),helper(s).css(c),o.cached={dx:e,dy:t},l}_getState(e){const{revX:t,revY:s,doW:o,doH:r}=e,n=t!==s?-1:1,{el:i,storage:{handles:a,controls:l,parent:c},options:{container:h}}=this,{center:d}=a,u=helper(l),f=parseMatrix(getTransform(helper(h))),p=parseMatrix(getTransform(helper(l))),m=parseMatrix(getTransform(helper(c))),v=Math.atan2(p[1],p[0])*n,g=c!==h?multiplyMatrix(m,f):f,x={matrix:p,parentMatrix:g,scX:Math.sqrt(p[0]*p[0]+p[1]*p[1]),scY:Math.sqrt(p[2]*p[2]+p[3]*p[3])},b=parseFloat(u.css("width")),y=parseFloat(u.css("height")),_=rotatedTopLeft(p[4],p[5],b,y,v,t,s,o,r),E=b/2,M=y/2,w=getOffset(i),D=isDef(d),T=D?parseFloat(helper(d).css("left")):E,j=D?parseFloat(helper(d).css("top")):M,z=D?CENTER_DELTA:0,{x:S,y:C}=matrixTransform({x:w.left,y:w.top},matrixInvert(g));return{transform:x,cw:b,ch:y,coords:_,center:{x:S+T-z,y:C+j-z,cx:-T+E-z,cy:-j+M-z,hx:T,hy:j},factor:n,refang:v,revX:t,revY:s,doW:o,doH:r}}_moveCenterHandle(e,t){const{handles:{center:s},center:{hx:o,hy:r}}=this.storage,n=`${o+e}px`,i=`${r+t}px`;helper(s).css({left:n,top:i})}fitControlsToSize(){}get controls(){return this.storage.controls}}const createHandler=e=>{const t=document.createElement("div");return e.forEach(e=>{addClass(t,e)}),t};function drag(e,t){if(this.length){const s=isDef(t)&&t instanceof Observable?t:new Observable;return arrReduce.call(this,(t,o)=>(t.push(new Draggable(o,e,s)),t),[])}}class Subjx extends Helper{drag(){return drag.call(this,...arguments)}}function subjx(e){return new Subjx(e)}Object.defineProperty(subjx,"createObservable",{value:()=>new Observable}),Object.defineProperty(subjx,"Subjx",{value:Subjx}),Object.defineProperty(subjx,"Observable",{value:Observable}),module.exports=subjx;
