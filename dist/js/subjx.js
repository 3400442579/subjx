!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).subjx=e()}(this,function(){"use strict";function h(t){return(h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){for(var o=0;o<e.length;o++){var r=e[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function i(t,e,o){return e&&r(t.prototype,e),o&&r(t,o),t}function e(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),o.push.apply(o,r)}return o}function D(n){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?e(a,!0).forEach(function(t){var e,o,r;e=n,r=a[o=t],o in e?Object.defineProperty(e,o,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[o]=r}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):e(a).forEach(function(t){Object.defineProperty(n,t,Object.getOwnPropertyDescriptor(a,t))})}return n}function t(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&o(t,e)}function a(t){return(a=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function o(t,e){return(o=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function c(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function ie(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if(!(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t)))return;var o=[],r=!0,n=!1,a=void 0;try{for(var s,i=t[Symbol.iterator]();!(r=(s=i.next()).done)&&(o.push(s.value),!e||o.length!==e);r=!0);}catch(t){n=!0,a=t}finally{try{r||null==i["return"]||i["return"]()}finally{if(n)throw a}}return o}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function W(t){return function(t){if(Array.isArray(t)){for(var e=0,o=new Array(t.length);e<t.length;e++)o[e]=t[e];return o}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var n={passive:!1},H=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||function(t){return setTimeout(t,1e3/60)},u=window.cancelAnimationFrame||window.mozCancelAnimationFrame||function(t){clearTimeout(t)},l=Array.prototype.forEach,f=Array.prototype.slice,v=Array.prototype.map,d=Array.prototype.reduce,ce=console.warn;function q(t){return null!=t}function U(t){return null==t}function p(t){return"function"==typeof t}var y=function(){function a(t){if(s(this,a),"string"==typeof t){var e=document.querySelectorAll(t);this.length=e.length;for(var o=0;o<this.length;o++)this[o]=e[o]}else if("object"!==h(t)||1!==t.nodeType&&t!==document)if(t instanceof a){this.length=t.length;for(var r=0;r<this.length;r++)this[r]=t[r]}else{if(!function(t){return q(t)&&"object"===h(t)&&(Array.isArray(t)||q(window.Symbol)&&"function"==typeof t[window.Symbol.iterator]||q(t.forEach)||"number"==typeof t.length&&(0===t.length||0<t.length&&t.length-1 in t))}(t))throw new Error("Passed parameter must be selector/element/elementArray");for(var n=this.length=0;n<this.length;n++)1===t.nodeType&&(this[n]=t[n],this.length++)}else this[0]=t,this.length=1}return i(a,[{key:"css",value:function(o){var t={setStyle:function(t){return function(t,e){for(var o=t.length;o--;)for(var r in e)t[o].style[r]=e[r];return t.style}(this,t)},getStyle:function(){return function(t){for(var e=t.length;e--;)return t[e].currentStyle?t[e].currentStyle[o]:document.defaultView&&document.defaultView.getComputedStyle?document.defaultView.getComputedStyle(t[e],"")[o]:t[e].style[o]}(this)}};return"string"==typeof o?t.getStyle.apply(this,f.call(arguments,1)):"object"!==h(o)&&o?(ce("Method ".concat(o," does not exist")),!1):t.setStyle.apply(this,arguments)}},{key:"find",value:function(t){for(var e=this.length;e--;)return F(this[e].querySelectorAll(t))}},{key:"each",value:function(t){for(var e,o=f.call(this,0),r=o.length-1;0<=r;--r)e=r,t.call(o[e]);return this}},{key:"on",value:function(t,e,o,r){for(var n=this.length;n--;)this[n].events||(this[n].events={},this[n].events[t]=[]),"string"!=typeof e?document.addEventListener?this[n].addEventListener(t,e,o):document.attachEvent?this[n].attachEvent("on".concat(t),e):this[n]["on".concat(t)]=e:b(this[n],t,e,o,r,!0);return this}},{key:"off",value:function(t,e,o,r){for(var n=this.length;n--;)this[n].events||(this[n].events={},this[n].events[t]=[]),"string"!=typeof e?document.removeEventListener?this[n].removeEventListener(t,e,o):document.detachEvent?this[n].detachEvent("on".concat(t),e):this[n]["on".concat(t)]=null:b(this[n],t,e,o,r,!1);return this}},{key:"is",value:function(t){for(var e=F(t),o=this.length;o--;)if(this[o]===e[o])return!0;return!1}}]),a}();function b(t,e,o,r,n,a){function s(t){for(var e=t.target;e&&e!==this;)e.matches(o)&&r.call(e,t),e=e.parentNode}!0===a?document.addEventListener?t.addEventListener(e,s,n||!1):document.attachEvent?t.attachEvent("on".concat(e),s):t["on".concat(e)]=s:document.removeEventListener?t.removeEventListener(e,s,n||!1):document.detachEvent?t.detachEvent("on".concat(e),s):t["on".concat(e)]=null}function F(t){return new y(t)}var m=function(){function t(){s(this,t),this.observers={}}return i(t,[{key:"subscribe",value:function(t,e){var o=this.observers;return U(o[t])&&Object.defineProperty(o,t,{value:[]}),o[t].push(e),this}},{key:"unsubscribe",value:function(t,e){var o=this.observers;if(q(o[t])){var r=o[t].indexOf(e);o[t].splice(r,1)}return this}},{key:"notify",value:function(e,o,r){U(this.observers[e])||this.observers[e].forEach(function(t){if(o!==t)switch(e){case"onmove":t.notifyMove(r);break;case"onrotate":t.notifyRotate(r);break;case"onresize":t.notifyResize(r);break;case"onapply":t.notifyApply(r);break;case"ongetstate":t.notifyGetState(r)}})}}]),t}();function P(t){return t.getBoundingClientRect()}function R(t){return t.css("-webkit-transform")||t.css("-moz-transform")||t.css("-ms-transform")||t.css("-o-transform")||t.css("transform")||"none"}function N(t){var e=t.match(/-?\d+\.?\d+|-?\d+/g);return e?e.map(function(t){return parseFloat(t)}):[1,0,0,1,0,0]}function G(e,t){if(t){if(e.classList){if(!(-1<t.indexOf(" ")))return e.classList.add(t);t.split(/\s+/).forEach(function(t){return e.classList.add(t)})}return e}}function z(e,t){if(t){if(e.classList){if(!(-1<t.indexOf(" ")))return e.classList.remove(t);t.split(/\s+/).forEach(function(t){return e.classList.remove(t)})}return e}}var I=Math.PI/180;function Q(t,e){if(0===e)return t;var o=function(t,e){return 0===e?t:Math.round(t/e)*e}(t,e);return o-t<e?o:void 0}function X(t,e,o,r,n,a,s,i,c){var l=parseFloat(o)/2,u=parseFloat(r)/2,h=t+l,f=e+u,v=t-h,d=e-f,p=Math.atan2(i?0:d,c?0:v)+n,y=Math.sqrt(Math.pow(c?0:l,2)+Math.pow(i?0:u,2)),b=Math.cos(p),m=Math.sin(p),x=f+y*(m=!0===s?-m:m);return{left:le(h+y*(b=!0===a?-b:b)),top:le(x)}}function le(t,e){var o=1<arguments.length&&void 0!==e?e:6;return Number(t.toFixed(o))}var x=function(){function o(t,e){if(s(this,o),this.constructor===o)throw new TypeError("Cannot construct Subject instances directly");this.el=t,this.storage=null,this.proxyMethods=null,this.observable=e,this._onMouseDown=this._onMouseDown.bind(this),this._onTouchStart=this._onTouchStart.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this._onTouchMove=this._onTouchMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._onTouchEnd=this._onTouchEnd.bind(this),this._animate=this._animate.bind(this)}return i(o,[{key:"enable",value:function(t){U(this.storage)?(this._processOptions(t),this._init(this.el)):ce("Already enabled")}},{key:"disable",value:function(){var t=this.storage,e=this.proxyMethods,o=this.el;U(t)||(t.onExecution&&(this._end(),F(document).off("mousemove",this._onMouseMove).off("mouseup",this._onMouseUp).off("touchmove",this._onTouchMove,n).off("touchend",this._onTouchEnd,n)),z(o,"sjx-drag"),this._destroy(),this.unsubscribe(),e.onDestroy.call(this,o),delete this.storage)}},{key:"_init",value:function(){throw Error("'_init()' method not implemented")}},{key:"_destroy",value:function(){throw Error("'_destroy()' method not implemented")}},{key:"_cursorPoint",value:function(){throw Error("'_cursorPoint()' method not implemented")}},{key:"_drag",value:function(){var t;this._processMove.apply(this,arguments),(t=this.proxyMethods.onMove).call.apply(t,[this].concat(Array.prototype.slice.call(arguments)))}},{key:"_rotate",value:function(){var t;this._processRotate.apply(this,arguments),(t=this.proxyMethods.onRotate).call.apply(t,[this].concat(Array.prototype.slice.call(arguments)))}},{key:"_resize",value:function(){var t;this._processResize.apply(this,arguments),(t=this.proxyMethods.onResize).call.apply(t,[this].concat(Array.prototype.slice.call(arguments)))}},{key:"_processOptions",value:function(t){var e=this.el;G(e,"sjx-drag");var o={x:10,y:10,angle:10*I},r={move:!1,resize:!1,rotate:!1},n=null,a=!1,s="xy",i="auto",c="auto",l="auto",u="#00a8ff",h=!1,f=function(){},v=function(){},d=function(){},p=function(){},y=function(){},b=function(){},m=e.parentNode;if(q(t)){var x=t.snap,g=t.each,_=t.axis,M=t.cursorMove,w=t.cursorResize,k=t.cursorRotate,j=t.rotationPoint,E=t.restrict,T=t.onInit,A=t.onDrop,V=t.onMove,S=t.onResize,C=t.onRotate,O=t.onDestroy,D=t.container,P=t.proportions,R=t.themeColor;if(q(x)){var N=x.x,z=x.y,X=x.angle;o.x=U(N)?10:N,o.y=U(z)?10:z,o.angle=U(X)?o.angle:X*I}if(q(g)){var Y=g.move,B=g.resize,L=g.rotate;r.move=Y||!1,r.resize=B||!1,r.rotate=L||!1}q(E)&&(n="parent"===E?e.parentNode:F(E)[0]||document),u=R||"#00a8ff",i=M||"auto",c=w||"auto",l=k||"auto",s=_||"xy",m=q(D)&&F(D)[0]?F(D)[0]:m,h=j||!1,a=P||!1,f=Z(T),y=Z(A),v=Z(V),p=Z(S),d=Z(C),b=Z(O),f.call(this,e)}this.options={axis:s,themeColor:u,cursorMove:i,cursorRotate:l,cursorResize:c,rotationPoint:h,restrict:n,container:m,snap:o,each:r,proportions:a},this.proxyMethods={onInit:f,onDrop:y,onMove:v,onResize:p,onRotate:d,onDestroy:b},this.subscribe(r)}},{key:"_draw",value:function(){this._animate()}},{key:"_animate",value:function(){var t=this,e=t.observable,o=t.storage,r=t.options;if(!U(o)&&(o.frame=H(t._animate),o.doDraw)){o.doDraw=!1;var n=o.dox,a=o.doy,s=o.clientX,i=o.clientY,c=o.doDrag,l=o.doResize,u=o.doRotate,h=o.doSetCenter,f=o.revX,v=o.revY,d=o.handle,p=r.snap,y=r.each,b=r.restrict,m=y.move,x=y.resize,g=y.rotate;if(l){var _=o.transform,M=o.cx,w=o.cy,k=this._pointToElement({x:s,y:i}),j=k.x,E=k.y,T=n?Q(j-M,p.x/_.scX):0,A=a?Q(E-w,p.y/_.scY):0;T=n?f?-T:T:0,A=a?v?-A:A:0,t._resize(T,A,d[0]),x&&e.notify("onresize",t,{dx:T,dy:A,handle:d[0]})}if(c){var V=o.restrictOffset,S=o.elementOffset,C=o.nx,O=o.ny;q(b)&&(s-V.left<C-S.left&&(s=C-S.left+V.left),i-V.top<O-S.top&&(i=O-S.top+V.top));var D=n?Q(s-C,p.x):0,P=a?Q(i-O,p.y):0;t._drag(D,P),m&&e.notify("onmove",t,{dx:D,dy:P})}if(u){var R=o.pressang,N=o.center,z=Math.atan2(i-N.y,s-N.x)-R;t._rotate(Q(z,p.angle)),g&&e.notify("onrotate",t,{radians:z})}if(h){var X=o.bx,Y=o.by,B=this._pointToControls({x:s,y:i}),L=B.x,F=B.y;t._moveCenterHandle(L-X,F-Y)}}}},{key:"_start",value:function(t){var e=this.observable,o=this.storage,r=this.options,n=this.el,a=this._compute(t);Object.keys(a).forEach(function(t){o[t]=a[t]});var s=a.onRightEdge,i=a.onBottomEdge,c=a.onTopEdge,l=a.onLeftEdge,u=a.handle,h=a.factor,f=a.revX,v=a.revY,d=a.doW,p=a.doH,y=s||i||c||l,b=o.handles,m=o.radius,x=r.axis,g=r.restrict;q(m)&&z(m,"sjx-hidden");var _=u.is(b.rotator),M=!!q(b.center)&&u.is(b.center),w=t.clientX,k=t.clientY,j=this._cursorPoint({clientX:w,clientY:k}),E=j.x,T=j.y,A=this._pointToElement({x:E,y:T}),V=A.x,S=A.y,C=this._pointToControls({x:E,y:T}),O={clientX:w,clientY:k,nx:E,ny:T,cx:V,cy:S,bx:C.x,by:C.y,doResize:y,doDrag:!(_||y||M),doRotate:_,doSetCenter:M,onExecution:!0,cursor:null,elementOffset:P(n),restrictOffset:q(g)?P(g):null,dox:/\x/.test(x)&&(!y||(u.is(b.ml)||u.is(b.mr)||u.is(b.tl)||u.is(b.tr)||u.is(b.bl)||u.is(b.br))),doy:/\y/.test(x)&&(!y||(u.is(b.br)||u.is(b.bl)||u.is(b.bc)||u.is(b.tr)||u.is(b.tl)||u.is(b.tc)))};this.storage=D({},o,{},O),e.notify("ongetstate",this,{factor:h,revX:f,revY:v,doW:d,doH:p}),this._draw()}},{key:"_moving",value:function(t){var e=this.storage,o=this.options,r=this._cursorPoint(t),n=r.x,a=r.y;e.e=t,e.clientX=n,e.clientY=a,e.doDraw=!0;var s=e.doRotate,i=e.doDrag,c=e.doResize,l=e.cursor,u=o.cursorMove,h=o.cursorResize,f=o.cursorRotate;U(l)&&(i?l=u:s?l=f:c&&(l=h),F(document.body).css({cursor:l}))}},{key:"_end",value:function(t){var e=this.observable,o=this.storage,r=this.proxyMethods,n=this.el,a=o.doResize,s=o.doDrag,i=o.frame,c=o.radius,l=a?"resize":s?"drag":"rotate";o.doResize=!1,o.doDrag=!1,o.doRotate=!1,o.doSetCenter=!1,o.doDraw=!1,o.onExecution=!1,o.cursor=null,this._apply(l),r.onDrop.call(this,t,n),e.notify("onapply",this,{actionName:l,e:t}),u(i),F(document.body).css({cursor:"auto"}),q(c)&&G(c,"sjx-hidden")}},{key:"_checkHandles",value:function(t,e){var o=t.is(e.tl),r=t.is(e.tc),n=t.is(e.tr),a=t.is(e.bl),s=t.is(e.bc),i=t.is(e.br),c=t.is(e.ml),l=t.is(e.mr);return{revX:o||c||a||r,revY:o||n||r||c,onTopEdge:r||n||o,onLeftEdge:o||c||a,onRightEdge:n||l||i,onBottomEdge:i||s||a,doW:c||l,doH:r||s}}},{key:"_onMouseDown",value:function(t){this._start(t),F(document).on("mousemove",this._onMouseMove).on("mouseup",this._onMouseUp)}},{key:"_onTouchStart",value:function(t){this._start(t.touches[0]),F(document).on("touchmove",this._onTouchMove,n).on("touchend",this._onTouchEnd,n)}},{key:"_onMouseMove",value:function(t){t.preventDefault&&t.preventDefault(),this._moving(t,this.el)}},{key:"_onTouchMove",value:function(t){t.preventDefault&&t.preventDefault(),this._moving(t.touches[0],this.el)}},{key:"_onMouseUp",value:function(t){F(document).off("mousemove",this._onMouseMove).off("mouseup",this._onMouseUp),this._end(t,this.el)}},{key:"_onTouchEnd",value:function(t){F(document).off("touchmove",this._onTouchMove).off("touchend",this._onTouchEnd),0===t.touches.length&&this._end(t.changedTouches[0],this.el)}},{key:"notifyMove",value:function(t){var e=t.dx,o=t.dy;this._drag(e,o)}},{key:"notifyRotate",value:function(t){var e=t.radians,o=this.options.snap;this._rotate(Q(e,o.angle))}},{key:"notifyResize",value:function(t){var e=t.dx,o=t.dy;this._resize(e,o)}},{key:"notifyApply",value:function(t){var e=t.e,o=t.actionName;this.proxyMethods.onDrop.call(this,e,this.el),this._apply(o)}},{key:"notifyGetState",value:function(t){var e=this.storage,o=this._getState(t);this.storage=D({},e,{},o)}},{key:"subscribe",value:function(t){var e=this.observable,o=t.resize,r=t.move,n=t.rotate;(r||o||n)&&e.subscribe("ongetstate",this).subscribe("onapply",this),r&&e.subscribe("onmove",this),o&&e.subscribe("onresize",this),n&&e.subscribe("onrotate",this)}},{key:"unsubscribe",value:function(){this.observable.unsubscribe("ongetstate",this).unsubscribe("onapply",this).unsubscribe("onmove",this).unsubscribe("onresize",this).unsubscribe("onrotate",this)}}]),o}();function Z(t){return p(t)?function(){t.call.apply(t,[this].concat(Array.prototype.slice.call(arguments)))}:function(){}}var w=2,Y=7,g=function(){function n(t,e,o){var r;return s(this,n),(r=c(this,a(n).call(this,t,o))).enable(e),r}return t(n,x),i(n,[{key:"_init",value:function(t){var e=document.createElement("div");G(e,"sjx-wrapper"),t.parentNode.insertBefore(e,t);var o=F(t),r=this.options.rotationPoint,n=t.style,a=n.left,s=n.top,i=n.width,c=n.height,l=i||o.css("width"),u=c||o.css("height"),h=s||o.css("top"),f=a||o.css("left"),v=F(e.parentNode),d={top:h,left:f,width:l,height:u,transform:R(o)},p=document.createElement("div"),y={normal:["sjx-normal"],tl:["sjx-hdl","sjx-hdl-t","sjx-hdl-l","sjx-hdl-tl"],tr:["sjx-hdl","sjx-hdl-t","sjx-hdl-r","sjx-hdl-tr"],br:["sjx-hdl","sjx-hdl-b","sjx-hdl-r","sjx-hdl-br"],bl:["sjx-hdl","sjx-hdl-b","sjx-hdl-l","sjx-hdl-bl"],tc:["sjx-hdl","sjx-hdl-t","sjx-hdl-c","sjx-hdl-tc"],bc:["sjx-hdl","sjx-hdl-b","sjx-hdl-c","sjx-hdl-bc"],ml:["sjx-hdl","sjx-hdl-m","sjx-hdl-l","sjx-hdl-ml"],mr:["sjx-hdl","sjx-hdl-m","sjx-hdl-r","sjx-hdl-mr"],center:r?["sjx-hdl","sjx-hdl-m","sjx-hdl-c","sjx-hdl-mc"]:void 0,rotator:["sjx-hdl","sjx-hdl-m","sjx-rotator"]};Object.keys(y).forEach(function(t){var e=y[t];if(!U(e)){var o=function(t){var e=document.createElement("div");return t.forEach(function(t){G(e,t)}),e}(e);y[t]=o,p.appendChild(o)}}),q(y.center)&&F(y.center).css({left:"".concat(t.getAttribute("data-cx"),"px"),top:"".concat(t.getAttribute("data-cy"),"px")});G(p,"sjx-controls"),e.appendChild(p);var b=F(p);b.css(d);var m=F(e);this.storage={controls:p,handles:y,radius:m.find(".sjx-radius"),parent:v},b.on("mousedown",this._onMouseDown).on("touchstart",this._onTouchStart)}},{key:"_destroy",value:function(){var t=this.storage.controls;F(t).off("mousedown",this._onMouseDown).off("touchstart",this._onTouchStart);var e=t.parentNode;e.parentNode.removeChild(e)}},{key:"_compute",value:function(t){var e=this.storage.handles,o=F(t.target),r=this._checkHandles(o,e),n=r.revX,a=r.revY,s=r.onTopEdge,i=r.onLeftEdge,c=r.onRightEdge,l=r.onBottomEdge,u=r.doW,h=r.doH,f=o.is(e.tr)||o.is(e.bl)?-1:1,v=this._getState({factor:f,revX:n,revY:a,doW:u,doH:h}),d=this._cursorPoint(t),p=d.x,y=d.y;return D({},v,{onTopEdge:s,onLeftEdge:i,onRightEdge:c,onBottomEdge:l,handle:o,pressang:Math.atan2(y-v.center.y,p-v.center.x)})}},{key:"_pointToElement",value:function(t){var e=t.x,o=t.y,r=W(this.storage.transform.matrix);return r[4]=r[5]=0,this._applyMatrixToPoint(M(r),e,o)}},{key:"_pointToControls",value:function(t){return this._pointToElement(t)}},{key:"_applyMatrixToPoint",value:function(t,e,o){return _({x:e,y:o},t)}},{key:"_cursorPoint",value:function(t){return _({x:t.clientX,y:t.clientY},M(N(R(F(this.options.container)))))}},{key:"_apply",value:function(){var t=this.el,e=this.storage,o=F(t),r=e.cached,n=e.controls,a=e.transform,s=e.handles,i=F(n),c=parseFloat(i.css("width"))/2,l=parseFloat(i.css("height"))/2,u=s.center,h=q(u),f=h?parseFloat(F(u).css("left")):c,v=h?parseFloat(F(u).css("top")):l;if(t.setAttribute("data-cx",f),t.setAttribute("data-cy",v),!U(r)){var d=r.dx,p=r.dy,y=k(a.matrix),b=parseFloat(t.style.left||o.css("left")),m=parseFloat(t.style.top||o.css("top"));y.left="".concat(b+d,"px"),y.top="".concat(m+p,"px"),o.css(y),i.css(y),this.storage.cached=null}}},{key:"_processResize",value:function(t,e){var o=this.el,r=this.storage,n=this.options.proportions,a=r.controls,s=r.coords,i=r.cw,c=r.ch,l=r.transform,u=r.refang,h=r.revX,f=r.revY,v=r.doW,d=r.doH,p=v||!v&&!d?(i+t)/i:(c+e)/c,y=n?i*p:i+t,b=n?c*p:c+e;if(!(y<w||b<w)){var m=W(l.matrix),x=X(m[4],m[5],y,b,u,h,f,v,d),g=s.left-x.left,_=s.top-x.top;m[4]+=g,m[5]+=_;var M=k(m);M.width="".concat(y,"px"),M.height="".concat(b,"px"),F(a).css(M),F(o).css(M),r.cached={dx:g,dy:_}}}},{key:"_processMove",value:function(t,e){var o=this.el,r=this.storage,n=r.controls,a=r.transform,s=a.matrix,i=W(a.parentMatrix);i[4]=i[5]=0;var c=W(s);c[4]=s[4]+t,c[5]=s[5]+e;var l=k(c);F(n).css(l),F(o).css(l),r.cached={dx:t,dy:e}}},{key:"_processRotate",value:function(t){var e=this.el,o=this.storage,r=o.controls,n=o.transform,a=o.center,s=n.matrix,i=n.parentMatrix,c=le(Math.cos(t)),l=le(Math.sin(t)),u=[1,0,0,1,a.cx,a.cy],h=[c,l,-l,c,0,0],f=W(i);f[4]=f[5]=0;var v=k(B(B(B(u,B(M(f),B(h,f))),M(u)),s));F(r).css(v),F(e).css(v)}},{key:"_getState",value:function(t){var e=t.factor,o=t.revX,r=t.revY,n=t.doW,a=t.doH,s=this.el,i=this.storage,c=this.options.container,l=i.handles,u=i.controls,h=i.parent,f=l.center,v=l.tl,d=l.tr,p=P(v),y=P(d),b=Math.atan2(y.top-p.top,y.left-p.left)*e,m=F(u),x=N(R(F(c))),g=N(R(F(u))),_=N(R(h)),M={matrix:g,parentMatrix:h===c?B(_,x):x,scX:Math.sqrt(g[0]*g[0]+g[1]*g[1]),scY:Math.sqrt(g[2]*g[2]+g[3]*g[3])},w=parseFloat(m.css("width")),k=parseFloat(m.css("height")),j=X(g[4],g[5],w,k,b,o,r,n,a),E=w/2,T=k/2,A=P(s),V=q(f),S=V?parseFloat(F(f).css("left")):E,C=V?parseFloat(F(f).css("top")):T,O=V?Y:0;return{transform:M,cw:w,ch:k,coords:j,center:{x:A.left+S-O,y:A.top+C-O,cx:-S+E-O,cy:-C+T-O,hx:S,hy:C},factor:e,refang:b,revX:o,revY:r,doW:n,doH:a}}},{key:"_moveCenterHandle",value:function(t,e){var o=this.storage,r=o.handles,n=o.center,a="".concat(n.hx+t,"px"),s="".concat(n.hy+e,"px");F(r.center).css({left:a,top:s})}},{key:"resetCenterPoint",value:function(){F(this.storage.handles.center).css({left:null,top:null})}},{key:"controls",get:function(){return this.storage.controls}}]),n}();function k(t){var e="matrix(".concat(t.join(),")");return{transform:e,webkitTranform:e,mozTransform:e,msTransform:e,otransform:e}}function _(t,e){var o=t.x,r=t.y,n=ie(e,6),a=n[0],s=n[1],i=n[2],c=n[3];return{x:a*o+i*r+n[4],y:s*o+c*r+n[5]}}function M(t){var e=[[t[0],t[2],t[4]],[t[1],t[3],t[5]],[0,0,1]];if(e.length===e[0].length){for(var o=e.length,r=[],n=[],a=0;a<o;a+=1){r[r.length]=[],n[n.length]=[];for(var s=0;s<o;s+=1)r[a][s]=a==s?1:0,n[a][s]=e[a][s]}for(var i=0;i<o;i+=1){var c=n[i][i];if(0===c){for(var l=i+1;l<o;l+=1)if(0!==n[l][i]){for(var u=0;u<o;u++)c=n[i][u],n[i][u]=n[l][u],n[l][u]=c,c=r[i][u],r[i][u]=r[l][u],r[l][u]=c;break}if(0===(c=n[i][i]))return}for(var h=0;h<o;h++)n[i][h]=n[i][h]/c,r[i][h]=r[i][h]/c;for(var f=0;f<o;f++)if(f!=i){c=n[f][i];for(var v=0;v<o;v++)n[f][v]-=c*n[i][v],r[f][v]-=c*r[i][v]}}return[r[0][0],r[1][0],r[0][1],r[1][1],r[0][2],r[1][2]]}}function B(t,e){for(var o=[[t[0],t[2],t[4]],[t[1],t[3],t[5]],[0,0,1]],r=[[e[0],e[2],e[4]],[e[1],e[3],e[5]],[0,0,1]],n=[],a=0;a<r.length;a++){n[a]=[];for(var s=0;s<o[0].length;s++){for(var i=0,c=0;c<o.length;c++)i+=o[c][s]*r[a][c];n[a].push(i)}}return[n[0][0],n[1][0],n[0][1],n[1][1],n[0][2],n[1][2]]}var j=["circle","ellipse","image","line","path","polygon","polyline","rect","text","g"];function V(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function ot(){return V("svg").createSVGMatrix()}function rt(t,e){return(e.getScreenCTM()||ot()).inverse().multiply(t.getScreenCTM()||ot())}function C(t){return"matrix(".concat(t.a,",").concat(t.b,",").concat(t.c,",").concat(t.d,",").concat(t.e,",").concat(t.f,")")}function ue(t,e,o,r){var n=e.createSVGPoint();return n.x=o,n.y=r,n.matrixTransform(t)}function he(t){var e=ot();return e.a=t.a,e.b=t.b,e.c=t.c,e.d=t.d,e.e=t.e,e.f=t.f,e}var E=/\s*([achlmqstvz])([^achlmqstvz]*)\s*/gi,T=/\s*,\s*|\s+/g;function fe(t){for(var e=E.lastIndex=0,o=[];e=E.exec(t);){var r=e[1],n=r.toUpperCase(),a=e[2].replace(/([^e])-/g,"$1 -").replace(/ +/g," ");o.push({relative:r!==n,key:n,cmd:r,values:a.trim().split(T).map(function(t){if(!isNaN(t))return Number(t)})})}return o}var O=5,S=50,A=/[+-]?\d+(\.\d+)?/g,L=function(){function n(t,e,o){var r;return s(this,n),(r=c(this,a(n).call(this,t,o))).enable(e),r}return t(n,x),i(n,[{key:"_init",value:function(t){var e=this.options,o=e.rotationPoint,r=e.container,a=e.themeColor,n=V("g");r.appendChild(n);var s=t.getBBox(),i=s.width,c=s.height,l=s.x,u=s.y,h=rt(t,r),f=V("rect");[["width",i],["height",c],["x",l],["y",u],["fill",a],["fill-opacity",.1],["stroke",a],["stroke-dasharray","3 3"],["vector-effect","non-scaling-stroke"],["transform",C(h)]].forEach(function(t){f.setAttribute(t[0],t[1])});var v=V("g"),d=V("g"),p=V("g");p.appendChild(f),n.appendChild(p),n.appendChild(d),n.appendChild(v);var y=f.getBBox(),b=y.x,m=y.y,x=y.width,g=y.height,_=t.getAttribute("data-cx"),M=t.getAttribute("data-cy"),w=rt(f,f.parentNode),k=ue(w,r,b+x/2,m+g/2),j={tl:ue(w,r,b,m),tr:ue(w,r,b+x,m),br:ue(w,r,b+x,m+g),bl:ue(w,r,b,m+g),tc:ue(w,r,b+x/2,m),bc:ue(w,r,b+x/2,m+g),ml:ue(w,r,b,m+g/2),mr:ue(w,r,b+x,m+g/2),center:o?function(t,e,o){if(U(e)||U(o))return null;var r=t.createSVGPoint();return r.x=e,r.y=o,r}(r,_,M)||k:void 0,rotator:{}},E=Math.atan2(j.tl.y-j.tr.y,j.tl.x-j.tr.x);j.rotator.x=j.mr.x-S*Math.cos(E),j.rotator.y=j.mr.y-S*Math.sin(E);var T=V("line");T.x1.baseVal.value=j.mr.x,T.y1.baseVal.value=j.mr.y,T.x2.baseVal.value=j.rotator.x,T.y2.baseVal.value=j.rotator.y,at(T,a),d.appendChild(T);var A=null;o&&(G(A=V("line"),"sjx-hidden"),A.x1.baseVal.value=k.x,A.y1.baseVal.value=k.y,A.x2.baseVal.value=_||k.x,A.y2.baseVal.value=M||k.y,at(A,"#fe3232"),A.setAttribute("opacity",.5),d.appendChild(A)),Object.keys(j).forEach(function(t){var e=j[t];if(!U(e)){var o=e.x,r=e.y,n="center"===t?"#fe3232":a;j[t]=function(t,e,o,r){var n=V("circle");G(n,"sjx-svg-hdl-".concat(r));var a={cx:t,cy:e,r:5.5,fill:o,stroke:"#fff","fill-opacity":1,"vector-effect":"non-scaling-stroke","stroke-width":1};return Object.keys(a).map(function(t){n.setAttribute(t,a[t])}),n}(o,r,n,t),v.appendChild(j[t])}}),this.storage={wrapper:n,box:f,handles:j,normalLine:T,radius:o?A:void 0,parent:t.parentNode},F(n).on("mousedown",this._onMouseDown).on("touchstart",this._onTouchStart)}},{key:"_destroy",value:function(){var t=this.storage.wrapper;F(t).off("mousedown",this._onMouseDown).off("touchstart",this._onTouchStart),t.parentNode.removeChild(t)}},{key:"_compute",value:function(t){var e=this.storage.handles,o=F(t.target),r=this._checkHandles(o,e),n=r.revX,a=r.revY,s=r.onTopEdge,i=r.onLeftEdge,c=r.onRightEdge,l=r.onBottomEdge,u=r.doW,h=r.doH,f=this._getState({revX:n,revY:a,doW:u,doH:h}),v=this._cursorPoint(t),d=v.x,p=v.y;return D({},f,{doW:u,doH:h,onTopEdge:s,onLeftEdge:i,onRightEdge:c,onBottomEdge:l,handle:o,pressang:Math.atan2(p-f.center.y,d-f.center.x)})}},{key:"_cursorPoint",value:function(t){var e=t.clientX,o=t.clientY,r=this.options.container;return ue(r.getScreenCTM().inverse(),r,e,o)}},{key:"_pointToElement",value:function(t){var e=t.x,o=t.y,r=this.storage.transform.ctm.inverse();return r.e=r.f=0,this._applyMatrixToPoint(r,e,o)}},{key:"_pointToControls",value:function(t){var e=t.x,o=t.y,r=this.storage.transform.boxCTM.inverse();return r.e=r.f=0,this._applyMatrixToPoint(r,e,o)}},{key:"_applyMatrixToPoint",value:function(t,e,o){var r=this.options.container.createSVGPoint();return r.x=e,r.y=o,r.matrixTransform(t)}},{key:"_apply",value:function(t){var s=this.el,e=this.storage,i=this.options.container,o=e.box,r=e.handles,n=e.cached,a=e.transform,c=a.matrix,l=s.getBBox(),u=l.x,h=l.y,f=l.width,v=l.height,d=q(r.center)?ue(a.boxCTM,i,r.center.cx.baseVal.value,r.center.cy.baseVal.value):ue(c,i,u+f/2,h+v/2);if(s.setAttribute("data-cx",d.x),s.setAttribute("data-cy",d.y),!U(n)){var p=n.scaleX,y=n.scaleY,b=n.dx,m=n.dy,x=n.ox,g=n.oy;if("drag"===t){if(0===b&&0===m)return;var _=ot();_.e=b,_.f=m;var M=_.multiply(c).multiply(_.inverse());if(s.setAttribute("transform",C(M)),tt(s))et(s).forEach(function(t){var e=i.createSVGPoint(),o=rt(s.parentNode,i).inverse();e.x=x,e.y=g,o.e=o.f=0;var r=e.matrixTransform(o),n=ot();n.e=b,n.f=m;var a=n.multiply(rt(t,t.parentNode)).multiply(n.inverse());!function(t){return 1===t.a&&0===t.b&&0===t.c&&1===t.d&&0===t.e&&0===t.f}(a)&&t.setAttribute("transform",C(a)),tt(t)||$(t,{x:r.x,y:r.y})});else $(s,{x:b,y:m})}if("resize"===t){var w=o.getBBox(),k=w.x,j=w.y,E=w.width,T=w.height;if(K(e,{x:k,y:j,width:E,height:T},i),tt(s))et(s).forEach(function(t){tt(t)||J(t,{scaleX:p,scaleY:y,defaultCTM:t.__ctm__,bBox:a.bBox,container:i,storage:e})});else J(s,{scaleX:p,scaleY:y,defaultCTM:a.ctm,bBox:a.bBox,container:i,storage:e});s.setAttribute("transform",C(c))}this.storage.cached=null}}},{key:"_processResize",value:function(t,e){var o=this.el,r=this.storage,n=this.options,a=n.container,s=n.proportions,i=this.storage,c=i.box,l=i.left,u=i.top,h=i.cw,f=i.ch,v=i.transform,d=i.revX,p=i.revY,y=i.doW,b=i.doH,m=v.matrix,x=v.scMatrix,g=v.trMatrix,_=v.scaleX,M=v.scaleY,w=c.getBBox(),k=w.width,j=w.height,E=y||!y&&!b?(h+t)/h:(f+e)/f;if(k=s?h*E:h+t,j=s?f*E:f+e,!(Math.abs(k)<O||Math.abs(j)<O)){var T=k/h,A=j/f;x.a=T,x.b=0,x.c=0,x.d=A,x.e=0,x.f=0,g.e=_,g.f=M;var V=g.multiply(x).multiply(g.inverse()),S=m.multiply(V);o.setAttribute("transform",C(S)),this.storage.cached={scaleX:T,scaleY:A},K(r,{x:l-(k-h)*(b?.5:d?1:0),y:u-(j-f)*(y?.5:p?1:0),width:k,height:j},a)}}},{key:"_processMove",value:function(t,e){var o=this.options.container,r=this.storage,n=r.transform,a=r.wrapper,s=r.center,i=n.matrix,c=n.trMatrix,l=n.scMatrix,u=n.wrapperMatrix,h=n.parentMatrix;l.e=t,l.f=e;var f=l.multiply(u);a.setAttribute("transform",C(f)),h.e=h.f=0;var v=ue(h.inverse(),o,t,e),d=v.x,p=v.y;c.e=d,c.f=p;var y=c.multiply(i);if(this.el.setAttribute("transform",C(y)),this.storage.cached={dx:d,dy:p,ox:t,oy:e},s.isShifted){var b=u.inverse();b.e=b.f=0;var m=ue(b,o,t,e),x=m.x,g=m.y;this._moveCenterHandle(-x,-g)}}},{key:"_processRotate",value:function(t){var e=this.storage,o=e.center,r=e.transform,n=e.wrapper,a=r.matrix,s=r.wrapperMatrix,i=r.parentMatrix,c=r.trMatrix,l=r.scMatrix,u=r.rotMatrix,h=le(Math.cos(t)),f=le(Math.sin(t));c.e=o.x,c.f=o.y,u.a=h,u.b=f,u.c=-f,u.d=h;var v=c.multiply(u).multiply(c.inverse()).multiply(s);n.setAttribute("transform",C(v)),l.e=o.el_x,l.f=o.el_y,i.e=i.f=0;var d=i.inverse().multiply(u).multiply(i),p=l.multiply(d).multiply(l.inverse()).multiply(a);this.el.setAttribute("transform",C(p))}},{key:"_getState",value:function(t){var e=t.revX,o=t.revY,r=t.doW,n=t.doH,a=this.el,s=this.storage,i=this.options.container,c=s.box,l=s.wrapper,u=s.parent,h=s.handles.center,f=a.getBBox(),v=f.x,d=f.y,p=f.width,y=f.height,b=c.getBBox(),m=b.width,x=b.height,g=b.x,_=b.y,M=rt(a,u),w=rt(a,i),k=rt(c.parentNode,i),j=rt(u,i),E=v+p*(n?.5:e?1:0),T=d+y*(r?.5:o?1:0),A={matrix:M,ctm:w,boxCTM:k,parentMatrix:j,wrapperMatrix:rt(l,l.parentNode),trMatrix:ot(),scMatrix:ot(),rotMatrix:ot(),scaleX:E,scaleY:T,scX:Math.sqrt(w.a*w.a+w.b*w.b),scY:Math.sqrt(w.c*w.c+w.d*w.d),bBox:f},V=g+m/2,S=_+x/2,C=h?h.cx.baseVal.value:V,O=h?h.cy.baseVal.value:S,D=ue(k,i,C,O),P=D.x,R=D.y,N=q(h)?ue(j.inverse(),i,P,R):ue(M,i,v+p/2,d+y/2),z=N.x,X=N.y,Y=ue(rt(c,i),i,V,S),B=Y.x,L=Y.y;return et(a).forEach(function(t){t.__ctm__=rt(t,i)}),{transform:A,cw:m,ch:x,center:{x:h?P:B,y:h?R:L,el_x:z,el_y:X,hx:h?h.cx.baseVal.value:null,hy:h?h.cy.baseVal.value:null,isShifted:le(B,3)!==le(P,3)&&le(L,3)!==le(R,3)},left:g,top:_,revX:e,revY:o,doW:r,doH:n}}},{key:"_moveCenterHandle",value:function(t,e){var o=this.storage,r=o.handles,n=o.center,a=o.radius;U(r.center)||(r.center.cx.baseVal.value=n.hx+t,r.center.cy.baseVal.value=n.hy+e,a.x2.baseVal.value=n.hx+t,a.y2.baseVal.value=n.hy+e)}},{key:"resetCenterPoint",value:function(){var t=this.storage,e=t.box,o=t.handles,r=t.radius,n=o.center,a=this.options.container,s=e.getBBox(),i=s.width,c=s.height,l=s.x,u=s.y,h=ue(rt(e,e.parentNode),a,l+i/2,u+c/2),f=h.x,v=h.y;n.cx.baseVal.value=f,n.cy.baseVal.value=v,n.isShifted=!1,r.x2.baseVal.value=f,r.y2.baseVal.value=v}},{key:"controls",get:function(){return this.storage.wrapper}}]),n}();function $(e,t){var o=t.x,r=t.y,n=[];switch(e.tagName.toLowerCase()){case"use":case"image":case"text":case"rect":var a=q(e.x.baseVal.value)?e.x.baseVal.value+o:(Number(e.getAttribute("x"))||0)+o,s=q(e.y.baseVal.value)?e.y.baseVal.value+r:(Number(e.getAttribute("y"))||0)+r;n.push(["x",a],["y",s]);break;case"circle":case"ellipse":var i=e.cx.baseVal.value+o,c=e.cy.baseVal.value+r;n.push(["cx",i],["cy",c]);break;case"line":var l=e.x1.baseVal.value+o,u=e.y1.baseVal.value+r,h=e.x2.baseVal.value+o,f=e.y2.baseVal.value+r;n.push(["x1",l],["y1",u],["x2",h],["y2",f]);break;case"polygon":case"polyline":var v=nt(e.getAttribute("points")).map(function(t){return t[0]=Number(t[0])+o,t[1]=Number(t[1])+r,t.join(" ")}).join(" ");n.push(["points",v]);break;case"path":var d=e.getAttribute("d");n.push(["d",function(t){var e=t.path,o=t.dx,r=t.dy;try{for(var n=fe(e),a="",s=" ",i=!0,c=0,l=n.length;c<l;c++){var u=n[c],h=u.values,f=u.key,v=u.relative,d=[];switch(f){case"M":for(var p=0,y=h.length;p<y;p+=2){var b=ie(h.slice(p,p+2),2),m=b[0],x=b[1];v&&!i||(m+=o,x+=r),d.push(m,x),i=!1}break;case"A":for(var g=0,_=h.length;g<_;g+=7){var M=h.slice(g,g+7);v||(M[5]+=o,M[6]+=r),d.push.apply(d,W(M))}break;case"C":for(var w=0,k=h.length;w<k;w+=6){var j=h.slice(w,w+6);v||(j[0]+=o,j[1]+=r,j[2]+=o,j[3]+=r,j[4]+=o,j[5]+=r),d.push.apply(d,W(j))}break;case"H":for(var E=0,T=h.length;E<T;E+=1){var A=h.slice(E,E+1);v||(A[0]+=o),d.push(A[0])}break;case"V":for(var V=0,S=h.length;V<S;V+=1){var C=h.slice(V,V+1);v||(C[0]+=r),d.push(C[0])}break;case"L":case"T":for(var O=0,D=h.length;O<D;O+=2){var P=ie(h.slice(O,O+2),2),R=P[0],N=P[1];v||(R+=o,N+=r),d.push(R,N)}break;case"Q":case"S":for(var z=0,X=h.length;z<X;z+=4){var Y=ie(h.slice(z,z+4),4),B=Y[0],L=Y[1],F=Y[2],H=Y[3];v||(B+=o,L+=r,F+=o,H+=r),d.push(B,L,F,H)}break;case"Z":s=h[0]=""}a+=u.cmd+d.join(",")+s}return a}catch(t){ce("Path parsing error: "+t)}}({path:d,dx:o,dy:r})])}n.forEach(function(t){e.setAttribute(t[0],t[1])})}function J(e,t){var o=t.scaleX,r=t.scaleY,n=t.bBox,a=t.defaultCTM,s=t.container,i=n.width,c=n.height,l=[],u=rt(e,s),h=a.inverse().multiply(u);switch(e.tagName.toLowerCase()){case"text":var f=e.x.baseVal.value||Number(e.getAttribute("x")),v=e.y.baseVal.value||Number(e.getAttribute("y")),d=ue(h,s,f,v),p=d.x,y=d.y;l.push(["x",p+(o<0?i:0)],["y",y+(r<0?c:0)]);break;case"circle":var b=e.r.baseVal.value,m=e.cx.baseVal.value,x=e.cy.baseVal.value,g=b*(Math.abs(o)+Math.abs(r))/2,_=ue(h,s,m,x),M=_.x,w=_.y;l.push(["r",g],["cx",M],["cy",w]);break;case"image":case"rect":var k=e.width.baseVal.value,j=e.height.baseVal.value,E=e.x.baseVal.value,T=e.y.baseVal.value,A=ue(h,s,E,T),V=A.x,S=A.y,C=Math.abs(k*o),O=Math.abs(j*r);l.push(["x",V-(o<0?C:0)],["y",S-(r<0?O:0)],["width",C],["height",O]);break;case"ellipse":var D=e.rx.baseVal.value,P=e.ry.baseVal.value,R=e.cx.baseVal.value,N=e.cy.baseVal.value,z=ue(h,s,R,N),X=z.x,Y=z.y,B=ot();B.a=o,B.d=r;var L=ue(B,s,D,P),F=L.x,H=L.y;l.push(["rx",Math.abs(F)],["ry",Math.abs(H)],["cx",X],["cy",Y]);break;case"line":var W=e.x1.baseVal.value,q=e.y1.baseVal.value,U=e.x2.baseVal.value,G=e.y2.baseVal.value,I=ue(h,s,W,q),Q=I.x,Z=I.y,$=ue(h,s,U,G),J=$.x,K=$.y;l.push(["x1",Q],["y1",Z],["x2",J],["y2",K]);break;case"polygon":case"polyline":var tt=nt(e.getAttribute("points")).map(function(t){var e=ue(h,s,Number(t[0]),Number(t[1])),o=e.x,r=e.y;return t[0]=o,t[1]=r,t.join(" ")}).join(" ");l.push(["points",tt]);break;case"path":var et=e.getAttribute("d");l.push(["d",function(t){var e=t.path,o=t.localCTM,r=t.container;try{for(var n=fe(e),a="",s=" ",i=[],c=!0,l=0,u=n.length;l<u;l++){var h=n[l],f=h.values,v=h.key,d=h.relative;switch(v){case"A":for(var p=[],y=0,b=f.length;y<b;y+=7){var m=ie(f.slice(y,y+7),7),x=m[0],g=m[1],_=m[2],M=m[3],w=m[4],k=m[5],j=m[6],E=he(o);d&&(E.e=E.f=0);var T=ue(E,r,k,j),A=T.x,V=T.y;p.push(le(A),le(V)),E.e=E.f=0;var S=ue(E,r,x,g),C=S.x,O=S.y;p.unshift(le(C),le(O),_,M,w)}i.push(p);break;case"C":for(var D=[],P=0,R=f.length;P<R;P+=6){var N=ie(f.slice(P,P+6),6),z=N[0],X=N[1],Y=N[2],B=N[3],L=N[4],F=N[5],H=he(o);d&&(H.e=H.f=0);var W=ue(H,r,z,X),q=W.x,U=W.y,G=ue(H,r,Y,B),I=G.x,Q=G.y,Z=ue(H,r,L,F),$=Z.x,J=Z.y;D.push(le(q),le(U),le(I),le(Q),le($),le(J))}i.push(D);break;case"H":for(var K=[],tt=0,et=f.length;tt<et;tt+=1){var ot=ie(f.slice(tt,tt+1),1)[0],rt=he(o);d&&(rt.e=rt.f=0);var nt=ue(rt,r,ot,0).x;K.push(le(nt))}i.push(K);break;case"V":for(var at=[],st=0,it=f.length;st<it;st+=1){var ct=ie(f.slice(st,st+1),1)[0],lt=he(o);d&&(lt.e=lt.f=0);var ut=ue(lt,r,0,ct).y;at.push(le(ut))}i.push(at);break;case"T":case"L":for(var ht=[],ft=0,vt=f.length;ft<vt;ft+=2){var dt=ie(f.slice(ft,ft+2),2),pt=dt[0],yt=dt[1],bt=he(o);d&&(bt.e=bt.f=0);var mt=ue(bt,r,pt,yt),xt=mt.x,gt=mt.y;ht.push(le(xt),le(gt))}i.push(ht);break;case"M":for(var _t=[],Mt=0,wt=f.length;Mt<wt;Mt+=2){var kt=ie(f.slice(Mt,Mt+2),2),jt=kt[0],Et=kt[1],Tt=he(o);d&&!c&&(Tt.e=Tt.f=0);var At=ue(Tt,r,jt,Et),Vt=At.x,St=At.y;_t.push(le(Vt),le(St)),c=!1}i.push(_t);break;case"Q":for(var Ct=[],Ot=0,Dt=f.length;Ot<Dt;Ot+=4){var Pt=ie(f.slice(Ot,Ot+4),4),Rt=Pt[0],Nt=Pt[1],zt=Pt[2],Xt=Pt[3],Yt=he(o);d&&(Yt.e=Yt.f=0);var Bt=ue(Yt,r,Rt,Nt),Lt=Bt.x,Ft=Bt.y,Ht=ue(Yt,r,zt,Xt),Wt=Ht.x,qt=Ht.y;Ct.push(le(Lt),le(Ft),le(Wt),le(qt))}i.push(Ct);break;case"S":for(var Ut=[],Gt=0,It=f.length;Gt<It;Gt+=4){var Qt=ie(f.slice(Gt,Gt+4),4),Zt=Qt[0],$t=Qt[1],Jt=Qt[2],Kt=Qt[3],te=he(o);d&&(te.e=te.f=0);var ee=ue(te,r,Zt,$t),oe=ee.x,re=ee.y,ne=ue(te,r,Jt,Kt),ae=ne.x,se=ne.y;Ut.push(le(oe),le(re),le(ae),le(se))}i.push(Ut);break;case"Z":i.push([""]),s=""}a+=h.cmd+i[l].join(",")+s}return a}catch(t){ce("Path parsing error: "+t)}}({path:et,localCTM:h,container:s})])}l.forEach(function(t){e.setAttribute(t[0],t[1])})}function K(t,e,o){var r=t.box,n=t.handles,a=t.normalLine,s=t.radius,i=t.center,c=e.x,l=e.y,u=e.width,h=e.height,f=u/2,v=h/2,d=rt(r,r.parentNode),p=ue(d,o,c+f,l+v),y={tl:ue(d,o,c,l),tr:ue(d,o,c+u,l),br:ue(d,o,c+u,l+h),bl:ue(d,o,c,l+h),tc:ue(d,o,c+f,l),bc:ue(d,o,c+f,l+h),ml:ue(d,o,c,l+v),mr:ue(d,o,c+u,l+v),rotator:{},center:!i.isShifted&&q(n.center)?p:void 0},b=Math.atan2(y.tl.y-y.tr.y,y.tl.x-y.tr.x);y.rotator.x=y.mr.x-S*Math.cos(b),y.rotator.y=y.mr.y-S*Math.sin(b),a.x1.baseVal.value=y.mr.x,a.y1.baseVal.value=y.mr.y,a.x2.baseVal.value=y.rotator.x,a.y2.baseVal.value=y.rotator.y,q(s)&&(s.x1.baseVal.value=p.x,s.y1.baseVal.value=p.y,i.isShifted||(s.x2.baseVal.value=p.x,s.y2.baseVal.value=p.y));var m={x:c+=u<0?u:0,y:l+=h<0?h:0,width:Math.abs(u),height:Math.abs(h)};Object.keys(m).forEach(function(t){r.setAttribute(t,m[t])}),Object.keys(y).forEach(function(t){var e=n[t],o=y[t];U(o)||(e.setAttribute("cx",o.x),e.setAttribute("cy",o.y))})}function tt(t){return"g"===t.tagName.toLowerCase()}function et(t){var o=[];return tt(t)?l.call(t.childNodes,function(t){if(1===t.nodeType){var e=t.tagName.toLowerCase();-1!==j.indexOf(e)&&("g"===e&&o.push.apply(o,W(et(t))),o.push(t))}}):o.push(t),o}function nt(t){return t.match(A).reduce(function(t,e,o,r){return o%2==0&&t.push(r.slice(o,o+2)),t},[])}function at(t,e){t.setAttribute("stroke",e),t.setAttribute("stroke-dasharray","3 3"),t.setAttribute("vector-effect","non-scaling-stroke")}function st(o,t){if(this.length){var r=q(t)&&t instanceof m?t:new m;return d.call(this,function(t,e){return e instanceof SVGElement?function(t){var e=t.tagName.toLowerCase();return-1!==j.indexOf(e)||(ce("Selected element is not allowed to transform. Allowed elements:\n"+"circle, ellipse, image, line, path, polygon, polyline, rect, text, g"),!1)}(e)&&t.push(new L(e,o,r)):t.push(new g(e,o,r)),t},[])}}var it=function(){function o(t,e){s(this,o),this.el=t,this.options=e||{},this.storage=null,this._onMouseDown=this._onMouseDown.bind(this),this._onTouchStart=this._onTouchStart.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this._onTouchMove=this._onTouchMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._onTouchEnd=this._onTouchEnd.bind(this),this._animate=this._animate.bind(this),this.enable()}return i(o,[{key:"enable",value:function(){U(this.storage)?this._init():ce("Already enabled")}},{key:"disable",value:function(){this._destroy()}},{key:"_init",value:function(){var t=this,e=t.el,o=t.options,r=F(e),n=o.style,a=o.onDrop,s=o.appendTo,i=o.stack,c={position:"absolute","z-index":"2147483647",style:q(n)&&"object"===h(n)?n:void 0},l=q(i)?F(i)[0]:document,u=p(a)?function(t){var e=this.storage.clone;!function(t,e){var o=P(t),r=o.top,n=o.left,a=P(e),s=a.top,i=a.left,c=F(t),l=F(e);return!(r<s||r+parseFloat(c.css("height"))>s+parseFloat(l.css("height"))||n<i||n+parseFloat(c.css("width"))>i+parseFloat(l.css("width")))}(e,l)||a.call(this,t,this.el,e)}:function(){};t.storage={onDrop:u,options:o,css:c,parent:q(s)?F(s)[0]:document.body,stack:l},r.on("mousedown",t._onMouseDown).on("touchstart",t._onTouchStart)}},{key:"_start",value:function(t){var e=this.storage,o=this.el,r=e.parent,n=e.css,a=P(r),s=t.clientX,i=t.clientY;n.left="".concat(s-a.left,"px"),n.top="".concat(i-a.top,"px");var c=o.cloneNode(!0);F(c).css(n),e.clientX=s,e.clientY=i,e.cx=s,e.cy=i,e.clone=c,F(r)[0].appendChild(c),this._draw()}},{key:"_move",value:function(t){var e=this.storage;e.clientX=t.clientX,e.clientY=t.clientY,e.doDraw=!0,e.doMove=!0}},{key:"_end",value:function(t){var e=this.storage,o=e.clone,r=e.frameId,n=e.onDrop;e.doDraw=!1,u(r),U(o)||(n.call(this,t),o.parentNode.removeChild(o),delete e.clone)}},{key:"_draw",value:function(){this._animate()}},{key:"_animate",value:function(){var t=this.storage;t.frameId=H(this._animate);var e=t.doDraw,o=t.clientX,r=t.clientY,n=t.cx,a=t.cy,s=t.clone;if(e){t.doDraw=!1;var i="translate(".concat(o-n,"px, ").concat(r-a,"px)");F(s).css({transform:i,webkitTranform:i,mozTransform:i,msTransform:i,otransform:i})}}},{key:"_destroy",value:function(){U(this.storage)||(F(this.el).off("mousedown",this._onMouseDown).off("touchstart",this._onTouchStart),delete this.storage)}},{key:"_onMouseDown",value:function(t){this._start(t),F(document).on("mousemove",this._onMouseMove).on("mouseup",this._onMouseUp)}},{key:"_onMouseMove",value:function(t){t.preventDefault&&t.preventDefault(),this._move(t)}},{key:"_onMouseUp",value:function(t){this._end(t),F(document).off("mousemove",this._onMouseMove).off("mouseup",this._onMouseUp)}},{key:"_onTouchStart",value:function(t){this._start(t.touches[0]),F(document).on("touchmove",this._onTouchMove,n).on("touchend",this._onTouchEnd,n)}},{key:"_onTouchMove",value:function(t){t.preventDefault&&t.preventDefault(),this._move(t.touches[0])}},{key:"_onTouchEnd",value:function(t){0===t.touches.length&&this._end(t.changedTouches[0]),F(document).off("touchmove",this._onTouchMove,n).off("touchend",this._onTouchEnd,n)}}]),o}();function ct(e){if(this.length)return v.call(this,function(t){return new it(t,e)})}var lt=function(){function e(t){return s(this,e),c(this,a(e).call(this,t))}return t(e,y),i(e,[{key:"drag",value:function(){return st.call.apply(st,[this].concat(Array.prototype.slice.call(arguments)))}},{key:"clone",value:function(){return ct.call.apply(ct,[this].concat(Array.prototype.slice.call(arguments)))}}]),e}();function ut(t){return new lt(t)}return Object.defineProperty(ut,"createObservable",{value:function(){return new m}}),Object.defineProperty(ut,"Subjx",{value:lt}),Object.defineProperty(ut,"Observable",{value:m}),ut});
