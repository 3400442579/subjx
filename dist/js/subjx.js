/*@license
* Drag/Rotate/Resize Library
* Released under the MIT license, 2018-2020
* Karen Sarksyan
* nichollascarter@gmail.com
*/
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).subjx=e()}(this,function(){"use strict";function W(t){return(W="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function n(t,e,n){return e&&r(t.prototype,e),n&&r(t,n),t}function e(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function L(o){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?e(Object(i),!0).forEach(function(t){var e,n,r;e=o,r=i[n=t],n in e?Object.defineProperty(e,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[n]=r}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(i)):e(Object(i)).forEach(function(t){Object.defineProperty(o,t,Object.getOwnPropertyDescriptor(i,t))})}return o}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&i(t,e)}function o(t){return(o=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function i(t,e){return(i=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function d(t,e){if(null==t)return{};var n,r,o=function(t,e){if(null==t)return{};var n,r,o={},i=Object.keys(t);for(r=0;r<i.length;r++)n=i[r],0<=e.indexOf(n)||(o[n]=t[n]);return o}(t,e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);for(r=0;r<i.length;r++)n=i[r],0<=e.indexOf(n)||Object.prototype.propertyIsEnumerable.call(t,n)&&(o[n]=t[n])}return o}function c(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function u(r){return function(){var t,e=o(r);if(function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}()){var n=o(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return c(this,t)}}function D(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var n=[],r=!0,o=!1,i=void 0;try{for(var s,a=t[Symbol.iterator]();!(r=(s=a.next()).done)&&(n.push(s.value),!e||n.length!==e);r=!0);}catch(t){o=!0,i=t}finally{try{r||null==a["return"]||a["return"]()}finally{if(o)throw i}}return n}(t,e)||l(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function j(t){return function(t){if(Array.isArray(t))return h(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||l(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function l(t,e){if(t){if("string"==typeof t)return h(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?h(t,e):void 0}}function h(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function U(t){return null==t}function I(t){return function(t){return"function"==typeof t}(t)?function(){t.call.apply(t,[this].concat(Array.prototype.slice.call(arguments)))}:function(){}}var B=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||function(t){return setTimeout(t,1e3/60)},p=window.cancelAnimationFrame||window.mozCancelAnimationFrame||function(t){clearTimeout(t)},t=Array.prototype,f=t.slice,v=t.reduce,y=console.warn,V=function(t){return null!=t},m=function(){function i(t){if(s(this,i),"string"==typeof t){var e=document.querySelectorAll(t);this.length=e.length;for(var n=0;n<this.length;n++)this[n]=e[n]}else if("object"!==W(t)||1!==t.nodeType&&t!==document)if(t instanceof i){this.length=t.length;for(var r=0;r<this.length;r++)this[r]=t[r]}else{if(!function(t){return V(t)&&"object"===W(t)&&(Array.isArray(t)||V(window.Symbol)&&"function"==typeof t[window.Symbol.iterator]||V(t.forEach)||"number"==typeof t.length&&(0===t.length||0<t.length&&t.length-1 in t))}(t))throw new Error("Passed parameter must be selector/element/elementArray");for(var o=this.length=0;o<this.length;o++)1===t.nodeType&&(this[o]=t[o],this.length++)}else this[0]=t,this.length=1}return n(i,[{key:"css",value:function(n){var t={setStyle:function(t){return function(t,e){for(var n=t.length;n--;)for(var r in e)t[n].style[r]=e[r];return t.style}(this,t)},getStyle:function(){return function(t){for(var e=t.length;e--;)return t[e].currentStyle?t[e].currentStyle[n]:document.defaultView&&document.defaultView.getComputedStyle?document.defaultView.getComputedStyle(t[e],"")[n]:t[e].style[n]}(this)}};return"string"==typeof n?t.getStyle.apply(this,f.call(arguments,1)):"object"!==W(n)&&n?(y("Method ".concat(n," does not exist")),!1):t.setStyle.apply(this,arguments)}},{key:"on",value:function(t,e,n,r){for(var o=this.length;o--;)this[o].events||(this[o].events={},this[o].events[t]=[]),"string"!=typeof e?document.addEventListener?this[o].addEventListener(t,e,n||{passive:!1}):document.attachEvent?this[o].attachEvent("on".concat(t),e):this[o]["on".concat(t)]=e:b(this[o],t,e,n,r,!0);return this}},{key:"off",value:function(t,e,n,r){for(var o=this.length;o--;)this[o].events||(this[o].events={},this[o].events[t]=[]),"string"!=typeof e?document.removeEventListener?this[o].removeEventListener(t,e,n):document.detachEvent?this[o].detachEvent("on".concat(t),e):this[o]["on".concat(t)]=null:b(this[o],t,e,n,r,!1);return this}},{key:"is",value:function(t){if(U(t))return!1;for(var e=q(t),n=this.length;n--;)if(this[n]===e[n])return!0;return!1}}]),i}();function b(t,e,n,r,o,i){function s(t){for(var e=t.target;e&&e!==this;)e.matches(n)&&r.call(e,t),e=e.parentNode}!0===i?document.addEventListener?t.addEventListener(e,s,o||{passive:!1}):document.attachEvent?t.attachEvent("on".concat(e),s):t["on".concat(e)]=s:document.removeEventListener?t.removeEventListener(e,s,o||{passive:!1}):document.detachEvent?t.detachEvent("on".concat(e),s):t["on".concat(e)]=null}function q(t){return new m(t)}function G(t,e){if(0===e)return t;var n=z(t,e);return n-t<e?n:void 0}function x(t,e){var n=1<arguments.length&&void 0!==e?e:6;return Number(t.toFixed(n))}function H(t){return t.getBoundingClientRect()}function X(t){return t.css("-webkit-transform")||t.css("-moz-transform")||t.css("-ms-transform")||t.css("-o-transform")||t.css("transform")||"none"}function Y(t){var e=t.match(/[+\-]?(?:0|[1-9]\d*)(?:\.\d*)?(?:[eE][+\-]?\d+)?/g);return e?e.map(function(t){return parseFloat(t)}):[1,0,0,1,0,0]}function $(e,t){if(t){if(e.classList){if(!(-1<t.indexOf(" ")))return e.classList.add(t);t.split(/\s+/).forEach(function(t){return e.classList.add(t)})}return e}}function F(e,t){if(t){if(e.classList){if(!(-1<t.indexOf(" ")))return e.classList.remove(t);t.split(/\s+/).forEach(function(t){return e.classList.remove(t)})}return e}}function M(t){var e="matrix(".concat(t.join(),")");return{transform:e,webkitTranform:e,mozTransform:e,msTransform:e,otransform:e}}function P(t,e){var n=t.x,r=t.y,o=D(e,6),i=o[0],s=o[1],a=o[2],c=o[3];return{x:i*n+a*r+o[4],y:s*n+c*r+o[5]}}function A(t){var e=[[t[0],t[2],t[4]],[t[1],t[3],t[5]],[0,0,1]];if(e.length===e[0].length){for(var n=e.length,r=[],o=[],i=0;i<n;i+=1){r[r.length]=[],o[o.length]=[];for(var s=0;s<n;s+=1)r[i][s]=i==s?1:0,o[i][s]=e[i][s]}for(var a=0;a<n;a+=1){var c=o[a][a];if(0===c){for(var u=a+1;u<n;u+=1)if(0!==o[u][a]){for(var l=0;l<n;l++)c=o[a][l],o[a][l]=o[u][l],o[u][l]=c,c=r[a][l],r[a][l]=r[u][l],r[u][l]=c;break}if(0===(c=o[a][a]))return}for(var h=0;h<n;h++)o[a][h]=o[a][h]/c,r[a][h]=r[a][h]/c;for(var f=0;f<n;f++)if(f!=a){c=o[f][a];for(var d=0;d<n;d++)o[f][d]-=c*o[a][d],r[f][d]-=c*r[a][d]}}return[r[0][0],r[1][0],r[0][1],r[1][1],r[0][2],r[1][2]]}}function R(t,e,n,r,o,i,s,a,c){var u=parseFloat(n)/2,l=parseFloat(r)/2,h=t+u,f=e+l,d=t-h,v=e-f,y=Math.atan2(a?0:v,c?0:d)+o,p=Math.sqrt(Math.pow(c?0:u,2)+Math.pow(a?0:l,2)),m=Math.cos(y),b=Math.sin(y),g=f+p*(b=!0===s?-b:b);return{left:x(h+p*(m=!0===i?-m:m)),top:x(g)}}var g=function(){function t(){s(this,t),this.observers={}}return n(t,[{key:"subscribe",value:function(t,e){var n=this.observers;return U(n[t])&&Object.defineProperty(n,t,{value:[]}),n[t].push(e),this}},{key:"unsubscribe",value:function(t,e){var n=this.observers;if(V(n[t])){var r=n[t].indexOf(e);n[t].splice(r,1)}return this}},{key:"notify",value:function(e,n,r){U(this.observers[e])||this.observers[e].forEach(function(t){if(n!==t)switch(e){case"onmove":t.notifyMove(r);break;case"onrotate":t.notifyRotate(r);break;case"onresize":t.notifyResize(r);break;case"onapply":t.notifyApply(r);break;case"ongetstate":t.notifyGetState(r)}})}}]),t}(),_=function(){function e(t){s(this,e),this.name=t,this.callbacks=[]}return n(e,[{key:"registerCallback",value:function(t){this.callbacks.push(t)}},{key:"removeCallback",value:function(t){var e=this.callbacks(t);this.callbacks.splice(e,1)}}]),e}(),k=function(){function t(){s(this,t),this.events={}}return n(t,[{key:"registerEvent",value:function(t){this.events[t]=new _(t)}},{key:"emit",value:function(e,t,n){this.events[t].callbacks.forEach(function(t){t.call(e,n)})}},{key:"addEventListener",value:function(t,e){this.events[t].registerCallback(e)}},{key:"removeEventListener",value:function(t,e){this.events[t].removeCallback(e)}}]),t}(),E=function(){function e(t){s(this,e),this.el=t,this.storage=null,this.proxyMethods=null,this.eventDispatcher=new k,this._onMouseDown=this._onMouseDown.bind(this),this._onTouchStart=this._onTouchStart.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this._onTouchMove=this._onTouchMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._onTouchEnd=this._onTouchEnd.bind(this),this._animate=this._animate.bind(this)}return n(e,[{key:"enable",value:function(t){this._processOptions(t),this._init(this.el),this.proxyMethods.onInit.call(this,this.el)}},{key:"disable",value:function(){w()}},{key:"_init",value:function(){w()}},{key:"_destroy",value:function(){w()}},{key:"_processOptions",value:function(){w()}},{key:"_start",value:function(){w()}},{key:"_moving",value:function(){w()}},{key:"_end",value:function(){w()}},{key:"_animate",value:function(){w()}},{key:"_drag",value:function(t){var e=t.dx,n=t.dy,r=d(t,["dx","dy"]),o=L({dx:e,dy:n,transform:this._processMove(e,n)},r);this.proxyMethods.onMove.call(this,o),this._emitEvent("drag",o)}},{key:"_draw",value:function(){this._animate()}},{key:"_onMouseDown",value:function(t){this._start(t),q(document).on("mousemove",this._onMouseMove).on("mouseup",this._onMouseUp)}},{key:"_onTouchStart",value:function(t){this._start(t.touches[0]),q(document).on("touchmove",this._onTouchMove).on("touchend",this._onTouchEnd)}},{key:"_onMouseMove",value:function(t){t.preventDefault&&t.preventDefault(),this._moving(t,this.el)}},{key:"_onTouchMove",value:function(t){t.preventDefault&&t.preventDefault(),this._moving(t.touches[0],this.el)}},{key:"_onMouseUp",value:function(t){q(document).off("mousemove",this._onMouseMove).off("mouseup",this._onMouseUp),this._end(t,this.el)}},{key:"_onTouchEnd",value:function(t){q(document).off("touchmove",this._onTouchMove).off("touchend",this._onTouchEnd),0===t.touches.length&&this._end(t.changedTouches[0],this.el)}},{key:"_emitEvent",value:function(){var t;(t=this.eventDispatcher).emit.apply(t,[this].concat(Array.prototype.slice.call(arguments)))}},{key:"on",value:function(t,e){return this.eventDispatcher.addEventListener(t,e),this}},{key:"off",value:function(t,e){return this.eventDispatcher.removeEventListener(t,e),this}}]),e}(),w=function(){throw Error("Method not implemented")},O=["dragStart","drag","dragEnd","resizeStart","resize","resizeEnd","rotateStart","rotate","rotateEnd","setPointStart","setPointEnd"],z=function(t,e){return 0===e?t:Math.round(t/e)*e},S=function(){a(i,E);var o=u(i);function i(t,e,n){var r;if(s(this,i),(r=o.call(this,t)).constructor===i)throw new TypeError("Cannot construct Transformable instances directly");return r.observable=n,O.forEach(function(t){r.eventDispatcher.registerEvent(t)}),r.enable(e),r}return n(i,[{key:"_cursorPoint",value:function(){throw Error("'_cursorPoint()' method not implemented")}},{key:"_resize",value:function(t){var e=t.dx,n=t.dy,r=d(t,["dx","dy"]),o=L({},this._processResize(e,n),{dx:e,dy:n},r);this.proxyMethods.onResize.call(this,o),this._emitEvent("resize",o)}},{key:"_processOptions",value:function(t){var e=this.el;$(e,"sjx-drag");var n={x:10,y:10},r={move:!1,resize:!1},o=null,i=!1,s="xy",a="auto",c="auto",u=!0,l=!0,h=null,f=null,d=null,v=function(){},y=function(){},p=function(){},m=function(){},b=function(){},g=e.parentNode;if(V(t)){var x=t.snap,_=t.each,k=t.axis,E=t.cursorMove,w=t.cursorResize,j=t.restrict,M=t.draggable,O=t.resizable,z=t.onInit,S=t.onDrop,T=t.onMove,D=t.onResize,X=t.onDestroy,Y=t.container,P=t.proportions,A=t.custom,R=t.resizeHandles,C=t.className;if(V(x)){var L=x.x,H=x.y;n.x=U(L)?10:L,n.y=U(H)?10:H}if(V(_)){var F=_.move,N=_.resize;r.move=F||!1,r.resize=N||!1}V(j)&&(o="parent"===j?e.parentNode:q(j)[0]||document),a=E||"auto",c=w||"auto",s=k||"xy",g=V(Y)&&q(Y)[0]?q(Y)[0]:g,i=P||!1,u=!V(M)||M,l=!V(O)||O,h="object"===W(A)&&A||null,f=V(R)?R:null,d=V(C)?C:null,v=I(z),m=I(S),y=I(T),p=I(D),b=I(X)}this.options={axis:s,cursorMove:a,cursorResize:c,restrict:o,container:g,snap:n,each:r,proportions:i,draggable:u,resizable:l,custom:h,resizeHandles:f,className:d},this.proxyMethods={onInit:v,onDrop:m,onMove:y,onResize:p,onDestroy:b},this.subscribe(r)}},{key:"_animate",value:function(){var t=this,e=t.observable,n=t.storage,r=t.options;if(!U(n)&&(n.frame=B(t._animate),n.doDraw)){n.doDraw=!1;var o=n.dox,i=n.doy,s=n.clientX,a=n.clientY,c=n.doDrag,u=n.doResize,l=n.revX,h=n.revY,f=r.snap,d=r.each,v=d.move,y=d.resize,p=r.restrict,m=r.draggable,b=r.resizable;if(u&&b){var g=n.transform,x=n.cx,_=n.cy,k=this._pointToElement({x:s,y:a}),E=k.x,w=k.y,j=o?G(E-x,f.x/g.scX):0,M=i?G(w-_,f.y/g.scY):0,O={dx:j=o?l?-j:j:0,dy:M=i?h?-M:M:0,clientX:s,clientY:a};t._resize(O),y&&e.notify("onresize",t,O)}if(c&&m){var z=n.restrictOffset,S=n.elementOffset,T=n.nx,D=n.ny;if(V(p)){var X=z.left,Y=z.top,P=S.left,A=S.top,R=S.width,C=S.height,L=T-s,H=D-a,F=p.clientWidth-R,N=p.clientHeight-C,W=A-Y,I=P-X;W-H<0&&(a=D-A+Y),I-L<0&&(s=T-P+X),N<W-H&&(a=N+(D-A+Y)),F<I-L&&(s=F+(T-P+X))}var q={dx:o?G(s-T,f.x):0,dy:i?G(a-D,f.y):0,clientX:s,clientY:a};t._drag(q),v&&e.notify("onmove",t,q)}}}},{key:"_start",value:function(t){var e=this.observable,n=this.storage,r=this.options,o=r.axis,i=r.restrict,s=r.each,a=this.el,c=this._compute(t);Object.keys(c).forEach(function(t){n[t]=c[t]});var u=c.onRightEdge,l=c.onBottomEdge,h=c.onTopEdge,f=c.onLeftEdge,d=c.handle,v=c.factor,y=c.revX,p=c.revY,m=c.doW,b=c.doH,g=u||l||h||f,x=n.handles,_=x.radius;V(_)&&F(_,"sjx-hidden");var k=!g,E=t.clientX,w=t.clientY,j=this._cursorPoint({clientX:E,clientY:w}),M=j.x,O=j.y,z=this._pointToElement({x:M,y:O}),S=z.x,T=z.y,D=this._pointToControls({x:M,y:O}),X={clientX:E,clientY:w,nx:M,ny:O,cx:S,cy:T,bx:D.x,by:D.y,doResize:g,doDrag:k,onExecution:!0,cursor:null,elementOffset:H(a),restrictOffset:V(i)?H(i):null,dox:/\x/.test(o)&&(!g||(d.is(x.ml)||d.is(x.mr)||d.is(x.tl)||d.is(x.tr)||d.is(x.bl)||d.is(x.br))),doy:/\y/.test(o)&&(!g||(d.is(x.br)||d.is(x.bl)||d.is(x.bc)||d.is(x.tr)||d.is(x.tl)||d.is(x.tc)))};this.storage=L({},n,{},X);var Y={clientX:E,clientY:w};g?this._emitEvent("resizeStart",Y):k&&this._emitEvent("dragStart",Y);var P=s.move,A=s.resize,R=g?"resize":"drag",C=g&&A||k&&P;e.notify("ongetstate",this,{clientX:E,clientY:w,actionName:R,triggerEvent:C,factor:v,revX:y,revY:p,doW:m,doH:b}),this._draw()}},{key:"_moving",value:function(t){var e=this.storage,n=this.options,r=this._cursorPoint(t),o=r.x,i=r.y;e.e=t,e.clientX=o,e.clientY=i,e.doDraw=!0;var s=e.doDrag,a=e.doResize,c=e.cursor,u=n.cursorMove,l=n.cursorResize;U(c)&&(s?c=u:a&&(c=l),q(document.body).css({cursor:c}))}},{key:"_end",value:function(t){var e=t.clientX,n=t.clientY,r=this.options.each,o=this.observable,i=this.storage,s=this.proxyMethods,a=i.doResize,c=i.doDrag,u=i.frame,l=i.handles.radius,h=a?"resize":"drag";i.doResize=!1,i.doDrag=!1,i.doSetCenter=!1,i.doDraw=!1,i.onExecution=!1,i.cursor=null,this._apply(h);var f={clientX:e,clientY:n};s.onDrop.call(this,f),a?this._emitEvent("resizeEnd",f):c&&this._emitEvent("dragEnd",f);var d=r.move,v=r.resize,y=a&&v||c&&d;o.notify("onapply",this,{clientX:e,clientY:n,actionName:h,triggerEvent:y}),p(u),q(document.body).css({cursor:"auto"}),V(l)&&$(l,"sjx-hidden")}},{key:"_compute",value:function(t){var e=this.storage.handles,n=q(t.target),r=this._checkHandles(n,e),o=r.revX,i=r.revY,s=r.doW,a=r.doH,c=d(r,["revX","revY","doW","doH"]),u=this._getState({revX:o,revY:i,doW:s,doH:a}),l=this._cursorPoint(t),h=l.x,f=l.y;return L({},u,{},c,{handle:n,pressang:Math.atan2(f-u.center.y,h-u.center.x)})}},{key:"_checkHandles",value:function(t,e){var n=e.tl,r=e.tc,o=e.tr,i=e.bl,s=e.br,a=e.bc,c=e.ml,u=e.mr,l=!!V(n)&&t.is(n),h=!!V(r)&&t.is(r),f=!!V(o)&&t.is(o),d=!!V(i)&&t.is(i),v=!!V(a)&&t.is(a),y=!!V(s)&&t.is(s),p=!!V(c)&&t.is(c),m=!!V(u)&&t.is(u);return{revX:l||p||d||h,revY:l||f||h||p,onTopEdge:h||f||l,onLeftEdge:l||p||d,onRightEdge:f||m||y,onBottomEdge:y||v||d,doW:p||m,doH:h||v}}},{key:"notifyMove",value:function(){this._drag.apply(this,arguments)}},{key:"notifyResize",value:function(){this._resize.apply(this,arguments)}},{key:"notifyApply",value:function(t){var e=t.clientX,n=t.clientY,r=t.actionName,o=t.triggerEvent;this.proxyMethods.onDrop.call(this,{clientX:e,clientY:n}),o&&(this._apply(r),this._emitEvent("".concat(r,"End"),{clientX:e,clientY:n}))}},{key:"notifyGetState",value:function(t){var e=t.clientX,n=t.clientY,r=t.actionName,o=t.triggerEvent,i=d(t,["clientX","clientY","actionName","triggerEvent"]);if(o){var s=this._getState(i);this.storage=L({},this.storage,{},s),this._emitEvent("".concat(r,"Start"),{clientX:e,clientY:n})}}},{key:"subscribe",value:function(t){var e=t.resize,n=t.move,r=this.observable;(n||e)&&r.subscribe("ongetstate",this).subscribe("onapply",this),n&&r.subscribe("onmove",this),e&&r.subscribe("onresize",this)}},{key:"unsubscribe",value:function(){this.observable.unsubscribe("ongetstate",this).unsubscribe("onapply",this).unsubscribe("onmove",this).unsubscribe("onresize",this)}},{key:"disable",value:function(){var t=this.storage,e=this.proxyMethods,n=this.el;U(t)||(t.onExecution&&(this._end(),q(document).off("mousemove",this._onMouseMove).off("mouseup",this._onMouseUp).off("touchmove",this._onTouchMove).off("touchend",this._onTouchEnd)),F(n,"sjx-drag"),this._destroy(),this.unsubscribe(),e.onDestroy.call(this,n),delete this.storage)}},{key:"exeDrag",value:function(t){var e=t.dx,n=t.dy;this.options.draggable&&(this.storage=L({},this.storage,{},this._getState({revX:!1,revY:!1,doW:!1,doH:!1})),this._drag({dx:e,dy:n}),this._apply("drag"))}},{key:"exeResize",value:function(t){var e=t.dx,n=t.dy,r=t.revX,o=t.revY,i=t.doW,s=t.doH;this.options.resizable&&(this.storage=L({},this.storage,{},this._getState({revX:r||!1,revY:o||!1,doW:i||!1,doH:s||!1})),this._resize({dx:e,dy:n}),this._apply("resize"))}}]),i}(),T=2,C=7,N=function(){a(e,S);var t=u(e);function e(){return s(this,e),t.apply(this,arguments)}return n(e,[{key:"_init",value:function(t){var e=this.options,n=e.container,r=e.resizable,o=e.resizeHandles,i=e.className,s=t.style,a=s.left,c=s.top,u=s.width,l=s.height,h=document.createElement("div");$(h,"sjx-wrapper"),V(i)&&$(h,i),n.appendChild(h);var f=q(t),d=u||f.css("width"),v=l||f.css("height"),y={top:c||f.css("top"),left:a||f.css("left"),width:d,height:v,transform:X(f)},p=document.createElement("div");$(p,"sjx-controls");var m=L({},r&&{tl:["sjx-hdl","sjx-hdl-t","sjx-hdl-l","sjx-hdl-tl"],tr:["sjx-hdl","sjx-hdl-t","sjx-hdl-r","sjx-hdl-tr"],br:["sjx-hdl","sjx-hdl-b","sjx-hdl-r","sjx-hdl-br"],bl:["sjx-hdl","sjx-hdl-b","sjx-hdl-l","sjx-hdl-bl"],tc:["sjx-hdl","sjx-hdl-t","sjx-hdl-c","sjx-hdl-tc"],bc:["sjx-hdl","sjx-hdl-b","sjx-hdl-c","sjx-hdl-bc"],ml:["sjx-hdl","sjx-hdl-m","sjx-hdl-l","sjx-hdl-ml"],mr:["sjx-hdl","sjx-hdl-m","sjx-hdl-r","sjx-hdl-mr"]});Object.keys(m).forEach(function(t){var e=o[t];if(!V(e)||0!=e){var n=m[t];if(!U(n)){var r=J(n);m[t]=r,p.appendChild(r)}}}),V(m.center)&&q(m.center).css({left:"".concat(t.getAttribute("data-cx"),"px"),top:"".concat(t.getAttribute("data-cy"),"px")});h.appendChild(p);var b=q(p);b.css(y),this.storage={controls:p,handles:m,radius:void 0,parent:t.parentNode},b.on("mousedown",this._onMouseDown).on("touchstart",this._onTouchStart)}},{key:"_destroy",value:function(){var t=this.storage.controls;q(t).off("mousedown",this._onMouseDown).off("touchstart",this._onTouchStart);var e=t.parentNode;e.parentNode.removeChild(e)}},{key:"_pointToElement",value:function(t){var e=t.x,n=t.y,r=j(this.storage.transform.matrix);return r[4]=r[5]=0,this._applyMatrixToPoint(A(r),e,n)}},{key:"_pointToControls",value:function(t){return this._pointToElement(t)}},{key:"_applyMatrixToPoint",value:function(t,e,n){return P({x:e,y:n},t)}},{key:"_cursorPoint",value:function(t){var e=t.clientX,n=t.clientY,r=this.options.container,o=Y(X(q(r)));return P({x:e,y:n},A(o))}},{key:"_apply",value:function(){var t=this.el,e=this.storage,n=e.controls,r=e.handles,o=q(n),i=parseFloat(o.css("width"))/2,s=parseFloat(o.css("height"))/2,a=r.center,c=V(a),u=c?parseFloat(q(a).css("left")):i,l=c?parseFloat(q(a).css("top")):s;t.setAttribute("data-cx",u),t.setAttribute("data-cy",l),this.storage.cached=null}},{key:"_processResize",value:function(t,e){var n=this.el,r=this.storage,o=this.options.proportions,i=r.controls,s=r.coords,a=r.cw,c=r.ch,u=r.transform,l=r.refang,h=r.revX,f=r.revY,d=r.doW,v=r.doH,y=r.restrictOffset,p=r.handle,m=d||!d&&!v?(a+t)/a:(c+e)/c,b=o?a*m:a+t,g=o?c*m:c+e;if(!(b<=T||g<=T)){var x=j(u.matrix);V(y)&&(0<t&&(-1<p[0].className.indexOf("sjx-hdl-l")?x[4]-t<0&&(b=a+x[4]):b+x[4]>y.width&&(b=y.width-x[4])),0<e&&(-1<p[0].className.indexOf("sjx-hdl-l")?x[5]-t<0&&(b=c+x[5]):g+x[5]>y.height&&(g=y.height-x[5])));var _=R(x[4],x[5],b,g,l,h,f,d,v),k=s.left-_.left,E=s.top-_.top;x[4]+=k,x[5]+=E;var w=M(x);return w.width="".concat(b,"px"),w.height="".concat(g,"px"),q(i).css(w),q(n).css(w),r.cached={dx:k,dy:E},{width:b,height:g,ox:k,oy:E}}}},{key:"_processMove",value:function(t,e){var n=this.el,r=this.storage,o=r.controls,i=r.transform,s=i.matrix,a=j(i.parentMatrix);a[4]=a[5]=0;var c=j(s);c[4]=s[4]+t,c[5]=s[5]+e;var u=M(c);return q(o).css(u),q(n).css(u),r.cached={dx:t,dy:e},c}},{key:"_getState",value:function(t){var e=t.revX,n=t.revY,r=t.doW,o=t.doH,i=e!==n?-1:1,s=this.el,a=this.storage,c=a.handles,u=a.controls,l=a.parent,h=this.options.container,f=c.center,d=q(u),v=Y(X(q(h))),y=Y(X(q(u))),p=Y(X(q(l))),m=Math.atan2(y[1],y[0])*i,b=l!==h?function(t,e){for(var n=D(t,6),r=n[0],o=n[1],i=n[2],s=n[3],a=n[4],c=n[5],u=D(e,6),l=u[0],h=u[1],f=u[2],d=u[3],v=[[r,i,a],[o,s,c],[0,0,1]],y=[[l,f,u[4]],[h,d,u[5]],[0,0,1]],p=[],m=0;m<y.length;m++){p[m]=[];for(var b=0;b<v[0].length;b++){for(var g=0,x=0;x<v.length;x++)g+=v[x][b]*y[m][x];p[m].push(g)}}return[p[0][0],p[1][0],p[0][1],p[1][1],p[0][2],p[1][2]]}(p,v):v,g={matrix:y,parentMatrix:b,scX:Math.sqrt(y[0]*y[0]+y[1]*y[1]),scY:Math.sqrt(y[2]*y[2]+y[3]*y[3])},x=parseFloat(d.css("width")),_=parseFloat(d.css("height")),k=R(y[4],y[5],x,_,m,e,n,r,o),E=x/2,w=_/2,j=H(s),M=V(f),O=M?parseFloat(q(f).css("left")):E,z=M?parseFloat(q(f).css("top")):w,S=M?C:0,T=P({x:j.left,y:j.top},A(b));return{transform:g,cw:x,ch:_,coords:k,center:{x:T.x+O-S,y:T.y+z-S,cx:-O+E-S,cy:-z+w-S,hx:O,hy:z},factor:i,refang:m,revX:e,revY:n,doW:r,doH:o}}},{key:"_moveCenterHandle",value:function(t,e){var n=this.storage,r=n.handles.center,o=n.center,i=o.hx,s=o.hy,a="".concat(i+t,"px"),c="".concat(s+e,"px");q(r).css({left:a,top:c})}},{key:"fitControlsToSize",value:function(){}},{key:"controls",get:function(){return this.storage.controls}}]),e}(),J=function(t){var e=document.createElement("div");return t.forEach(function(t){$(e,t)}),e};function K(n,t){if(this.length){var r=V(t)&&t instanceof g?t:new g;return v.call(this,function(t,e){return t.push(new N(e,n,r)),t},[])}}var Q=function(){a(e,m);var t=u(e);function e(){return s(this,e),t.apply(this,arguments)}return n(e,[{key:"drag",value:function(){return K.call.apply(K,[this].concat(Array.prototype.slice.call(arguments)))}}]),e}();function Z(t){return new Q(t)}return Object.defineProperty(Z,"createObservable",{value:function(){return new g}}),Object.defineProperty(Z,"Subjx",{value:Q}),Object.defineProperty(Z,"Observable",{value:g}),Z});
