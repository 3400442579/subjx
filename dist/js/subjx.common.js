"use strict";const eventOptions={passive:!1},requestAnimFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||function(t){return setTimeout(t,1e3/60)},cancelAnimFrame=window.cancelAnimationFrame||window.mozCancelAnimationFrame||function(t){clearTimeout(t)},forEach=Array.prototype.forEach,arrSlice=Array.prototype.slice,arrMap=Array.prototype.map,arrReduce=Array.prototype.reduce,warn=console.warn;function isDef(t){return null!=t}function isUndef(t){return null==t}function isFunc(t){return"function"==typeof t}class Helper{constructor(t){if("string"==typeof t){let e=document.querySelectorAll(t);this.length=e.length;for(let t=0;t<this.length;t++)this[t]=e[t]}else if("object"!=typeof t||1!==t.nodeType&&t!==document)if(t instanceof Helper){this.length=t.length;for(let e=0;e<this.length;e++)this[e]=t[e]}else{if(!isIterable(t))throw new Error("Passed parameter must be selector/element/elementArray");this.length=0;for(let e=0;e<this.length;e++)1===t.nodeType&&(this[e]=t[e],this.length++)}else this[0]=t,this.length=1}css(t){const e={setStyle(t){return((t,e)=>{let o=t.length;for(;o--;)for(let s in e)t[o].style[s]=e[s];return t.style})(this,t)},getStyle(){return(e=>{let o=e.length;for(;o--;)return e[o].currentStyle?e[o].currentStyle[t]:document.defaultView&&document.defaultView.getComputedStyle?document.defaultView.getComputedStyle(e[o],"")[t]:e[o].style[t]})(this)}};return"string"==typeof t?e.getStyle.apply(this,arrSlice.call(arguments,1)):"object"!=typeof t&&t?(warn(`Method ${t} does not exist`),!1):e.setStyle.apply(this,arguments)}find(t){let e,o=this.length;for(;o--;)return helper(e=this[o].querySelectorAll(t))}each(t){const e=arrSlice.call(this,0);for(let o=e.length-1;o>=0;--o){const s=()=>e[o];t.call(s())}return this}on(){let t=this.length;for(;t--;)this[t].events||(this[t].events={},this[t].events[arguments[0]]=[]),"string"!=typeof arguments[1]?document.addEventListener?this[t].addEventListener(arguments[0],arguments[1],arguments[2]):document.attachEvent?this[t].attachEvent(`on${arguments[0]}`,arguments[1]):this[t][`on${arguments[0]}`]=arguments[1]:listenerDelegate(this[t],arguments[0],arguments[1],arguments[2],arguments[3],!0);return this}off(){let t=this.length;for(;t--;)this[t].events||(this[t].events={},this[t].events[arguments[0]]=[]),"string"!=typeof arguments[1]?document.removeEventListener?this[t].removeEventListener(arguments[0],arguments[1],arguments[2]):document.detachEvent?this[t].detachEvent(`on${arguments[0]}`,arguments[1]):this[t][`on${arguments[0]}`]=null:listenerDelegate(this[t],arguments[0],arguments[1],arguments[2],arguments[3],!1);return this}is(t){const e=helper(t);let o=this.length;for(;o--;)if(this[o]===e[o])return!0;return!1}}function listenerDelegate(t,e,o,s,n,r){const a=function(t){let e=t.target;for(;e&&e!==this;)e.matches(o)&&s.call(e,t),e=e.parentNode};!0===r?document.addEventListener?t.addEventListener(e,a,n||!1):document.attachEvent?t.attachEvent(`on${e}`,a):t[`on${e}`]=a:document.removeEventListener?t.removeEventListener(e,a,n||!1):document.detachEvent?t.detachEvent(`on${e}`,a):t[`on${e}`]=null}function isIterable(t){return isDef(t)&&"object"==typeof t&&(Array.isArray(t)||isDef(window.Symbol)&&"function"==typeof t[window.Symbol.iterator]||isDef(t.forEach)||"number"==typeof t.length&&(0===t.length||t.length>0&&t.length-1 in t))}function helper(t){return new Helper(t)}class Observable{constructor(){this.observers={}}subscribe(t,e){const o=this.observers;return isUndef(o[t])&&Object.defineProperty(o,t,{value:[]}),o[t].push(e),this}unsubscribe(t,e){const o=this.observers;if(isDef(o[t])){const s=o[t].indexOf(e);o[t].splice(s,1)}return this}notify(t,e,o){isUndef(this.observers[t])||this.observers[t].forEach(s=>{if(e!==s)switch(t){case"onmove":s.notifyMove(o);break;case"onrotate":s.notifyRotate(o);break;case"onresize":s.notifyResize(o);break;case"onapply":s.notifyApply(o);break;case"ongetstate":s.notifyGetState(o)}})}}function getOffset(t){return t.getBoundingClientRect()}function getTransform(t){return t.css("-webkit-transform")||t.css("-moz-transform")||t.css("-ms-transform")||t.css("-o-transform")||t.css("transform")||"none"}function parseMatrix(t){const e=t.match(/-?\d+\.?\d+|-?\d+/g);return e?e.map(t=>parseFloat(t)):[1,0,0,1,0,0]}function addClass(t,e){if(e){if(t.classList){if(!(e.indexOf(" ")>-1))return t.classList.add(e);e.split(/\s+/).forEach(e=>t.classList.add(e))}return t}}function removeClass(t,e){if(e){if(t.classList){if(!(e.indexOf(" ")>-1))return t.classList.remove(e);e.split(/\s+/).forEach(e=>t.classList.remove(e))}return t}}function objectsCollide(t,e){const{top:o,left:s}=getOffset(t),{top:n,left:r}=getOffset(e),a=helper(t),i=helper(e);return!(o<n||o+parseFloat(a.css("height"))>n+parseFloat(i.css("height"))||s<r||s+parseFloat(a.css("width"))>r+parseFloat(i.css("width")))}const RAD=Math.PI/180;function snapToGrid(t,e){if(0===e)return t;{const o=snapCandidate(t,e);if(o-t<e)return o}}function snapCandidate(t,e){return 0===e?t:Math.round(t/e)*e}function rotatedTopLeft(t,e,o,s,n,r,a,i,l){const c=parseFloat(o)/2,h=parseFloat(s)/2,u=t+c,d=e+h,p=t-u,f=e-d,x=Math.atan2(i?0:f,l?0:p)+n,m=Math.sqrt(Math.pow(l?0:c,2)+Math.pow(i?0:h,2));let y=Math.cos(x),b=Math.sin(x);const g=d+m*(b=!0===a?-b:b);return{left:floatToFixed(u+m*(y=!0===r?-y:y)),top:floatToFixed(g)}}function floatToFixed(t,e=6){return Number(t.toFixed(e))}class Subject{constructor(t,e){if(this.constructor===Subject)throw new TypeError("Cannot construct Subject instances directly");this.el=t,this.storage=null,this.proxyMethods=null,this.observable=e,this._onMouseDown=this._onMouseDown.bind(this),this._onTouchStart=this._onTouchStart.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this._onTouchMove=this._onTouchMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._onTouchEnd=this._onTouchEnd.bind(this),this._animate=this._animate.bind(this)}enable(t){isUndef(this.storage)?(this._processOptions(t),this._init(this.el)):warn("Already enabled")}disable(){const{storage:t,proxyMethods:e,el:o}=this;isUndef(t)||(t.onExecution&&(this._end(),helper(document).off("mousemove",this._onMouseMove).off("mouseup",this._onMouseUp).off("touchmove",this._onTouchMove,eventOptions).off("touchend",this._onTouchEnd,eventOptions)),removeClass(o,"sjx-drag"),this._destroy(),this.unsubscribe(),e.onDestroy.call(this,o),delete this.storage)}_init(){throw Error("'_init()' method not implemented")}_destroy(){throw Error("'_destroy()' method not implemented")}_cursorPoint(){throw Error("'_cursorPoint()' method not implemented")}_drag(){this._processMove(...arguments),this.proxyMethods.onMove.call(this,...arguments)}_rotate(){this._processRotate(...arguments),this.proxyMethods.onRotate.call(this,...arguments)}_resize(){this._processResize(...arguments),this.proxyMethods.onResize.call(this,...arguments)}_processOptions(t){const{el:e}=this;addClass(e,"sjx-drag");const o={x:10,y:10,angle:10*RAD},s={move:!1,resize:!1,rotate:!1};let n=null,r=!1,a="xy",i="auto",l="auto",c="auto",h="#00a8ff",u=!1,d=()=>{},p=()=>{},f=()=>{},x=()=>{},m=()=>{},y=()=>{},b=e.parentNode;if(isDef(t)){const{snap:g,each:v,axis:T,cursorMove:_,cursorResize:M,cursorRotate:E,rotationPoint:w,restrict:S,onInit:V,onDrop:j,onMove:D,onResize:C,onRotate:F,onDestroy:A,container:k,proportions:R,themeColor:O}=t;if(isDef(g)){const{x:t,y:e,angle:s}=g;o.x=isUndef(t)?10:t,o.y=isUndef(e)?10:e,o.angle=isUndef(s)?o.angle:s*RAD}if(isDef(v)){const{move:t,resize:e,rotate:o}=v;s.move=t||!1,s.resize=e||!1,s.rotate=o||!1}isDef(S)&&(n="parent"===S?e.parentNode:helper(S)[0]||document),h=O||"#00a8ff",i=_||"auto",l=M||"auto",c=E||"auto",a=T||"xy",b=isDef(k)&&helper(k)[0]?helper(k)[0]:b,u=w||!1,r=R||!1,d=createEvent(V),m=createEvent(j),p=createEvent(D),x=createEvent(C),f=createEvent(F),y=createEvent(A),d.call(this,e)}this.options={axis:a,themeColor:h,cursorMove:i,cursorRotate:c,cursorResize:l,rotationPoint:u,restrict:n,container:b,snap:o,each:s,proportions:r},this.proxyMethods={onInit:d,onDrop:m,onMove:p,onResize:x,onRotate:f,onDestroy:y},this.subscribe(s)}_draw(){this._animate()}_animate(){const t=this,{observable:e,storage:o,options:s}=t;if(isUndef(o))return;if(o.frame=requestAnimFrame(t._animate),!o.doDraw)return;o.doDraw=!1;let{dox:n,doy:r,clientX:a,clientY:i,doDrag:l,doResize:c,doRotate:h,doSetCenter:u,revX:d,revY:p,handle:f}=o;const{snap:x,each:m,restrict:y}=s,{move:b,resize:g,rotate:v}=m;if(c){const{transform:s,cx:l,cy:c}=o,{x:h,y:u}=this._pointToElement({x:a,y:i});let m=n?snapToGrid(h-l,x.x/s.scX):0,y=r?snapToGrid(u-c,x.y/s.scY):0;m=n?d?-m:m:0,y=r?p?-y:y:0,t._resize(m,y,f[0]),g&&e.notify("onresize",t,{dx:m,dy:y,handle:f[0]})}if(l){const{restrictOffset:s,elementOffset:l,nx:c,ny:h}=o;isDef(y)&&(a-s.left<c-l.left&&(a=c-l.left+s.left),i-s.top<h-l.top&&(i=h-l.top+s.top));const u=n?snapToGrid(a-c,x.x):0,d=r?snapToGrid(i-h,x.y):0;t._drag(u,d),b&&e.notify("onmove",t,{dx:u,dy:d})}if(h){const{pressang:s,center:n}=o,r=Math.atan2(i-n.y,a-n.x)-s;t._rotate(snapToGrid(r,x.angle)),v&&e.notify("onrotate",t,{radians:r})}if(u){const{bx:e,by:s}=o,{x:n,y:r}=this._pointToControls({x:a,y:i});t._moveCenterHandle(n-e,r-s)}}_start(t){const{observable:e,storage:o,options:s,el:n}=this,r=this._compute(t);Object.keys(r).forEach(t=>{o[t]=r[t]});const{onRightEdge:a,onBottomEdge:i,onTopEdge:l,onLeftEdge:c,handle:h,factor:u,revX:d,revY:p,doW:f,doH:x}=r,m=a||i||l||c,{handles:y,radius:b}=o,{axis:g,restrict:v}=s;isDef(b)&&removeClass(b,"sjx-hidden");const T=h.is(y.rotator),_=!!isDef(y.center)&&h.is(y.center),{clientX:M,clientY:E}=t,{x:w,y:S}=this._cursorPoint({clientX:M,clientY:E}),{x:V,y:j}=this._pointToElement({x:w,y:S}),{x:D,y:C}=this._pointToControls({x:w,y:S}),F={clientX:M,clientY:E,nx:w,ny:S,cx:V,cy:j,bx:D,by:C,doResize:m,doDrag:!(T||m||_),doRotate:T,doSetCenter:_,onExecution:!0,cursor:null,elementOffset:getOffset(n),restrictOffset:isDef(v)?getOffset(v):null,dox:/\x/.test(g)&&(!m||(h.is(y.ml)||h.is(y.mr)||h.is(y.tl)||h.is(y.tr)||h.is(y.bl)||h.is(y.br))),doy:/\y/.test(g)&&(!m||(h.is(y.br)||h.is(y.bl)||h.is(y.bc)||h.is(y.tr)||h.is(y.tl)||h.is(y.tc)))};this.storage={...o,...F},e.notify("ongetstate",this,{factor:u,revX:d,revY:p,doW:f,doH:x}),this._draw()}_moving(t){const{storage:e,options:o}=this,{x:s,y:n}=this._cursorPoint(t);e.e=t,e.clientX=s,e.clientY=n,e.doDraw=!0;let{doRotate:r,doDrag:a,doResize:i,cursor:l}=e;const{cursorMove:c,cursorResize:h,cursorRotate:u}=o;isUndef(l)&&(a?l=c:r?l=u:i&&(l=h),helper(document.body).css({cursor:l}))}_end(t){const{observable:e,storage:o,proxyMethods:s,el:n}=this,{doResize:r,doDrag:a,frame:i,radius:l}=o,c=r?"resize":a?"drag":"rotate";o.doResize=!1,o.doDrag=!1,o.doRotate=!1,o.doSetCenter=!1,o.doDraw=!1,o.onExecution=!1,o.cursor=null,this._apply(c),s.onDrop.call(this,t,n),e.notify("onapply",this,{actionName:c,e:t}),cancelAnimFrame(i),helper(document.body).css({cursor:"auto"}),isDef(l)&&addClass(l,"sjx-hidden")}_checkHandles(t,e){const o=t.is(e.tl),s=t.is(e.tc),n=t.is(e.tr),r=t.is(e.bl),a=t.is(e.bc),i=t.is(e.br),l=t.is(e.ml),c=t.is(e.mr);return{revX:o||l||r||s,revY:o||n||s||l,onTopEdge:s||n||o,onLeftEdge:o||l||r,onRightEdge:n||c||i,onBottomEdge:i||a||r,doW:l||c,doH:s||a}}_onMouseDown(t){this._start(t),helper(document).on("mousemove",this._onMouseMove).on("mouseup",this._onMouseUp)}_onTouchStart(t){this._start(t.touches[0]),helper(document).on("touchmove",this._onTouchMove,eventOptions).on("touchend",this._onTouchEnd,eventOptions)}_onMouseMove(t){t.preventDefault&&t.preventDefault(),this._moving(t,this.el)}_onTouchMove(t){t.preventDefault&&t.preventDefault(),this._moving(t.touches[0],this.el)}_onMouseUp(t){helper(document).off("mousemove",this._onMouseMove).off("mouseup",this._onMouseUp),this._end(t,this.el)}_onTouchEnd(t){helper(document).off("touchmove",this._onTouchMove).off("touchend",this._onTouchEnd),0===t.touches.length&&this._end(t.changedTouches[0],this.el)}notifyMove({dx:t,dy:e}){this._drag(t,e)}notifyRotate({radians:t}){const{snap:e}=this.options;this._rotate(snapToGrid(t,e.angle))}notifyResize({dx:t,dy:e}){this._resize(t,e)}notifyApply({e:t,actionName:e}){this.proxyMethods.onDrop.call(this,t,this.el),this._apply(e)}notifyGetState(t){const{storage:e}=this,o=this._getState(t);this.storage={...e,...o}}subscribe(t){const{observable:e}=this,{resize:o,move:s,rotate:n}=t;(s||o||n)&&e.subscribe("ongetstate",this).subscribe("onapply",this),s&&e.subscribe("onmove",this),o&&e.subscribe("onresize",this),n&&e.subscribe("onrotate",this)}unsubscribe(){const{observable:t}=this;t.unsubscribe("ongetstate",this).unsubscribe("onapply",this).unsubscribe("onmove",this).unsubscribe("onresize",this).unsubscribe("onrotate",this)}}function createEvent(t){return isFunc(t)?function(){t.call(this,...arguments)}:()=>{}}const MIN_SIZE=2,CENTER_DELTA=7;class Draggable extends Subject{constructor(t,e,o){super(t,o),this.enable(e)}_init(t){const e=document.createElement("div");addClass(e,"sjx-wrapper"),t.parentNode.insertBefore(e,t);const o=helper(t),{options:s}=this,{rotationPoint:n}=s,{left:r,top:a,width:i,height:l}=t.style,c=i||o.css("width"),h=l||o.css("height"),u=a||o.css("top"),d=r||o.css("left"),p=helper(e.parentNode),f={top:u,left:d,width:c,height:h,transform:getTransform(o)},x=document.createElement("div"),m={normal:["sjx-normal"],tl:["sjx-hdl","sjx-hdl-t","sjx-hdl-l","sjx-hdl-tl"],tr:["sjx-hdl","sjx-hdl-t","sjx-hdl-r","sjx-hdl-tr"],br:["sjx-hdl","sjx-hdl-b","sjx-hdl-r","sjx-hdl-br"],bl:["sjx-hdl","sjx-hdl-b","sjx-hdl-l","sjx-hdl-bl"],tc:["sjx-hdl","sjx-hdl-t","sjx-hdl-c","sjx-hdl-tc"],bc:["sjx-hdl","sjx-hdl-b","sjx-hdl-c","sjx-hdl-bc"],ml:["sjx-hdl","sjx-hdl-m","sjx-hdl-l","sjx-hdl-ml"],mr:["sjx-hdl","sjx-hdl-m","sjx-hdl-r","sjx-hdl-mr"],center:n?["sjx-hdl","sjx-hdl-m","sjx-hdl-c","sjx-hdl-mc"]:void 0,rotator:["sjx-hdl","sjx-hdl-m","sjx-rotator"]};if(Object.keys(m).forEach(t=>{const e=m[t];if(isUndef(e))return;const o=createHandler(e);m[t]=o,x.appendChild(o)}),isDef(m.center)){helper(m.center).css({left:`${t.getAttribute("data-cx")}px`,top:`${t.getAttribute("data-cy")}px`})}addClass(x,"sjx-controls"),e.appendChild(x);const y=helper(x);y.css(f);const b=helper(e);this.storage={controls:x,handles:m,radius:b.find(".sjx-radius"),parent:p},y.on("mousedown",this._onMouseDown).on("touchstart",this._onTouchStart)}_destroy(){const{controls:t}=this.storage;helper(t).off("mousedown",this._onMouseDown).off("touchstart",this._onTouchStart);const e=t.parentNode;e.parentNode.removeChild(e)}_compute(t){const{handles:e}=this.storage,o=helper(t.target),{revX:s,revY:n,onTopEdge:r,onLeftEdge:a,onRightEdge:i,onBottomEdge:l,doW:c,doH:h}=this._checkHandles(o,e),u=o.is(e.tr)||o.is(e.bl)?-1:1,d=this._getState({factor:u,revX:s,revY:n,doW:c,doH:h}),{x:p,y:f}=this._cursorPoint(t),x=Math.atan2(f-d.center.y,p-d.center.x);return{...d,onTopEdge:r,onLeftEdge:a,onRightEdge:i,onBottomEdge:l,handle:o,pressang:x}}_pointToElement({x:t,y:e}){const{transform:o}=this.storage,s=[...o.matrix];return s[4]=s[5]=0,this._applyMatrixToPoint(matrixInvert(s),t,e)}_pointToControls(t){return this._pointToElement(t)}_applyMatrixToPoint(t,e,o){return multiplyMatrixAndPoint({x:e,y:o},t)}_cursorPoint({clientX:t,clientY:e}){const{container:o}=this.options;return multiplyMatrixAndPoint({x:t,y:e},matrixInvert(parseMatrix(getTransform(helper(o)))))}_apply(){const{el:t,storage:e}=this,o=helper(t),{cached:s,controls:n,transform:r,handles:a}=e,i=helper(n),l=parseFloat(i.css("width"))/2,c=parseFloat(i.css("height"))/2,{center:h}=a,u=isDef(h),d=u?parseFloat(helper(h).css("left")):l,p=u?parseFloat(helper(h).css("top")):c;if(t.setAttribute("data-cx",d),t.setAttribute("data-cy",p),isUndef(s))return;const{dx:f,dy:x}=s,m=matrixToCSS(r.matrix),y=parseFloat(t.style.left||o.css("left")),b=parseFloat(t.style.top||o.css("top"));m.left=`${y+f}px`,m.top=`${b+x}px`,o.css(m),i.css(m),this.storage.cached=null}_processResize(t,e){const{el:o,storage:s,options:n}=this,{proportions:r}=n,{controls:a,coords:i,cw:l,ch:c,transform:h,refang:u,revX:d,revY:p,doW:f,doH:x}=s,m=f||!f&&!x?(l+t)/l:(c+e)/c,y=r?l*m:l+t,b=r?c*m:c+e;if(y<MIN_SIZE||b<MIN_SIZE)return;const g=[...h.matrix],v=rotatedTopLeft(g[4],g[5],y,b,u,d,p,f,x),T=i.left-v.left,_=i.top-v.top;g[4]+=T,g[5]+=_;const M=matrixToCSS(g);M.width=`${y}px`,M.height=`${b}px`,helper(a).css(M),helper(o).css(M),s.cached={dx:T,dy:_}}_processMove(t,e){const{el:o,storage:s}=this,{controls:n,transform:r}=s,{matrix:a,parentMatrix:i}=r,l=[...i];l[4]=l[5]=0;const c=[...a];c[4]=a[4]+t,c[5]=a[5]+e;const h=matrixToCSS(c);helper(n).css(h),helper(o).css(h),s.cached={dx:t,dy:e}}_processRotate(t){const{el:e,storage:o}=this,{controls:s,transform:n,center:r}=o,{matrix:a,parentMatrix:i}=n,l=floatToFixed(Math.cos(t)),c=floatToFixed(Math.sin(t)),h=[1,0,0,1,r.cx,r.cy],u=[l,c,-c,l,0,0],d=[...i];d[4]=d[5]=0;const p=multiplyMatrix(matrixInvert(d),multiplyMatrix(u,d)),f=multiplyMatrix(multiplyMatrix(h,p),matrixInvert(h)),x=matrixToCSS(multiplyMatrix(f,a));helper(s).css(x),helper(e).css(x)}_getState(t){const{factor:e,revX:o,revY:s,doW:n,doH:r}=t,{el:a,storage:i,options:l}=this,{container:c}=l,{handles:h,controls:u,parent:d}=i,{center:p,tl:f,tr:x}=h,m=getOffset(f),y=getOffset(x),b=Math.atan2(y.top-m.top,y.left-m.left)*e,g=helper(u),v=parseMatrix(getTransform(helper(c))),T=parseMatrix(getTransform(helper(u))),_=parseMatrix(getTransform(d)),M={matrix:T,parentMatrix:d===c?multiplyMatrix(_,v):v,scX:Math.sqrt(T[0]*T[0]+T[1]*T[1]),scY:Math.sqrt(T[2]*T[2]+T[3]*T[3])},E=parseFloat(g.css("width")),w=parseFloat(g.css("height")),S=rotatedTopLeft(T[4],T[5],E,w,b,o,s,n,r),V=E/2,j=w/2,D=getOffset(a),C=isDef(p),F=C?parseFloat(helper(p).css("left")):V,A=C?parseFloat(helper(p).css("top")):j,k=C?CENTER_DELTA:0;return{transform:M,cw:E,ch:w,coords:S,center:{x:D.left+F-k,y:D.top+A-k,cx:-F+V-k,cy:-A+j-k,hx:F,hy:A},factor:e,refang:b,revX:o,revY:s,doW:n,doH:r}}_moveCenterHandle(t,e){const{storage:o}=this,{handles:s,center:n}=o,r=`${n.hx+t}px`,a=`${n.hy+e}px`;helper(s.center).css({left:r,top:a})}resetCenterPoint(){const{handles:t}=this.storage;helper(t.center).css({left:null,top:null})}get controls(){return this.storage.controls}}function matrixToCSS(t){const e=`matrix(${t.join()})`;return{transform:e,webkitTranform:e,mozTransform:e,msTransform:e,otransform:e}}function multiplyMatrixAndPoint(t,e){const{x:o,y:s}=t,[n,r,a,i,l,c]=e;return{x:n*o+a*s+l,y:r*o+i*s+c}}function matrixInvert(t){const e=[[t[0],t[2],t[4]],[t[1],t[3],t[5]],[0,0,1]];if(e.length!==e[0].length)return;const o=e.length,s=[],n=[];for(let t=0;t<o;t+=1){s[s.length]=[],n[n.length]=[];for(let r=0;r<o;r+=1)s[t][r]=t==r?1:0,n[t][r]=e[t][r]}for(let t=0;t<o;t+=1){let e=n[t][t];if(0===e){for(let r=t+1;r<o;r+=1)if(0!==n[r][t]){for(let a=0;a<o;a++)e=n[t][a],n[t][a]=n[r][a],n[r][a]=e,e=s[t][a],s[t][a]=s[r][a],s[r][a]=e;break}if(0===(e=n[t][t]))return}for(let r=0;r<o;r++)n[t][r]=n[t][r]/e,s[t][r]=s[t][r]/e;for(let r=0;r<o;r++)if(r!=t){e=n[r][t];for(let a=0;a<o;a++)n[r][a]-=e*n[t][a],s[r][a]-=e*s[t][a]}}return[s[0][0],s[1][0],s[0][1],s[1][1],s[0][2],s[1][2]]}function multiplyMatrix(t,e){const o=[[t[0],t[2],t[4]],[t[1],t[3],t[5]],[0,0,1]],s=[[e[0],e[2],e[4]],[e[1],e[3],e[5]],[0,0,1]],n=[];for(let t=0;t<s.length;t++){n[t]=[];for(let e=0;e<o[0].length;e++){let r=0;for(let n=0;n<o.length;n++)r+=o[n][e]*s[t][n];n[t].push(r)}}return[n[0][0],n[1][0],n[0][1],n[1][1],n[0][2],n[1][2]]}function createHandler(t){const e=document.createElement("div");return t.forEach(t=>{addClass(e,t)}),e}const ALLOWED_ELEMENTS=["circle","ellipse","image","line","path","polygon","polyline","rect","text","g"];function createSVGElement(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function createSVGMatrix(){return createSVGElement("svg").createSVGMatrix()}function getTransformToElement(t,e){return(e.getScreenCTM()||createSVGMatrix()).inverse().multiply(t.getScreenCTM()||createSVGMatrix())}function matrixToString(t){return`matrix(${t.a},${t.b},${t.c},${t.d},${t.e},${t.f})`}function pointTo(t,e,o,s){const n=e.createSVGPoint();return n.x=o,n.y=s,n.matrixTransform(t)}function cloneMatrix(t){const e=createSVGMatrix();return e.a=t.a,e.b=t.b,e.c=t.c,e.d=t.d,e.e=t.e,e.f=t.f,e}function checkElement(t){const e=t.tagName.toLowerCase();return-1!==ALLOWED_ELEMENTS.indexOf(e)||(warn("Selected element is not allowed to transform. Allowed elements:\ncircle, ellipse, image, line, path, polygon, polyline, rect, text, g"),!1)}function isIdentity(t){return 1===t.a&&0===t.b&&0===t.c&&1===t.d&&0===t.e&&0===t.f}const dRE=/\s*([achlmqstvz])([^achlmqstvz]*)\s*/gi,sepRE=/\s*,\s*|\s+/g;function parsePath(t){let e=dRE.lastIndex=0;const o=[];for(;e=dRE.exec(t);){const t=e[1],s=t.toUpperCase(),n=e[2].replace(/([^e])-/g,"$1 -").replace(/ +/g," ");o.push({relative:t!==s,key:s,cmd:t,values:n.trim().split(sepRE).map(t=>{if(!isNaN(t))return Number(t)})})}return o}function movePath(t){const{path:e,dx:o,dy:s}=t;try{const t=parsePath(e);let n="",r=" ",a=!0;for(let e=0,i=t.length;e<i;e++){const i=t[e],{values:l,key:c,relative:h}=i,u=[];switch(c){case"M":for(let t=0,e=l.length;t<e;t+=2){const[e,n]=l.slice(t,t+2);h&&!a||(e+=o,n+=s),u.push(e,n),a=!1}break;case"A":for(let t=0,e=l.length;t<e;t+=7){const e=l.slice(t,t+7);h||(e[5]+=o,e[6]+=s),u.push(...e)}break;case"C":for(let t=0,e=l.length;t<e;t+=6){const e=l.slice(t,t+6);h||(e[0]+=o,e[1]+=s,e[2]+=o,e[3]+=s,e[4]+=o,e[5]+=s),u.push(...e)}break;case"H":for(let t=0,e=l.length;t<e;t+=1){const e=l.slice(t,t+1);h||(e[0]+=o),u.push(e[0])}break;case"V":for(let t=0,e=l.length;t<e;t+=1){const e=l.slice(t,t+1);h||(e[0]+=s),u.push(e[0])}break;case"L":case"T":for(let t=0,e=l.length;t<e;t+=2){const[e,n]=l.slice(t,t+2);h||(e+=o,n+=s),u.push(e,n)}break;case"Q":case"S":for(let t=0,e=l.length;t<e;t+=4){const[e,n,r,a]=l.slice(t,t+4);h||(e+=o,n+=s,r+=o,a+=s),u.push(e,n,r,a)}break;case"Z":l[0]="",r=""}n+=i.cmd+u.join(",")+r}return n}catch(t){warn("Path parsing error: "+t)}}function resizePath(t){const{path:e,localCTM:o,container:s}=t;try{const t=parsePath(e);let n="",r=" ";const a=[];let i=!0;for(let e=0,l=t.length;e<l;e++){const l=t[e],{values:c,key:h,relative:u}=l;switch(h){case"A":{const t=[];for(let e=0,n=c.length;e<n;e+=7){const[n,r,a,i,l,h,d]=c.slice(e,e+7),p=cloneMatrix(o);u&&(p.e=p.f=0);const{x:f,y:x}=pointTo(p,s,h,d);t.push(floatToFixed(f),floatToFixed(x)),p.e=p.f=0;const{x:m,y:y}=pointTo(p,s,n,r);t.unshift(floatToFixed(m),floatToFixed(y),a,i,l)}a.push(t);break}case"C":{const t=[];for(let e=0,n=c.length;e<n;e+=6){const[n,r,a,i,l,h]=c.slice(e,e+6),d=cloneMatrix(o);u&&(d.e=d.f=0);const{x:p,y:f}=pointTo(d,s,n,r),{x:x,y:m}=pointTo(d,s,a,i),{x:y,y:b}=pointTo(d,s,l,h);t.push(floatToFixed(p),floatToFixed(f),floatToFixed(x),floatToFixed(m),floatToFixed(y),floatToFixed(b))}a.push(t);break}case"H":{const t=[];for(let e=0,n=c.length;e<n;e+=1){const[n]=c.slice(e,e+1),r=cloneMatrix(o);u&&(r.e=r.f=0);const{x:a}=pointTo(r,s,n,0);t.push(floatToFixed(a))}a.push(t);break}case"V":{const t=[];for(let e=0,n=c.length;e<n;e+=1){const[n]=c.slice(e,e+1),r=cloneMatrix(o);u&&(r.e=r.f=0);const{y:a}=pointTo(r,s,0,n);t.push(floatToFixed(a))}a.push(t);break}case"T":case"L":{const t=[];for(let e=0,n=c.length;e<n;e+=2){const[n,r]=c.slice(e,e+2),a=cloneMatrix(o);u&&(a.e=a.f=0);const{x:i,y:l}=pointTo(a,s,n,r);t.push(floatToFixed(i),floatToFixed(l))}a.push(t);break}case"M":{const t=[];for(let e=0,n=c.length;e<n;e+=2){const[n,r]=c.slice(e,e+2),a=cloneMatrix(o);u&&!i&&(a.e=a.f=0);const{x:l,y:h}=pointTo(a,s,n,r);t.push(floatToFixed(l),floatToFixed(h)),i=!1}a.push(t);break}case"Q":{const t=[];for(let e=0,n=c.length;e<n;e+=4){const[n,r,a,i]=c.slice(e,e+4),l=cloneMatrix(o);u&&(l.e=l.f=0);const{x:h,y:d}=pointTo(l,s,n,r),{x:p,y:f}=pointTo(l,s,a,i);t.push(floatToFixed(h),floatToFixed(d),floatToFixed(p),floatToFixed(f))}a.push(t);break}case"S":{const t=[];for(let e=0,n=c.length;e<n;e+=4){const[n,r,a,i]=c.slice(e,e+4),l=cloneMatrix(o);u&&(l.e=l.f=0);const{x:h,y:d}=pointTo(l,s,n,r),{x:p,y:f}=pointTo(l,s,a,i);t.push(floatToFixed(h),floatToFixed(d),floatToFixed(p),floatToFixed(f))}a.push(t);break}case"Z":a.push([""]),r=""}n+=l.cmd+a[e].join(",")+r}return n}catch(t){warn("Path parsing error: "+t)}}const MIN_SIZE$1=5,ROT_OFFSET=50,floatRE=/[+-]?\d+(\.\d+)?/g;class DraggableSVG extends Subject{constructor(t,e,o){super(t,o),this.enable(e)}_init(t){const{options:e}=this,{rotationPoint:o,container:s,themeColor:n}=e,r=createSVGElement("g");s.appendChild(r);const{width:a,height:i,x:l,y:c}=t.getBBox(),h=getTransformToElement(t,s),u=createSVGElement("rect");[["width",a],["height",i],["x",l],["y",c],["fill",n],["fill-opacity",.1],["stroke",n],["stroke-dasharray","3 3"],["vector-effect","non-scaling-stroke"],["transform",matrixToString(h)]].forEach(t=>{u.setAttribute(t[0],t[1])});const d=createSVGElement("g"),p=createSVGElement("g"),f=createSVGElement("g");f.appendChild(u),r.appendChild(f),r.appendChild(p),r.appendChild(d);const{x:x,y:m,width:y,height:b}=u.getBBox(),g=t.getAttribute("data-cx"),v=t.getAttribute("data-cy"),T=getTransformToElement(u,u.parentNode),_=pointTo(T,s,x+y/2,m+b/2),M={tl:pointTo(T,s,x,m),tr:pointTo(T,s,x+y,m),br:pointTo(T,s,x+y,m+b),bl:pointTo(T,s,x,m+b),tc:pointTo(T,s,x+y/2,m),bc:pointTo(T,s,x+y/2,m+b),ml:pointTo(T,s,x,m+b/2),mr:pointTo(T,s,x+y,m+b/2),center:o?createPoint(s,g,v)||_:void 0,rotator:{}},E=Math.atan2(M.tl.y-M.tr.y,M.tl.x-M.tr.x);M.rotator.x=M.mr.x-ROT_OFFSET*Math.cos(E),M.rotator.y=M.mr.y-ROT_OFFSET*Math.sin(E);const w=createSVGElement("line");w.x1.baseVal.value=M.mr.x,w.y1.baseVal.value=M.mr.y,w.x2.baseVal.value=M.rotator.x,w.y2.baseVal.value=M.rotator.y,setLineStyle(w,n),p.appendChild(w);let S=null;o&&(addClass(S=createSVGElement("line"),"sjx-hidden"),S.x1.baseVal.value=_.x,S.y1.baseVal.value=_.y,S.x2.baseVal.value=g||_.x,S.y2.baseVal.value=v||_.y,setLineStyle(S,"#fe3232"),S.setAttribute("opacity",.5),p.appendChild(S)),Object.keys(M).forEach(t=>{const e=M[t];if(isUndef(e))return;const{x:o,y:s}=e,r="center"===t?"#fe3232":n;M[t]=createHandler$1(o,s,r,t),d.appendChild(M[t])}),this.storage={wrapper:r,box:u,handles:M,normalLine:w,radius:o?S:void 0,parent:t.parentNode},helper(r).on("mousedown",this._onMouseDown).on("touchstart",this._onTouchStart)}_destroy(){const{wrapper:t}=this.storage;helper(t).off("mousedown",this._onMouseDown).off("touchstart",this._onTouchStart),t.parentNode.removeChild(t)}_compute(t){const{storage:e}=this,{handles:o}=e,s=helper(t.target),{revX:n,revY:r,onTopEdge:a,onLeftEdge:i,onRightEdge:l,onBottomEdge:c,doW:h,doH:u}=this._checkHandles(s,o),d=this._getState({revX:n,revY:r,doW:h,doH:u}),{x:p,y:f}=this._cursorPoint(t),x=Math.atan2(f-d.center.y,p-d.center.x);return{...d,doW:h,doH:u,onTopEdge:a,onLeftEdge:i,onRightEdge:l,onBottomEdge:c,handle:s,pressang:x}}_cursorPoint({clientX:t,clientY:e}){const{container:o}=this.options;return pointTo(o.getScreenCTM().inverse(),o,t,e)}_pointToElement({x:t,y:e}){const{transform:o}=this.storage,{ctm:s}=o,n=s.inverse();return n.e=n.f=0,this._applyMatrixToPoint(n,t,e)}_pointToControls({x:t,y:e}){const{transform:o}=this.storage,{boxCTM:s}=o,n=s.inverse();return n.e=n.f=0,this._applyMatrixToPoint(n,t,e)}_applyMatrixToPoint(t,e,o){const{container:s}=this.options,n=s.createSVGPoint();return n.x=e,n.y=o,n.matrixTransform(t)}_apply(t){const{el:e,storage:o,options:s}=this,{container:n}=s,{box:r,handles:a,cached:i,transform:l}=o,{matrix:c}=l,h=e.getBBox(),{x:u,y:d,width:p,height:f}=h,x=isDef(a.center)?pointTo(l.boxCTM,n,a.center.cx.baseVal.value,a.center.cy.baseVal.value):pointTo(c,n,u+p/2,d+f/2);if(e.setAttribute("data-cx",x.x),e.setAttribute("data-cy",x.y),isUndef(i))return;const{scaleX:m,scaleY:y,dx:b,dy:g,ox:v,oy:T}=i;if("drag"===t){if(0===b&&0===g)return;const t=createSVGMatrix();t.e=b,t.f=g;const o=t.multiply(c).multiply(t.inverse());if(e.setAttribute("transform",matrixToString(o)),isGroup(e)){checkChildElements(e).forEach(t=>{const o=n.createSVGPoint(),s=getTransformToElement(e.parentNode,n).inverse();o.x=v,o.y=T,s.e=s.f=0;const r=o.matrixTransform(s),a=createSVGMatrix();a.e=b,a.f=g;const i=a.multiply(getTransformToElement(t,t.parentNode)).multiply(a.inverse());isIdentity(i)||t.setAttribute("transform",matrixToString(i)),isGroup(t)||applyTranslate(t,{x:r.x,y:r.y})})}else applyTranslate(e,{x:b,y:g})}if("resize"===t){const{x:t,y:s,width:a,height:i}=r.getBBox();if(applyTransformToHandles(o,{x:t,y:s,width:a,height:i},n),isGroup(e)){checkChildElements(e).forEach(t=>{isGroup(t)||applyResize(t,{scaleX:m,scaleY:y,defaultCTM:t.__ctm__,bBox:l.bBox,container:n,storage:o})})}else applyResize(e,{scaleX:m,scaleY:y,defaultCTM:l.ctm,bBox:l.bBox,container:n,storage:o});e.setAttribute("transform",matrixToString(c))}this.storage.cached=null}_processResize(t,e){const{el:o,storage:s,options:n}=this,{container:r,proportions:a}=n,{box:i,left:l,top:c,cw:h,ch:u,transform:d,revX:p,revY:f,doW:x,doH:m}=this.storage,{matrix:y,scMatrix:b,trMatrix:g,scaleX:v,scaleY:T}=d;let{width:_,height:M}=i.getBBox();const E=x||!x&&!m?(h+t)/h:(u+e)/u;if(_=a?h*E:h+t,M=a?u*E:u+e,Math.abs(_)<MIN_SIZE$1||Math.abs(M)<MIN_SIZE$1)return;const w=_/h,S=M/u;b.a=w,b.b=0,b.c=0,b.d=S,b.e=0,b.f=0,g.e=v,g.f=T;const V=g.multiply(b).multiply(g.inverse()),j=y.multiply(V);o.setAttribute("transform",matrixToString(j)),this.storage.cached={scaleX:w,scaleY:S},applyTransformToHandles(s,{x:l-(_-h)*(m?.5:p?1:0),y:c-(M-u)*(x?.5:f?1:0),width:_,height:M},r)}_processMove(t,e){const{container:o}=this.options,{transform:s,wrapper:n,center:r}=this.storage,{matrix:a,trMatrix:i,scMatrix:l,wrapperMatrix:c,parentMatrix:h}=s;l.e=t,l.f=e;const u=l.multiply(c);n.setAttribute("transform",matrixToString(u)),h.e=h.f=0;const{x:d,y:p}=pointTo(h.inverse(),o,t,e);i.e=d,i.f=p;const f=i.multiply(a);if(this.el.setAttribute("transform",matrixToString(f)),this.storage.cached={dx:d,dy:p,ox:t,oy:e},!r.isShifted)return;const x=c.inverse();x.e=x.f=0;const{x:m,y:y}=pointTo(x,o,t,e);this._moveCenterHandle(-m,-y)}_processRotate(t){const{center:e,transform:o,wrapper:s}=this.storage,{matrix:n,wrapperMatrix:r,parentMatrix:a,trMatrix:i,scMatrix:l,rotMatrix:c}=o,h=floatToFixed(Math.cos(t)),u=floatToFixed(Math.sin(t));i.e=e.x,i.f=e.y,c.a=h,c.b=u,c.c=-u,c.d=h;const d=i.multiply(c).multiply(i.inverse()).multiply(r);s.setAttribute("transform",matrixToString(d)),l.e=e.el_x,l.f=e.el_y,a.e=a.f=0;const p=a.inverse().multiply(c).multiply(a),f=l.multiply(p).multiply(l.inverse()).multiply(n);this.el.setAttribute("transform",matrixToString(f))}_getState({revX:t,revY:e,doW:o,doH:s}){const{el:n,storage:r,options:a}=this,{container:i}=a,{box:l,wrapper:c,parent:h,handles:u}=r,{center:d}=u,p=n.getBBox(),{x:f,y:x,width:m,height:y}=p,{width:b,height:g,x:v,y:T}=l.getBBox(),_=getTransformToElement(n,h),M=getTransformToElement(n,i),E=getTransformToElement(l.parentNode,i),w=getTransformToElement(h,i),S=f+m*(s?.5:t?1:0),V=x+y*(o?.5:e?1:0),j={matrix:_,ctm:M,boxCTM:E,parentMatrix:w,wrapperMatrix:getTransformToElement(c,c.parentNode),trMatrix:createSVGMatrix(),scMatrix:createSVGMatrix(),rotMatrix:createSVGMatrix(),scaleX:S,scaleY:V,scX:Math.sqrt(M.a*M.a+M.b*M.b),scY:Math.sqrt(M.c*M.c+M.d*M.d),bBox:p},D=v+b/2,C=T+g/2,F=d?d.cx.baseVal.value:D,A=d?d.cy.baseVal.value:C,{x:k,y:R}=pointTo(E,i,F,A),{x:O,y:N}=isDef(d)?pointTo(w.inverse(),i,k,R):pointTo(_,i,f+m/2,x+y/2),{x:L,y:P}=pointTo(getTransformToElement(l,i),i,D,C);return checkChildElements(n).forEach(t=>{t.__ctm__=getTransformToElement(t,i)}),{transform:j,cw:b,ch:g,center:{x:d?k:L,y:d?R:P,el_x:O,el_y:N,hx:d?d.cx.baseVal.value:null,hy:d?d.cy.baseVal.value:null,isShifted:floatToFixed(L,3)!==floatToFixed(k,3)&&floatToFixed(P,3)!==floatToFixed(R,3)},left:v,top:T,revX:t,revY:e,doW:o,doH:s}}_moveCenterHandle(t,e){const{handles:o,center:s,radius:n}=this.storage;isUndef(o.center)||(o.center.cx.baseVal.value=s.hx+t,o.center.cy.baseVal.value=s.hy+e,n.x2.baseVal.value=s.hx+t,n.y2.baseVal.value=s.hy+e)}resetCenterPoint(){const{box:t,handles:e,radius:o}=this.storage,{center:s}=e,{container:n}=this.options,{width:r,height:a,x:i,y:l}=t.getBBox(),c=getTransformToElement(t,t.parentNode),{x:h,y:u}=pointTo(c,n,i+r/2,l+a/2);s.cx.baseVal.value=h,s.cy.baseVal.value=u,s.isShifted=!1,o.x2.baseVal.value=h,o.y2.baseVal.value=u}get controls(){return this.storage.wrapper}}function applyTranslate(t,{x:e,y:o}){const s=[];switch(t.tagName.toLowerCase()){case"use":case"image":case"text":case"rect":{const n=isDef(t.x.baseVal.value)?t.x.baseVal.value+e:(Number(t.getAttribute("x"))||0)+e,r=isDef(t.y.baseVal.value)?t.y.baseVal.value+o:(Number(t.getAttribute("y"))||0)+o;s.push(["x",n],["y",r]);break}case"circle":case"ellipse":{const n=t.cx.baseVal.value+e,r=t.cy.baseVal.value+o;s.push(["cx",n],["cy",r]);break}case"line":{const n=t.x1.baseVal.value+e,r=t.y1.baseVal.value+o,a=t.x2.baseVal.value+e,i=t.y2.baseVal.value+o;s.push(["x1",n],["y1",r],["x2",a],["y2",i]);break}case"polygon":case"polyline":{const n=parsePoints(t.getAttribute("points")).map(t=>(t[0]=Number(t[0])+e,t[1]=Number(t[1])+o,t.join(" "))).join(" ");s.push(["points",n]);break}case"path":{const n=t.getAttribute("d");s.push(["d",movePath({path:n,dx:e,dy:o})]);break}}s.forEach(e=>{t.setAttribute(e[0],e[1])})}function applyResize(t,e){const{scaleX:o,scaleY:s,bBox:n,defaultCTM:r,container:a}=e,{width:i,height:l}=n,c=[],h=getTransformToElement(t,a),u=r.inverse().multiply(h);switch(t.tagName.toLowerCase()){case"text":{const e=t.x.baseVal.value||Number(t.getAttribute("x")),n=t.y.baseVal.value||Number(t.getAttribute("y")),{x:r,y:h}=pointTo(u,a,e,n);c.push(["x",r+(o<0?i:0)],["y",h+(s<0?l:0)]);break}case"circle":{const e=t.r.baseVal.value,n=t.cx.baseVal.value,r=t.cy.baseVal.value,i=e*(Math.abs(o)+Math.abs(s))/2,{x:l,y:h}=pointTo(u,a,n,r);c.push(["r",i],["cx",l],["cy",h]);break}case"image":case"rect":{const e=t.width.baseVal.value,n=t.height.baseVal.value,r=t.x.baseVal.value,i=t.y.baseVal.value,{x:l,y:h}=pointTo(u,a,r,i),d=Math.abs(e*o),p=Math.abs(n*s);c.push(["x",l-(o<0?d:0)],["y",h-(s<0?p:0)],["width",d],["height",p]);break}case"ellipse":{const e=t.rx.baseVal.value,n=t.ry.baseVal.value,r=t.cx.baseVal.value,i=t.cy.baseVal.value,{x:l,y:h}=pointTo(u,a,r,i),d=createSVGMatrix();d.a=o,d.d=s;const{x:p,y:f}=pointTo(d,a,e,n);c.push(["rx",Math.abs(p)],["ry",Math.abs(f)],["cx",l],["cy",h]);break}case"line":{const e=t.x1.baseVal.value,o=t.y1.baseVal.value,s=t.x2.baseVal.value,n=t.y2.baseVal.value,{x:r,y:i}=pointTo(u,a,e,o),{x:l,y:h}=pointTo(u,a,s,n);c.push(["x1",r],["y1",i],["x2",l],["y2",h]);break}case"polygon":case"polyline":{const e=parsePoints(t.getAttribute("points")).map(t=>{const{x:e,y:o}=pointTo(u,a,Number(t[0]),Number(t[1]));return t[0]=e,t[1]=o,t.join(" ")}).join(" ");c.push(["points",e]);break}case"path":{const e=t.getAttribute("d");c.push(["d",resizePath({path:e,localCTM:u,container:a})]);break}}c.forEach(e=>{t.setAttribute(e[0],e[1])})}function applyTransformToHandles(t,e,o){const{box:s,handles:n,normalLine:r,radius:a,center:i}=t;let{x:l,y:c,width:h,height:u}=e;const d=h/2,p=u/2,f=getTransformToElement(s,s.parentNode),x=pointTo(f,o,l+d,c+p),m={tl:pointTo(f,o,l,c),tr:pointTo(f,o,l+h,c),br:pointTo(f,o,l+h,c+u),bl:pointTo(f,o,l,c+u),tc:pointTo(f,o,l+d,c),bc:pointTo(f,o,l+d,c+u),ml:pointTo(f,o,l,c+p),mr:pointTo(f,o,l+h,c+p),rotator:{},center:!i.isShifted&&isDef(n.center)?x:void 0},y=Math.atan2(m.tl.y-m.tr.y,m.tl.x-m.tr.x);m.rotator.x=m.mr.x-ROT_OFFSET*Math.cos(y),m.rotator.y=m.mr.y-ROT_OFFSET*Math.sin(y),r.x1.baseVal.value=m.mr.x,r.y1.baseVal.value=m.mr.y,r.x2.baseVal.value=m.rotator.x,r.y2.baseVal.value=m.rotator.y,isDef(a)&&(a.x1.baseVal.value=x.x,a.y1.baseVal.value=x.y,i.isShifted||(a.x2.baseVal.value=x.x,a.y2.baseVal.value=x.y));const b={x:l+=h<0?h:0,y:c+=u<0?u:0,width:Math.abs(h),height:Math.abs(u)};Object.keys(b).forEach(t=>{s.setAttribute(t,b[t])}),Object.keys(m).forEach(t=>{const e=n[t],o=m[t];isUndef(o)||(e.setAttribute("cx",o.x),e.setAttribute("cy",o.y))})}function isGroup(t){return"g"===t.tagName.toLowerCase()}function checkChildElements(t){const e=[];return isGroup(t)?forEach.call(t.childNodes,t=>{if(1===t.nodeType){const o=t.tagName.toLowerCase();-1!==ALLOWED_ELEMENTS.indexOf(o)&&("g"===o&&e.push(...checkChildElements(t)),e.push(t))}}):e.push(t),e}function parsePoints(t){return t.match(floatRE).reduce((t,e,o,s)=>(o%2==0&&t.push(s.slice(o,o+2)),t),[])}function createHandler$1(t,e,o,s){const n=createSVGElement("circle");addClass(n,`sjx-svg-hdl-${s}`);const r={cx:t,cy:e,r:5.5,fill:o,stroke:"#fff","fill-opacity":1,"vector-effect":"non-scaling-stroke","stroke-width":1};return Object.keys(r).map(t=>{n.setAttribute(t,r[t])}),n}function setLineStyle(t,e){t.setAttribute("stroke",e),t.setAttribute("stroke-dasharray","3 3"),t.setAttribute("vector-effect","non-scaling-stroke")}function createPoint(t,e,o){if(isUndef(e)||isUndef(o))return null;const s=t.createSVGPoint();return s.x=e,s.y=o,s}function drag(t,e){if(this.length){const o=isDef(e)&&e instanceof Observable?e:new Observable;return arrReduce.call(this,(e,s)=>(s instanceof SVGElement?checkElement(s)&&e.push(new DraggableSVG(s,t,o)):e.push(new Draggable(s,t,o)),e),[])}}class Clone{constructor(t,e){this.el=t,this.options=e||{},this.storage=null,this._onMouseDown=this._onMouseDown.bind(this),this._onTouchStart=this._onTouchStart.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this._onTouchMove=this._onTouchMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._onTouchEnd=this._onTouchEnd.bind(this),this._animate=this._animate.bind(this),this.enable()}enable(){isUndef(this.storage)?this._init():warn("Already enabled")}disable(){this._destroy()}_init(){const{el:t,options:e}=this,o=helper(t),{style:s,onDrop:n,appendTo:r,stack:a}=e,i={position:"absolute","z-index":"2147483647",style:isDef(s)&&"object"==typeof s?s:void 0},l=isDef(a)?helper(a)[0]:document,c=isFunc(n)?function(t){const{clone:e}=this.storage;objectsCollide(e,l)&&n.call(this,t,this.el,e)}:()=>{};this.storage={onDrop:c,options:e,css:i,parent:isDef(r)?helper(r)[0]:document.body,stack:l},o.on("mousedown",this._onMouseDown).on("touchstart",this._onTouchStart)}_start(t){const{storage:e,el:o}=this,{parent:s,css:n}=e,r=getOffset(s),{clientX:a,clientY:i}=t;n.left=`${a-r.left}px`,n.top=`${i-r.top}px`;const l=o.cloneNode(!0);helper(l).css(n),e.clientX=a,e.clientY=i,e.cx=a,e.cy=i,e.clone=l,helper(s)[0].appendChild(l),this._draw()}_move(t){const{storage:e}=this;e.clientX=t.clientX,e.clientY=t.clientY,e.doDraw=!0,e.doMove=!0}_end(t){const{storage:e}=this,{clone:o,frameId:s,onDrop:n}=e;e.doDraw=!1,cancelAnimFrame(s),isUndef(o)||(n.call(this,t),o.parentNode.removeChild(o),delete e.clone)}_draw(){this._animate()}_animate(){const{storage:t}=this;t.frameId=requestAnimFrame(this._animate);const{doDraw:e,clientX:o,clientY:s,cx:n,cy:r,clone:a}=t;if(!e)return;t.doDraw=!1;const i=`translate(${o-n}px, ${s-r}px)`;helper(a).css({transform:i,webkitTranform:i,mozTransform:i,msTransform:i,otransform:i})}_destroy(){isUndef(this.storage)||(helper(this.el).off("mousedown",this._onMouseDown).off("touchstart",this._onTouchStart),delete this.storage)}_onMouseDown(t){this._start(t),helper(document).on("mousemove",this._onMouseMove).on("mouseup",this._onMouseUp)}_onMouseMove(t){t.preventDefault&&t.preventDefault(),this._move(t)}_onMouseUp(t){this._end(t),helper(document).off("mousemove",this._onMouseMove).off("mouseup",this._onMouseUp)}_onTouchStart(t){this._start(t.touches[0]),helper(document).on("touchmove",this._onTouchMove,eventOptions).on("touchend",this._onTouchEnd,eventOptions)}_onTouchMove(t){t.preventDefault&&t.preventDefault(),this._move(t.touches[0])}_onTouchEnd(t){0===t.touches.length&&this._end(t.changedTouches[0]),helper(document).off("touchmove",this._onTouchMove,eventOptions).off("touchend",this._onTouchEnd,eventOptions)}}function clone(t){if(this.length)return arrMap.call(this,e=>new Clone(e,t))}class Subjx extends Helper{constructor(t){super(t)}drag(){return drag.call(this,...arguments)}clone(){return clone.call(this,...arguments)}}
/* @license
 * Move/Rotate/Resize tool
 * Released under the MIT license, 2018-2019
 * Karen Sarksyan
 * nichollascarter@gmail.com
*/function subjx(t){return new Subjx(t)}Object.defineProperty(subjx,"createObservable",{value:()=>new Observable}),Object.defineProperty(subjx,"Subjx",{value:Subjx}),Object.defineProperty(subjx,"Observable",{value:Observable}),module.exports=subjx;
