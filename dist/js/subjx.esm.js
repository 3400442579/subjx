/*@license
* Drag/Rotate/Resize Library
* Released under the MIT license, 2018-2019
* Karen Sarksyan
* nichollascarter@gmail.com
*/
const t={passive:!1},e=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||function(t){return setTimeout(t,1e3/60)},s=window.cancelAnimationFrame||window.mozCancelAnimationFrame||function(t){clearTimeout(t)},o=Array.prototype.forEach,n=Array.prototype.slice,r=Array.prototype.map,a=Array.prototype.reduce,i=console.warn;function c(t){return null!=t}function l(t){return null==t}function h(t){return"function"==typeof t}function u(t){return h(t)?function(){t.call(this,...arguments)}:()=>{}}class d{constructor(t){if("string"==typeof t){let e=document.querySelectorAll(t);this.length=e.length;for(let t=0;t<this.length;t++)this[t]=e[t]}else if("object"!=typeof t||1!==t.nodeType&&t!==document)if(t instanceof d){this.length=t.length;for(let e=0;e<this.length;e++)this[e]=t[e]}else{if(!c(e=t)||"object"!=typeof e||!(Array.isArray(e)||c(window.Symbol)&&"function"==typeof e[window.Symbol.iterator]||c(e.forEach)||"number"==typeof e.length&&(0===e.length||e.length>0&&e.length-1 in e)))throw new Error("Passed parameter must be selector/element/elementArray");this.length=0;for(let e=0;e<this.length;e++)1===t.nodeType&&(this[e]=t[e],this.length++)}else this[0]=t,this.length=1;var e}css(t){const e={setStyle(t){return((t,e)=>{let s=t.length;for(;s--;)for(let o in e)t[s].style[o]=e[o];return t.style})(this,t)},getStyle(){return(e=>{let s=e.length;for(;s--;)return e[s].currentStyle?e[s].currentStyle[t]:document.defaultView&&document.defaultView.getComputedStyle?document.defaultView.getComputedStyle(e[s],"")[t]:e[s].style[t]})(this)}};return"string"==typeof t?e.getStyle.apply(this,n.call(arguments,1)):"object"!=typeof t&&t?(i(`Method ${t} does not exist`),!1):e.setStyle.apply(this,arguments)}on(){let t=this.length;for(;t--;)this[t].events||(this[t].events={},this[t].events[arguments[0]]=[]),"string"!=typeof arguments[1]?document.addEventListener?this[t].addEventListener(arguments[0],arguments[1],arguments[2]):document.attachEvent?this[t].attachEvent(`on${arguments[0]}`,arguments[1]):this[t][`on${arguments[0]}`]=arguments[1]:p(this[t],arguments[0],arguments[1],arguments[2],arguments[3],!0);return this}off(){let t=this.length;for(;t--;)this[t].events||(this[t].events={},this[t].events[arguments[0]]=[]),"string"!=typeof arguments[1]?document.removeEventListener?this[t].removeEventListener(arguments[0],arguments[1],arguments[2]):document.detachEvent?this[t].detachEvent(`on${arguments[0]}`,arguments[1]):this[t][`on${arguments[0]}`]=null:p(this[t],arguments[0],arguments[1],arguments[2],arguments[3],!1);return this}is(t){const e=f(t);let s=this.length;for(;s--;)if(this[s]===e[s])return!0;return!1}}function p(t,e,s,o,n,r){const a=function(t){let e=t.target;for(;e&&e!==this;)e.matches(s)&&o.call(e,t),e=e.parentNode};!0===r?document.addEventListener?t.addEventListener(e,a,n||!1):document.attachEvent?t.attachEvent(`on${e}`,a):t[`on${e}`]=a:document.removeEventListener?t.removeEventListener(e,a,n||!1):document.detachEvent?t.detachEvent(`on${e}`,a):t[`on${e}`]=null}function f(t){return new d(t)}class x{constructor(){this.observers={}}subscribe(t,e){const s=this.observers;return l(s[t])&&Object.defineProperty(s,t,{value:[]}),s[t].push(e),this}unsubscribe(t,e){const s=this.observers;if(c(s[t])){const o=s[t].indexOf(e);s[t].splice(o,1)}return this}notify(t,e,s){l(this.observers[t])||this.observers[t].forEach(o=>{if(e!==o)switch(t){case"onmove":o.notifyMove(s);break;case"onrotate":o.notifyRotate(s);break;case"onresize":o.notifyResize(s);break;case"onapply":o.notifyApply(s);break;case"ongetstate":o.notifyGetState(s)}})}}class y{constructor(t){this.el=t,this.storage=null,this.proxyMethods=null,this._onMouseDown=this._onMouseDown.bind(this),this._onTouchStart=this._onTouchStart.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this._onTouchMove=this._onTouchMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._onTouchEnd=this._onTouchEnd.bind(this),this._animate=this._animate.bind(this)}enable(t){this._processOptions(t),this._init(this.el),this.proxyMethods.onInit.call(this,this.el)}disable(){b()}_init(){b()}_destroy(){b()}_processOptions(){b()}_start(){b()}_moving(){b()}_end(){b()}_animate(){b()}_drag(){this._processMove(...arguments),this.proxyMethods.onMove.call(this,...arguments)}_draw(){this._animate()}_onMouseDown(t){this._start(t),f(document).on("mousemove",this._onMouseMove).on("mouseup",this._onMouseUp)}_onTouchStart(e){this._start(e.touches[0]),f(document).on("touchmove",this._onTouchMove,t).on("touchend",this._onTouchEnd,t)}_onMouseMove(t){t.preventDefault&&t.preventDefault(),this._moving(t,this.el)}_onTouchMove(t){t.preventDefault&&t.preventDefault(),this._moving(t.touches[0],this.el)}_onMouseUp(t){f(document).off("mousemove",this._onMouseMove).off("mouseup",this._onMouseUp),this._end(t,this.el)}_onTouchEnd(t){f(document).off("touchmove",this._onTouchMove).off("touchend",this._onTouchEnd),0===t.touches.length&&this._end(t.changedTouches[0],this.el)}}function b(){throw Error("Method not implemented")}function m(t){return t.getBoundingClientRect()}function g(t){return t.css("-webkit-transform")||t.css("-moz-transform")||t.css("-ms-transform")||t.css("-o-transform")||t.css("transform")||"none"}function v(t){const e=t.match(/-?\d+\.?\d+|-?\d+/g);return e?e.map(t=>parseFloat(t)):[1,0,0,1,0,0]}function _(t,e){if(e){if(t.classList){if(!(e.indexOf(" ")>-1))return t.classList.add(e);e.split(/\s+/).forEach(e=>t.classList.add(e))}return t}}function M(t,e){if(e){if(t.classList){if(!(e.indexOf(" ")>-1))return t.classList.remove(e);e.split(/\s+/).forEach(e=>t.classList.remove(e))}return t}}const w=Math.PI/180;function E(t,e){if(0===e)return t;{const s=function(t,e){return 0===e?t:Math.round(t/e)*e}(t,e);if(s-t<e)return s}}function j(t,e,s,o,n,r,a,i,c){const l=parseFloat(s)/2,h=parseFloat(o)/2,u=t+l,d=e+h,p=t-u,f=e-d,x=Math.atan2(i?0:f,c?0:p)+n,y=Math.sqrt(Math.pow(c?0:l,2)+Math.pow(i?0:h,2));let b=Math.cos(x),m=Math.sin(x);const g=d+y*(m=!0===a?-m:m);return{left:T(u+y*(b=!0===r?-b:b)),top:T(g)}}function T(t,e=6){return Number(t.toFixed(e))}class V extends y{constructor(t,e,s){if(super(t),this.constructor===V)throw new TypeError("Cannot construct Transformable instances directly");this.observable=s,this.enable(e)}_cursorPoint(){throw Error("'_cursorPoint()' method not implemented")}_rotate(){this._processRotate(...arguments),this.proxyMethods.onRotate.call(this,...arguments)}_resize(){this._processResize(...arguments),this.proxyMethods.onResize.call(this,...arguments)}_processOptions(t){const{el:e}=this;_(e,"sjx-drag");const s={x:10,y:10,angle:10*w},o={move:!1,resize:!1,rotate:!1};let n=null,r=!1,a="xy",i="auto",h="auto",d="auto",p="#00a8ff",x=!1,y=()=>{},b=()=>{},m=()=>{},g=()=>{},v=()=>{},M=()=>{},E=e.parentNode;if(c(t)){const{snap:_,each:j,axis:T,cursorMove:V,cursorResize:k,cursorRotate:A,rotationPoint:C,restrict:S,onInit:N,onDrop:R,onMove:D,onResize:z,onRotate:X,onDestroy:Y,container:P,proportions:B,themeColor:$}=t;if(c(_)){const{x:t,y:e,angle:o}=_;s.x=l(t)?10:t,s.y=l(e)?10:e,s.angle=l(o)?s.angle:o*w}if(c(j)){const{move:t,resize:e,rotate:s}=j;o.move=t||!1,o.resize=e||!1,o.rotate=s||!1}c(S)&&(n="parent"===S?e.parentNode:f(S)[0]||document),p=$||"#00a8ff",i=V||"auto",h=k||"auto",d=A||"auto",a=T||"xy",E=c(P)&&f(P)[0]?f(P)[0]:E,x=C||!1,r=B||!1,y=u(N),v=u(R),b=u(D),g=u(z),m=u(X),M=u(Y)}this.options={axis:a,themeColor:p,cursorMove:i,cursorRotate:d,cursorResize:h,rotationPoint:x,restrict:n,container:E,snap:s,each:o,proportions:r},this.proxyMethods={onInit:y,onDrop:v,onMove:b,onResize:g,onRotate:m,onDestroy:M},this.subscribe(o)}_animate(){const t=this,{observable:s,storage:o,options:n}=t;if(l(o))return;if(o.frame=e(t._animate),!o.doDraw)return;o.doDraw=!1;let{dox:r,doy:a,clientX:i,clientY:h,doDrag:u,doResize:d,doRotate:p,doSetCenter:f,revX:x,revY:y,handle:b}=o;const{snap:m,each:g,restrict:v}=n,{move:_,resize:M,rotate:w}=g;if(d){const{transform:e,cx:n,cy:c}=o,{x:l,y:u}=this._pointToElement({x:i,y:h});let d=r?E(l-n,m.x/e.scX):0,p=a?E(u-c,m.y/e.scY):0;d=r?x?-d:d:0,p=a?y?-p:p:0,t._resize(d,p,b[0]),M&&s.notify("onresize",t,{dx:d,dy:p,handle:b[0]})}if(u){const{restrictOffset:e,elementOffset:n,nx:l,ny:u}=o;c(v)&&(i-e.left<l-n.left&&(i=l-n.left+e.left),h-e.top<u-n.top&&(h=u-n.top+e.top));const d=r?E(i-l,m.x):0,p=a?E(h-u,m.y):0;t._drag(d,p),_&&s.notify("onmove",t,{dx:d,dy:p})}if(p){const{pressang:e,center:n}=o,r=Math.atan2(h-n.y,i-n.x)-e;t._rotate(E(r,m.angle)),w&&s.notify("onrotate",t,{radians:r})}if(f){const{bx:e,by:s}=o,{x:n,y:r}=this._pointToControls({x:i,y:h});t._moveCenterHandle(n-e,r-s)}}_start(t){const{observable:e,storage:s,options:o,el:n}=this,r=this._compute(t);Object.keys(r).forEach(t=>{s[t]=r[t]});const{onRightEdge:a,onBottomEdge:i,onTopEdge:l,onLeftEdge:h,handle:u,factor:d,revX:p,revY:f,doW:x,doH:y}=r,b=a||i||l||h,{handles:g,radius:v}=s,{axis:_,restrict:w}=o;c(v)&&M(v,"sjx-hidden");const E=u.is(g.rotator),j=!!c(g.center)&&u.is(g.center),{clientX:T,clientY:V}=t,{x:k,y:A}=this._cursorPoint({clientX:T,clientY:V}),{x:C,y:S}=this._pointToElement({x:k,y:A}),{x:N,y:R}=this._pointToControls({x:k,y:A}),D={clientX:T,clientY:V,nx:k,ny:A,cx:C,cy:S,bx:N,by:R,doResize:b,doDrag:!(E||b||j),doRotate:E,doSetCenter:j,onExecution:!0,cursor:null,elementOffset:m(n),restrictOffset:c(w)?m(w):null,dox:/\x/.test(_)&&(!b||(u.is(g.ml)||u.is(g.mr)||u.is(g.tl)||u.is(g.tr)||u.is(g.bl)||u.is(g.br))),doy:/\y/.test(_)&&(!b||(u.is(g.br)||u.is(g.bl)||u.is(g.bc)||u.is(g.tr)||u.is(g.tl)||u.is(g.tc)))};this.storage={...s,...D},e.notify("ongetstate",this,{factor:d,revX:p,revY:f,doW:x,doH:y}),this._draw()}_moving(t){const{storage:e,options:s}=this,{x:o,y:n}=this._cursorPoint(t);e.e=t,e.clientX=o,e.clientY=n,e.doDraw=!0;let{doRotate:r,doDrag:a,doResize:i,cursor:c}=e;const{cursorMove:h,cursorResize:u,cursorRotate:d}=s;l(c)&&(a?c=h:r?c=d:i&&(c=u),f(document.body).css({cursor:c}))}_end(t){const{observable:e,storage:o,proxyMethods:n,el:r}=this,{doResize:a,doDrag:i,frame:l,radius:h}=o,u=a?"resize":i?"drag":"rotate";o.doResize=!1,o.doDrag=!1,o.doRotate=!1,o.doSetCenter=!1,o.doDraw=!1,o.onExecution=!1,o.cursor=null,this._apply(u),n.onDrop.call(this,t,r),e.notify("onapply",this,{actionName:u,e:t}),s(l),f(document.body).css({cursor:"auto"}),c(h)&&_(h,"sjx-hidden")}_checkHandles(t,e){const s=t.is(e.tl),o=t.is(e.tc),n=t.is(e.tr),r=t.is(e.bl),a=t.is(e.bc),i=t.is(e.br),c=t.is(e.ml),l=t.is(e.mr);return{revX:s||c||r||o,revY:s||n||o||c,onTopEdge:o||n||s,onLeftEdge:s||c||r,onRightEdge:n||l||i,onBottomEdge:i||a||r,doW:c||l,doH:o||a}}notifyMove({dx:t,dy:e}){this._drag(t,e)}notifyRotate({radians:t}){const{snap:e}=this.options;this._rotate(E(t,e.angle))}notifyResize({dx:t,dy:e}){this._resize(t,e)}notifyApply({e:t,actionName:e}){this.proxyMethods.onDrop.call(this,t,this.el),this._apply(e)}notifyGetState(t){const{storage:e}=this,s=this._getState(t);this.storage={...e,...s}}subscribe(t){const{observable:e}=this,{resize:s,move:o,rotate:n}=t;(o||s||n)&&e.subscribe("ongetstate",this).subscribe("onapply",this),o&&e.subscribe("onmove",this),s&&e.subscribe("onresize",this),n&&e.subscribe("onrotate",this)}unsubscribe(){const{observable:t}=this;t.unsubscribe("ongetstate",this).unsubscribe("onapply",this).unsubscribe("onmove",this).unsubscribe("onresize",this).unsubscribe("onrotate",this)}disable(){const{storage:e,proxyMethods:s,el:o}=this;l(e)||(e.onExecution&&(this._end(),f(document).off("mousemove",this._onMouseMove).off("mouseup",this._onMouseUp).off("touchmove",this._onTouchMove,t).off("touchend",this._onTouchEnd,t)),M(o,"sjx-drag"),this._destroy(),this.unsubscribe(),s.onDestroy.call(this,o),delete this.storage)}}const k=2,A=7;class C extends V{constructor(t,e,s){super(t,e,s)}_init(t){const e=document.createElement("div");_(e,"sjx-wrapper"),t.parentNode.insertBefore(e,t);const{options:s}=this,{rotationPoint:o}=s,{left:n,top:r,width:a,height:i}=t.style,h=f(t),u=a||h.css("width"),d=i||h.css("height"),p={top:r||h.css("top"),left:n||h.css("left"),width:u,height:d,transform:g(h)},x=document.createElement("div");_(x,"sjx-controls");const y={normal:["sjx-normal"],tl:["sjx-hdl","sjx-hdl-t","sjx-hdl-l","sjx-hdl-tl"],tr:["sjx-hdl","sjx-hdl-t","sjx-hdl-r","sjx-hdl-tr"],br:["sjx-hdl","sjx-hdl-b","sjx-hdl-r","sjx-hdl-br"],bl:["sjx-hdl","sjx-hdl-b","sjx-hdl-l","sjx-hdl-bl"],tc:["sjx-hdl","sjx-hdl-t","sjx-hdl-c","sjx-hdl-tc"],bc:["sjx-hdl","sjx-hdl-b","sjx-hdl-c","sjx-hdl-bc"],ml:["sjx-hdl","sjx-hdl-m","sjx-hdl-l","sjx-hdl-ml"],mr:["sjx-hdl","sjx-hdl-m","sjx-hdl-r","sjx-hdl-mr"],center:o?["sjx-hdl","sjx-hdl-m","sjx-hdl-c","sjx-hdl-mc"]:void 0,rotator:["sjx-hdl","sjx-hdl-m","sjx-rotator"]};if(Object.keys(y).forEach(t=>{const e=y[t];if(l(e))return;const s=function(t){const e=document.createElement("div");return t.forEach(t=>{_(e,t)}),e}(e);y[t]=s,x.appendChild(s)}),c(y.center)){f(y.center).css({left:`${t.getAttribute("data-cx")}px`,top:`${t.getAttribute("data-cy")}px`})}e.appendChild(x);const b=f(x);b.css(p),this.storage={controls:x,handles:y,radius:void 0,parent:t.parentNode},b.on("mousedown",this._onMouseDown).on("touchstart",this._onTouchStart)}_destroy(){const{controls:t}=this.storage;f(t).off("mousedown",this._onMouseDown).off("touchstart",this._onTouchStart);const e=t.parentNode;e.parentNode.removeChild(e)}_compute(t){const{handles:e}=this.storage,s=f(t.target),{revX:o,revY:n,onTopEdge:r,onLeftEdge:a,onRightEdge:i,onBottomEdge:c,doW:l,doH:h}=this._checkHandles(s,e),u=s.is(e.tr)||s.is(e.bl)?-1:1,d=this._getState({factor:u,revX:o,revY:n,doW:l,doH:h}),{x:p,y:x}=this._cursorPoint(t),y=Math.atan2(x-d.center.y,p-d.center.x);return{...d,onTopEdge:r,onLeftEdge:a,onRightEdge:i,onBottomEdge:c,handle:s,pressang:y}}_pointToElement({x:t,y:e}){const{transform:s}=this.storage,o=[...s.matrix];return o[4]=o[5]=0,this._applyMatrixToPoint(R(o),t,e)}_pointToControls(t){return this._pointToElement(t)}_applyMatrixToPoint(t,e,s){return N({x:e,y:s},t)}_cursorPoint({clientX:t,clientY:e}){const{container:s}=this.options;return N({x:t,y:e},R(v(g(f(s)))))}_apply(){const{el:t,storage:e}=this,s=f(t),{cached:o,controls:n,transform:r,handles:a}=e,i=f(n),h=parseFloat(i.css("width"))/2,u=parseFloat(i.css("height"))/2,{center:d}=a,p=c(d),x=p?parseFloat(f(d).css("left")):h,y=p?parseFloat(f(d).css("top")):u;if(t.setAttribute("data-cx",x),t.setAttribute("data-cy",y),l(o))return;const{dx:b,dy:m}=o,g=S(r.matrix),v=parseFloat(t.style.left||s.css("left")),_=parseFloat(t.style.top||s.css("top"));g.left=`${v+b}px`,g.top=`${_+m}px`,s.css(g),i.css(g),this.storage.cached=null}_processResize(t,e){const{el:s,storage:o,options:n}=this,{proportions:r}=n,{controls:a,coords:i,cw:c,ch:l,transform:h,refang:u,revX:d,revY:p,doW:x,doH:y}=o,b=x||!x&&!y?(c+t)/c:(l+e)/l,m=r?c*b:c+t,g=r?l*b:l+e;if(m<k||g<k)return;const v=[...h.matrix],_=j(v[4],v[5],m,g,u,d,p,x,y),M=i.left-_.left,w=i.top-_.top;v[4]+=M,v[5]+=w;const E=S(v);E.width=`${m}px`,E.height=`${g}px`,f(a).css(E),f(s).css(E),o.cached={dx:M,dy:w}}_processMove(t,e){const{el:s,storage:o}=this,{controls:n,transform:r}=o,{matrix:a,parentMatrix:i}=r,c=[...i];c[4]=c[5]=0;const l=[...a];l[4]=a[4]+t,l[5]=a[5]+e;const h=S(l);f(n).css(h),f(s).css(h),o.cached={dx:t,dy:e}}_processRotate(t){const{el:e,storage:s}=this,{controls:o,transform:n,center:r}=s,{matrix:a,parentMatrix:i}=n,c=T(Math.cos(t)),l=T(Math.sin(t)),h=[1,0,0,1,r.cx,r.cy],u=[c,l,-l,c,0,0],d=[...i];d[4]=d[5]=0;const p=D(R(d),D(u,d)),x=D(D(h,p),R(h)),y=S(D(x,a));f(o).css(y),f(e).css(y)}_getState(t){const{factor:e,revX:s,revY:o,doW:n,doH:r}=t,{el:a,storage:i,options:l}=this,{container:h}=l,{handles:u,controls:d,parent:p}=i,{center:x,tl:y,tr:b}=u,_=m(y),M=m(b),w=Math.atan2(M.top-_.top,M.left-_.left)*e,E=f(d),T=v(g(f(h))),V=v(g(f(d))),k=v(g(f(p))),C={matrix:V,parentMatrix:p===h?D(k,T):T,scX:Math.sqrt(V[0]*V[0]+V[1]*V[1]),scY:Math.sqrt(V[2]*V[2]+V[3]*V[3])},S=parseFloat(E.css("width")),N=parseFloat(E.css("height")),R=j(V[4],V[5],S,N,w,s,o,n,r),z=S/2,X=N/2,Y=m(a),P=c(x),B=P?parseFloat(f(x).css("left")):z,$=P?parseFloat(f(x).css("top")):X,L=P?A:0;return{transform:C,cw:S,ch:N,coords:R,center:{x:Y.left+B-L,y:Y.top+$-L,cx:-B+z-L,cy:-$+X-L,hx:B,hy:$},factor:e,refang:w,revX:s,revY:o,doW:n,doH:r}}_moveCenterHandle(t,e){const{storage:s}=this,{handles:o,center:n}=s,r=`${n.hx+t}px`,a=`${n.hy+e}px`;f(o.center).css({left:r,top:a})}resetCenterPoint(){const{handles:t}=this.storage;f(t.center).css({left:null,top:null})}get controls(){return this.storage.controls}}function S(t){const e=`matrix(${t.join()})`;return{transform:e,webkitTranform:e,mozTransform:e,msTransform:e,otransform:e}}function N(t,e){const{x:s,y:o}=t,[n,r,a,i,c,l]=e;return{x:n*s+a*o+c,y:r*s+i*o+l}}function R(t){const e=[[t[0],t[2],t[4]],[t[1],t[3],t[5]],[0,0,1]];if(e.length!==e[0].length)return;const s=e.length,o=[],n=[];for(let t=0;t<s;t+=1){o[o.length]=[],n[n.length]=[];for(let r=0;r<s;r+=1)o[t][r]=t==r?1:0,n[t][r]=e[t][r]}for(let t=0;t<s;t+=1){let e=n[t][t];if(0===e){for(let r=t+1;r<s;r+=1)if(0!==n[r][t]){for(let a=0;a<s;a++)e=n[t][a],n[t][a]=n[r][a],n[r][a]=e,e=o[t][a],o[t][a]=o[r][a],o[r][a]=e;break}if(0===(e=n[t][t]))return}for(let r=0;r<s;r++)n[t][r]=n[t][r]/e,o[t][r]=o[t][r]/e;for(let r=0;r<s;r++)if(r!=t){e=n[r][t];for(let a=0;a<s;a++)n[r][a]-=e*n[t][a],o[r][a]-=e*o[t][a]}}return[o[0][0],o[1][0],o[0][1],o[1][1],o[0][2],o[1][2]]}function D(t,e){const s=[[t[0],t[2],t[4]],[t[1],t[3],t[5]],[0,0,1]],o=[[e[0],e[2],e[4]],[e[1],e[3],e[5]],[0,0,1]],n=[];for(let t=0;t<o.length;t++){n[t]=[];for(let e=0;e<s[0].length;e++){let r=0;for(let n=0;n<s.length;n++)r+=s[n][e]*o[t][n];n[t].push(r)}}return[n[0][0],n[1][0],n[0][1],n[1][1],n[0][2],n[1][2]]}const z=["circle","ellipse","image","line","path","polygon","polyline","rect","text","g"];function X(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function Y(){return X("svg").createSVGMatrix()}function P(t,e){return(e.getScreenCTM()||Y()).inverse().multiply(t.getScreenCTM()||Y())}function B(t){return`matrix(${t.a},${t.b},${t.c},${t.d},${t.e},${t.f})`}function $(t,e,s,o){const n=e.createSVGPoint();return n.x=s,n.y=o,n.matrixTransform(t)}function L(t){const e=Y();return e.a=t.a,e.b=t.b,e.c=t.c,e.d=t.d,e.e=t.e,e.f=t.f,e}const O=/\s*([achlmqstvz])([^achlmqstvz]*)\s*/gi,F=/\s*,\s*|\s+/g;function H(t){let e=O.lastIndex=0;const s=[];for(;e=O.exec(t);){const t=e[1],o=t.toUpperCase(),n=e[2].replace(/([^e])-/g,"$1 -").replace(/ +/g," ");s.push({relative:t!==o,key:o,cmd:t,values:n.trim().split(F).map(t=>{if(!isNaN(t))return Number(t)})})}return s}function W(t){const{path:e,dx:s,dy:o}=t;try{const t=H(e);let n="",r=" ",a=!0;for(let e=0,i=t.length;e<i;e++){const i=t[e],{values:c,key:l,relative:h}=i,u=[];switch(l){case"M":for(let t=0,e=c.length;t<e;t+=2){const[e,n]=c.slice(t,t+2);h&&!a||(e+=s,n+=o),u.push(e,n),a=!1}break;case"A":for(let t=0,e=c.length;t<e;t+=7){const e=c.slice(t,t+7);h||(e[5]+=s,e[6]+=o),u.push(...e)}break;case"C":for(let t=0,e=c.length;t<e;t+=6){const e=c.slice(t,t+6);h||(e[0]+=s,e[1]+=o,e[2]+=s,e[3]+=o,e[4]+=s,e[5]+=o),u.push(...e)}break;case"H":for(let t=0,e=c.length;t<e;t+=1){const e=c.slice(t,t+1);h||(e[0]+=s),u.push(e[0])}break;case"V":for(let t=0,e=c.length;t<e;t+=1){const e=c.slice(t,t+1);h||(e[0]+=o),u.push(e[0])}break;case"L":case"T":for(let t=0,e=c.length;t<e;t+=2){const[e,n]=c.slice(t,t+2);h||(e+=s,n+=o),u.push(e,n)}break;case"Q":case"S":for(let t=0,e=c.length;t<e;t+=4){const[e,n,r,a]=c.slice(t,t+4);h||(e+=s,n+=o,r+=s,a+=o),u.push(e,n,r,a)}break;case"Z":c[0]="",r=""}n+=i.cmd+u.join(",")+r}return n}catch(t){i("Path parsing error: "+t)}}function q(t){const{path:e,localCTM:s,container:o}=t;try{const t=H(e);let n="",r=" ";const a=[];let i=!0;for(let e=0,c=t.length;e<c;e++){const c=t[e],{values:l,key:h,relative:u}=c;switch(h){case"A":{const t=[];for(let e=0,n=l.length;e<n;e+=7){const[n,r,a,i,c,h,d]=l.slice(e,e+7),p=L(s);u&&(p.e=p.f=0);const{x:f,y:x}=$(p,o,h,d);t.push(T(f),T(x)),p.e=p.f=0;const{x:y,y:b}=$(p,o,n,r);t.unshift(T(y),T(b),a,i,c)}a.push(t);break}case"C":{const t=[];for(let e=0,n=l.length;e<n;e+=6){const[n,r,a,i,c,h]=l.slice(e,e+6),d=L(s);u&&(d.e=d.f=0);const{x:p,y:f}=$(d,o,n,r),{x:x,y:y}=$(d,o,a,i),{x:b,y:m}=$(d,o,c,h);t.push(T(p),T(f),T(x),T(y),T(b),T(m))}a.push(t);break}case"H":{const t=[];for(let e=0,n=l.length;e<n;e+=1){const[n]=l.slice(e,e+1),r=L(s);u&&(r.e=r.f=0);const{x:a}=$(r,o,n,0);t.push(T(a))}a.push(t);break}case"V":{const t=[];for(let e=0,n=l.length;e<n;e+=1){const[n]=l.slice(e,e+1),r=L(s);u&&(r.e=r.f=0);const{y:a}=$(r,o,0,n);t.push(T(a))}a.push(t);break}case"T":case"L":{const t=[];for(let e=0,n=l.length;e<n;e+=2){const[n,r]=l.slice(e,e+2),a=L(s);u&&(a.e=a.f=0);const{x:i,y:c}=$(a,o,n,r);t.push(T(i),T(c))}a.push(t);break}case"M":{const t=[];for(let e=0,n=l.length;e<n;e+=2){const[n,r]=l.slice(e,e+2),a=L(s);u&&!i&&(a.e=a.f=0);const{x:c,y:h}=$(a,o,n,r);t.push(T(c),T(h)),i=!1}a.push(t);break}case"Q":{const t=[];for(let e=0,n=l.length;e<n;e+=4){const[n,r,a,i]=l.slice(e,e+4),c=L(s);u&&(c.e=c.f=0);const{x:h,y:d}=$(c,o,n,r),{x:p,y:f}=$(c,o,a,i);t.push(T(h),T(d),T(p),T(f))}a.push(t);break}case"S":{const t=[];for(let e=0,n=l.length;e<n;e+=4){const[n,r,a,i]=l.slice(e,e+4),c=L(s);u&&(c.e=c.f=0);const{x:h,y:d}=$(c,o,n,r),{x:p,y:f}=$(c,o,a,i);t.push(T(h),T(d),T(p),T(f))}a.push(t);break}case"Z":a.push([""]),r=""}n+=c.cmd+a[e].join(",")+r}return n}catch(t){i("Path parsing error: "+t)}}const I=5,G=50,U=/[+-]?\d+(\.\d+)?/g;class Q extends V{constructor(t,e,s){super(t,e,s)}_init(t){const{options:e}=this,{rotationPoint:s,container:o,themeColor:n}=e,r=X("g");_(r,"sjx-svg-wrapper"),o.appendChild(r);const{width:a,height:i,x:c,y:h}=t.getBBox(),u=P(t,o),d=X("rect");[["width",a],["height",i],["x",c],["y",h],["fill",n],["fill-opacity",.1],["stroke",n],["stroke-dasharray","3 3"],["vector-effect","non-scaling-stroke"],["transform",B(u)]].forEach(([t,e])=>{d.setAttribute(t,e)});const p=X("g"),x=X("g"),y=X("g");_(y,"sjx-svg-box-group"),_(p,"sjx-svg-handles"),_(x,"sjx-svg-normal-group"),y.appendChild(d),r.appendChild(y),r.appendChild(x),r.appendChild(p);const{x:b,y:m,width:g,height:v}=d.getBBox(),M=t.getAttribute("data-cx"),w=t.getAttribute("data-cy"),E=P(d,d.parentNode),j=$(E,o,b+g/2,m+v/2),T={tl:$(E,o,b,m),tr:$(E,o,b+g,m),br:$(E,o,b+g,m+v),bl:$(E,o,b,m+v),tc:$(E,o,b+g/2,m),bc:$(E,o,b+g/2,m+v),ml:$(E,o,b,m+v/2),mr:$(E,o,b+g,m+v/2),center:s?nt(o,M,w)||j:void 0,rotator:{}},V=Math.atan2(T.tl.y-T.tr.y,T.tl.x-T.tr.x);T.rotator.x=T.mr.x-G*Math.cos(V),T.rotator.y=T.mr.y-G*Math.sin(V);const k=X("line");k.x1.baseVal.value=T.mr.x,k.y1.baseVal.value=T.mr.y,k.x2.baseVal.value=T.rotator.x,k.y2.baseVal.value=T.rotator.y,ot(k,n),x.appendChild(k);let A=null;s&&(_(A=X("line"),"sjx-hidden"),A.x1.baseVal.value=j.x,A.y1.baseVal.value=j.y,A.x2.baseVal.value=M||j.x,A.y2.baseVal.value=w||j.y,ot(A,"#fe3232"),A.setAttribute("opacity",.5),x.appendChild(A)),Object.keys(T).forEach(t=>{const e=T[t];if(l(e))return;const{x:s,y:o}=e,r="center"===t?"#fe3232":n;T[t]=function(t,e,s,o){const n=X("circle");_(n,`sjx-svg-hdl-${o}`);const r={cx:t,cy:e,r:5.5,fill:s,stroke:"#fff","fill-opacity":1,"vector-effect":"non-scaling-stroke","stroke-width":1};return Object.keys(r).map(t=>{n.setAttribute(t,r[t])}),n}(s,o,r,t),p.appendChild(T[t])}),this.storage={wrapper:r,box:d,handles:T,normalLine:k,radius:s?A:void 0,parent:t.parentNode},f(r).on("mousedown",this._onMouseDown).on("touchstart",this._onTouchStart)}_destroy(){const{wrapper:t}=this.storage;f(t).off("mousedown",this._onMouseDown).off("touchstart",this._onTouchStart),t.parentNode.removeChild(t)}_compute(t){const{storage:e}=this,{handles:s}=e,o=f(t.target),{revX:n,revY:r,onTopEdge:a,onLeftEdge:i,onRightEdge:c,onBottomEdge:l,doW:h,doH:u}=this._checkHandles(o,s),d=this._getState({revX:n,revY:r,doW:h,doH:u}),{x:p,y:x}=this._cursorPoint(t),y=Math.atan2(x-d.center.y,p-d.center.x);return{...d,doW:h,doH:u,onTopEdge:a,onLeftEdge:i,onRightEdge:c,onBottomEdge:l,handle:o,pressang:y}}_cursorPoint({clientX:t,clientY:e}){const{container:s}=this.options;return $(s.getScreenCTM().inverse(),s,t,e)}_pointToElement({x:t,y:e}){const{transform:s}=this.storage,{ctm:o}=s,n=o.inverse();return n.e=n.f=0,this._applyMatrixToPoint(n,t,e)}_pointToControls({x:t,y:e}){const{transform:s}=this.storage,{boxCTM:o}=s,n=o.inverse();return n.e=n.f=0,this._applyMatrixToPoint(n,t,e)}_applyMatrixToPoint(t,e,s){const{container:o}=this.options,n=o.createSVGPoint();return n.x=e,n.y=s,n.matrixTransform(t)}_apply(t){const{el:e,storage:s,options:o}=this,{container:n}=o,{box:r,handles:a,cached:i,transform:h}=s,{matrix:u}=h,d=e.getBBox(),{x:p,y:f,width:x,height:y}=d,b=c(a.center)?$(h.boxCTM,n,a.center.cx.baseVal.value,a.center.cy.baseVal.value):$(u,n,p+x/2,f+y/2);if(e.setAttribute("data-cx",b.x),e.setAttribute("data-cy",b.y),l(i))return;const{scaleX:m,scaleY:g,dx:v,dy:_,ox:M,oy:w}=i;if("drag"===t){if(0===v&&0===_)return;const t=Y();t.e=v,t.f=_;const s=t.multiply(u).multiply(t.inverse());if(e.setAttribute("transform",B(s)),tt(e)){et(e).forEach(t=>{const s=n.createSVGPoint(),o=P(e.parentNode,n).inverse();s.x=M,s.y=w,o.e=o.f=0;const r=s.matrixTransform(o),a=Y();a.e=v,a.f=_;const i=a.multiply(P(t,t.parentNode)).multiply(a.inverse());(function(t){return 1===t.a&&0===t.b&&0===t.c&&1===t.d&&0===t.e&&0===t.f})(i)||t.setAttribute("transform",B(i)),tt(t)||Z(t,{x:r.x,y:r.y})})}else Z(e,{x:v,y:_})}if("resize"===t){const{x:t,y:o,width:a,height:i}=r.getBBox();if(K(s,{x:t,y:o,width:a,height:i},n),tt(e)){et(e).forEach(t=>{tt(t)||J(t,{scaleX:m,scaleY:g,defaultCTM:t.__ctm__,bBox:h.bBox,container:n,storage:s})})}else J(e,{scaleX:m,scaleY:g,defaultCTM:h.ctm,bBox:h.bBox,container:n,storage:s});e.setAttribute("transform",B(u))}this.storage.cached=null}_processResize(t,e){const{el:s,storage:o,options:n}=this,{container:r,proportions:a}=n,{box:i,left:c,top:l,cw:h,ch:u,transform:d,revX:p,revY:f,doW:x,doH:y}=this.storage,{matrix:b,scMatrix:m,trMatrix:g,scaleX:v,scaleY:_}=d;let{width:M,height:w}=i.getBBox();const E=x||!x&&!y?(h+t)/h:(u+e)/u;if(M=a?h*E:h+t,w=a?u*E:u+e,Math.abs(M)<I||Math.abs(w)<I)return;const j=M/h,T=w/u;m.a=j,m.b=0,m.c=0,m.d=T,m.e=0,m.f=0,g.e=v,g.f=_;const V=g.multiply(m).multiply(g.inverse()),k=b.multiply(V);s.setAttribute("transform",B(k)),this.storage.cached={scaleX:j,scaleY:T},K(o,{x:c-(M-h)*(y?.5:p?1:0),y:l-(w-u)*(x?.5:f?1:0),width:M,height:w},r)}_processMove(t,e){const{container:s}=this.options,{transform:o,wrapper:n,center:r}=this.storage,{matrix:a,trMatrix:i,scMatrix:c,wrapperMatrix:l,parentMatrix:h}=o;c.e=t,c.f=e;const u=c.multiply(l);n.setAttribute("transform",B(u)),h.e=h.f=0;const{x:d,y:p}=$(h.inverse(),s,t,e);i.e=d,i.f=p;const f=i.multiply(a);if(this.el.setAttribute("transform",B(f)),this.storage.cached={dx:d,dy:p,ox:t,oy:e},!r.isShifted)return;const x=l.inverse();x.e=x.f=0;const{x:y,y:b}=$(x,s,t,e);this._moveCenterHandle(-y,-b)}_processRotate(t){const{center:e,transform:s,wrapper:o}=this.storage,{matrix:n,wrapperMatrix:r,parentMatrix:a,trMatrix:i,scMatrix:c,rotMatrix:l}=s,h=T(Math.cos(t)),u=T(Math.sin(t));i.e=e.x,i.f=e.y,l.a=h,l.b=u,l.c=-u,l.d=h;const d=i.multiply(l).multiply(i.inverse()).multiply(r);o.setAttribute("transform",B(d)),c.e=e.el_x,c.f=e.el_y,a.e=a.f=0;const p=a.inverse().multiply(l).multiply(a),f=c.multiply(p).multiply(c.inverse()).multiply(n);this.el.setAttribute("transform",B(f))}_getState({revX:t,revY:e,doW:s,doH:o}){const{el:n,storage:r,options:a}=this,{container:i}=a,{box:l,wrapper:h,parent:u,handles:d}=r,{center:p}=d,f=n.getBBox(),{x:x,y:y,width:b,height:m}=f,{width:g,height:v,x:_,y:M}=l.getBBox(),w=P(n,u),E=P(n,i),j=P(l.parentNode,i),V=P(u,i),k=x+b*(o?.5:t?1:0),A=y+m*(s?.5:e?1:0),C={matrix:w,ctm:E,boxCTM:j,parentMatrix:V,wrapperMatrix:P(h,h.parentNode),trMatrix:Y(),scMatrix:Y(),rotMatrix:Y(),scaleX:k,scaleY:A,scX:Math.sqrt(E.a*E.a+E.b*E.b),scY:Math.sqrt(E.c*E.c+E.d*E.d),bBox:f},S=_+g/2,N=M+v/2,R=p?p.cx.baseVal.value:S,D=p?p.cy.baseVal.value:N,{x:z,y:X}=$(j,i,R,D),{x:B,y:L}=c(p)?$(V.inverse(),i,z,X):$(w,i,x+b/2,y+m/2),{x:O,y:F}=$(P(l,i),i,S,N);return et(n).forEach(t=>{t.__ctm__=P(t,i)}),{transform:C,cw:g,ch:v,center:{x:p?z:O,y:p?X:F,el_x:B,el_y:L,hx:p?p.cx.baseVal.value:null,hy:p?p.cy.baseVal.value:null,isShifted:T(O,3)!==T(z,3)&&T(F,3)!==T(X,3)},left:_,top:M,revX:t,revY:e,doW:s,doH:o}}_moveCenterHandle(t,e){const{handles:s,center:o,radius:n}=this.storage;l(s.center)||(s.center.cx.baseVal.value=o.hx+t,s.center.cy.baseVal.value=o.hy+e,n.x2.baseVal.value=o.hx+t,n.y2.baseVal.value=o.hy+e)}resetCenterPoint(){const{box:t,handles:e,radius:s}=this.storage,{center:o}=e,{container:n}=this.options,{width:r,height:a,x:i,y:c}=t.getBBox(),l=P(t,t.parentNode),{x:h,y:u}=$(l,n,i+r/2,c+a/2);o.cx.baseVal.value=h,o.cy.baseVal.value=u,o.isShifted=!1,s.x2.baseVal.value=h,s.y2.baseVal.value=u}get controls(){return this.storage.wrapper}}function Z(t,{x:e,y:s}){const o=[];switch(t.tagName.toLowerCase()){case"text":{const n=c(t.x.baseVal[0])?t.x.baseVal[0].value+e:(Number(t.getAttribute("x"))||0)+e,r=c(t.y.baseVal[0])?t.y.baseVal[0].value+s:(Number(t.getAttribute("y"))||0)+s;o.push(["x",n],["y",r]);break}case"use":case"image":case"rect":{const n=c(t.x.baseVal.value)?t.x.baseVal.value+e:(Number(t.getAttribute("x"))||0)+e,r=c(t.y.baseVal.value)?t.y.baseVal.value+s:(Number(t.getAttribute("y"))||0)+s;o.push(["x",n],["y",r]);break}case"circle":case"ellipse":{const n=t.cx.baseVal.value+e,r=t.cy.baseVal.value+s;o.push(["cx",n],["cy",r]);break}case"line":{const n=t.x1.baseVal.value+e,r=t.y1.baseVal.value+s,a=t.x2.baseVal.value+e,i=t.y2.baseVal.value+s;o.push(["x1",n],["y1",r],["x2",a],["y2",i]);break}case"polygon":case"polyline":{const n=st(t.getAttribute("points")).map(t=>(t[0]=Number(t[0])+e,t[1]=Number(t[1])+s,t.join(" "))).join(" ");o.push(["points",n]);break}case"path":{const n=t.getAttribute("d");o.push(["d",W({path:n,dx:e,dy:s})]);break}}o.forEach(e=>{t.setAttribute(e[0],e[1])})}function J(t,e){const{scaleX:s,scaleY:o,bBox:n,defaultCTM:r,container:a}=e,{width:i,height:l}=n,h=[],u=P(t,a),d=r.inverse().multiply(u);switch(t.tagName.toLowerCase()){case"text":{const e=c(t.x.baseVal[0])?t.x.baseVal[0].value:Number(t.getAttribute("x"))||0,n=c(t.y.baseVal[0])?t.y.baseVal[0].value:Number(t.getAttribute("y"))||0,{x:r,y:u}=$(d,a,e,n);h.push(["x",r+(s<0?i:0)],["y",u+(o<0?l:0)]);break}case"circle":{const e=t.r.baseVal.value,n=t.cx.baseVal.value,r=t.cy.baseVal.value,i=e*(Math.abs(s)+Math.abs(o))/2,{x:c,y:l}=$(d,a,n,r);h.push(["r",i],["cx",c],["cy",l]);break}case"image":case"rect":{const e=t.width.baseVal.value,n=t.height.baseVal.value,r=t.x.baseVal.value,i=t.y.baseVal.value,{x:c,y:l}=$(d,a,r,i),u=Math.abs(e*s),p=Math.abs(n*o);h.push(["x",c-(s<0?u:0)],["y",l-(o<0?p:0)],["width",u],["height",p]);break}case"ellipse":{const e=t.rx.baseVal.value,n=t.ry.baseVal.value,r=t.cx.baseVal.value,i=t.cy.baseVal.value,{x:c,y:l}=$(d,a,r,i),u=Y();u.a=s,u.d=o;const{x:p,y:f}=$(u,a,e,n);h.push(["rx",Math.abs(p)],["ry",Math.abs(f)],["cx",c],["cy",l]);break}case"line":{const e=t.x1.baseVal.value,s=t.y1.baseVal.value,o=t.x2.baseVal.value,n=t.y2.baseVal.value,{x:r,y:i}=$(d,a,e,s),{x:c,y:l}=$(d,a,o,n);h.push(["x1",r],["y1",i],["x2",c],["y2",l]);break}case"polygon":case"polyline":{const e=st(t.getAttribute("points")).map(t=>{const{x:e,y:s}=$(d,a,Number(t[0]),Number(t[1]));return t[0]=e,t[1]=s,t.join(" ")}).join(" ");h.push(["points",e]);break}case"path":{const e=t.getAttribute("d");h.push(["d",q({path:e,localCTM:d,container:a})]);break}}h.forEach(([e,s])=>{t.setAttribute(e,s)})}function K(t,e,s){const{box:o,handles:n,normalLine:r,radius:a,center:i}=t;let{x:h,y:u,width:d,height:p}=e;const f=d/2,x=p/2,y=P(o,o.parentNode),b=$(y,s,h+f,u+x),m={tl:$(y,s,h,u),tr:$(y,s,h+d,u),br:$(y,s,h+d,u+p),bl:$(y,s,h,u+p),tc:$(y,s,h+f,u),bc:$(y,s,h+f,u+p),ml:$(y,s,h,u+x),mr:$(y,s,h+d,u+x),rotator:{},center:!i.isShifted&&c(n.center)?b:void 0},g=Math.atan2(m.tl.y-m.tr.y,m.tl.x-m.tr.x);m.rotator.x=m.mr.x-G*Math.cos(g),m.rotator.y=m.mr.y-G*Math.sin(g),r.x1.baseVal.value=m.mr.x,r.y1.baseVal.value=m.mr.y,r.x2.baseVal.value=m.rotator.x,r.y2.baseVal.value=m.rotator.y,c(a)&&(a.x1.baseVal.value=b.x,a.y1.baseVal.value=b.y,i.isShifted||(a.x2.baseVal.value=b.x,a.y2.baseVal.value=b.y));const v={x:h+=d<0?d:0,y:u+=p<0?p:0,width:Math.abs(d),height:Math.abs(p)};Object.keys(v).forEach(t=>{o.setAttribute(t,v[t])}),Object.keys(m).forEach(t=>{const e=n[t],s=m[t];l(s)||(e.setAttribute("cx",s.x),e.setAttribute("cy",s.y))})}function tt(t){return"g"===t.tagName.toLowerCase()}function et(t){const e=[];return tt(t)?o.call(t.childNodes,t=>{if(1===t.nodeType){const s=t.tagName.toLowerCase();-1!==z.indexOf(s)&&("g"===s&&e.push(...et(t)),e.push(t))}}):e.push(t),e}function st(t){return t.match(U).reduce((t,e,s,o)=>(s%2==0&&t.push(o.slice(s,s+2)),t),[])}function ot(t,e){t.setAttribute("stroke",e),t.setAttribute("stroke-dasharray","3 3"),t.setAttribute("vector-effect","non-scaling-stroke")}function nt(t,e,s){if(l(e)||l(s))return null;const o=t.createSVGPoint();return o.x=e,o.y=s,o}function rt(t,e){if(this.length){const s=c(e)&&e instanceof x?e:new x;return a.call(this,(e,o)=>(o instanceof SVGElement?function(t){const e=t.tagName.toLowerCase();return-1!==z.indexOf(e)||(i("Selected element is not allowed to transform. Allowed elements:\ncircle, ellipse, image, line, path, polygon, polyline, rect, text, g"),!1)}(o)&&e.push(new Q(o,t,s)):e.push(new C(o,t,s)),e),[])}}class at extends y{constructor(t,e){super(t),this.enable(e)}_init(){const{el:t,options:e}=this,s=f(t),{style:o,appendTo:n}=e,r={position:"absolute","z-index":"2147483647",...o};this.storage={css:r,parent:c(n)?f(n)[0]:document.body},s.on("mousedown",this._onMouseDown).on("touchstart",this._onTouchStart)}_processOptions(t){let e={},s=null,o=document,n=()=>{},r=()=>{},a=()=>{},i=()=>{};if(c(t)){const{style:o,appendTo:l,stack:d,onInit:p,onMove:x,onDrop:y,onDestroy:b}=t;e=c(o)&&"object"==typeof o?o:e,s=l||null;const g=c(d)?f(d)[0]:document;n=u(p),r=u(x),a=h(y)?function(t){const{clone:e}=this.storage;(function(t,e){const{top:s,left:o}=m(t),{top:n,left:r}=m(e),a=f(t),i=f(e);return!(s<n||s+parseFloat(a.css("height"))>n+parseFloat(i.css("height"))||o<r||o+parseFloat(a.css("width"))>r+parseFloat(i.css("width")))})(e,g)&&y.call(this,t,this.el,e)}:()=>{},i=u(b)}this.options={style:e,appendTo:s,stack:o},this.proxyMethods={onInit:n,onDrop:a,onMove:r,onDestroy:i}}_start({clientX:t,clientY:e}){const{storage:s,el:o}=this,{parent:n,css:r}=s,{left:a,top:i}=m(n);r.left=`${t-a}px`,r.top=`${e-i}px`;const c=o.cloneNode(!0);f(c).css(r),s.clientX=t,s.clientY=e,s.cx=t,s.cy=e,s.clone=c,f(n)[0].appendChild(c),this._draw()}_moving({clientX:t,clientY:e}){const{storage:s}=this;s.clientX=t,s.clientY=e,s.doDraw=!0,s.doMove=!0}_end(t){const{storage:e}=this,{clone:o,frameId:n}=e;e.doDraw=!1,s(n),l(o)||(this.proxyMethods.onDrop.call(this,t),o.parentNode.removeChild(o),delete e.clone)}_animate(){const{storage:t}=this;t.frameId=e(this._animate);const{doDraw:s,clientX:o,clientY:n,cx:r,cy:a}=t;s&&(t.doDraw=!1,this._drag(o-r,n-a))}_processMove(t,e){const{clone:s}=this.storage,o=`translate(${t}px, ${e}px)`;f(s).css({transform:o,webkitTranform:o,mozTransform:o,msTransform:o,otransform:o})}_destroy(){const{storage:t,proxyMethods:e,el:s}=this;l(t)||(f(s).off("mousedown",this._onMouseDown).off("touchstart",this._onTouchStart),e.onDestroy.call(this,s),delete this.storage)}disable(){this._destroy()}}function it(t){if(this.length)return r.call(this,e=>new at(e,t))}class ct extends d{constructor(t){super(t)}drag(){return rt.call(this,...arguments)}clone(){return it.call(this,...arguments)}}function lt(t){return new ct(t)}Object.defineProperty(lt,"createObservable",{value:()=>new x}),Object.defineProperty(lt,"Subjx",{value:ct}),Object.defineProperty(lt,"Observable",{value:x});export default lt;
