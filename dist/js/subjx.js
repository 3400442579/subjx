/*@license
* Drag/Rotate/Resize Library
* Released under the MIT license, 2018-2020
* Karen Sarksyan
* nichollascarter@gmail.com
*/
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).subjx=e()}(this,function(){"use strict";function rt(t){return(rt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function n(t,e,n){return e&&o(t.prototype,e),n&&o(t,n),t}function e(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,o)}return n}function it(r){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?e(Object(i),!0).forEach(function(t){var e,n,o;e=r,o=i[n=t],n in e?Object.defineProperty(e,n,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[n]=o}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(i)):e(Object(i)).forEach(function(t){Object.defineProperty(r,t,Object.getOwnPropertyDescriptor(i,t))})}return r}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&i(t,e)}function r(t){return(r=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function i(t,e){return(i=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function d(t,e){if(null==t)return{};var n,o,r=function(t,e){if(null==t)return{};var n,o,r={},i=Object.keys(t);for(o=0;o<i.length;o++)n=i[o],0<=e.indexOf(n)||(r[n]=t[n]);return r}(t,e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);for(o=0;o<i.length;o++)n=i[o],0<=e.indexOf(n)||Object.prototype.propertyIsEnumerable.call(t,n)&&(r[n]=t[n])}return r}function c(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function u(o){return function(){var t,e=r(o);if(function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}()){var n=r(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return c(this,t)}}function _(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var n=[],o=!0,r=!1,i=void 0;try{for(var s,a=t[Symbol.iterator]();!(o=(s=a.next()).done)&&(n.push(s.value),!e||n.length!==e);o=!0);}catch(t){r=!0,i=t}finally{try{o||null==a["return"]||a["return"]()}finally{if(r)throw i}}return n}(t,e)||l(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function w(t){return function(t){if(Array.isArray(t))return h(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||l(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function l(t,e){if(t){if("string"==typeof t)return h(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?h(t,e):void 0}}function h(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,o=new Array(e);n<e;n++)o[n]=t[n];return o}function st(t){return null==t}function at(t){return function(t){return"function"==typeof t}(t)?function(){t.call.apply(t,[this].concat(Array.prototype.slice.call(arguments)))}:function(){}}var ct=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||function(t){return setTimeout(t,1e3/60)},b=window.cancelAnimationFrame||window.mozCancelAnimationFrame||function(t){clearTimeout(t)},t=Array.prototype,f=t.slice,v=t.reduce,y=console.warn,ut=function(t){return null!=t},p=function(){function i(t){if(s(this,i),"string"==typeof t){var e=document.querySelectorAll(t);this.length=e.length;for(var n=0;n<this.length;n++)this[n]=e[n]}else if("object"!==rt(t)||1!==t.nodeType&&t!==document)if(t instanceof i){this.length=t.length;for(var o=0;o<this.length;o++)this[o]=t[o]}else{if(!function(t){return ut(t)&&"object"===rt(t)&&(Array.isArray(t)||ut(window.Symbol)&&"function"==typeof t[window.Symbol.iterator]||ut(t.forEach)||"number"==typeof t.length&&(0===t.length||0<t.length&&t.length-1 in t))}(t))throw new Error("Passed parameter must be selector/element/elementArray");for(var r=this.length=0;r<this.length;r++)1===t.nodeType&&(this[r]=t[r],this.length++)}else this[0]=t,this.length=1}return n(i,[{key:"css",value:function(n){var t={setStyle:function(t){return function(t,e){for(var n=t.length;n--;)for(var o in e)t[n].style[o]=e[o];return t.style}(this,t)},getStyle:function(){return function(t){for(var e=t.length;e--;)return t[e].currentStyle?t[e].currentStyle[n]:document.defaultView&&document.defaultView.getComputedStyle?document.defaultView.getComputedStyle(t[e],"")[n]:t[e].style[n]}(this)}};return"string"==typeof n?t.getStyle.apply(this,f.call(arguments,1)):"object"!==rt(n)&&n?(y("Method ".concat(n," does not exist")),!1):t.setStyle.apply(this,arguments)}},{key:"on",value:function(t,e,n,o){for(var r=this.length;r--;)this[r].events||(this[r].events={},this[r].events[t]=[]),"string"!=typeof e?document.addEventListener?this[r].addEventListener(t,e,n||{passive:!1}):document.attachEvent?this[r].attachEvent("on".concat(t),e):this[r]["on".concat(t)]=e:m(this[r],t,e,n,o,!0);return this}},{key:"off",value:function(t,e,n,o){for(var r=this.length;r--;)this[r].events||(this[r].events={},this[r].events[t]=[]),"string"!=typeof e?document.removeEventListener?this[r].removeEventListener(t,e,n):document.detachEvent?this[r].detachEvent("on".concat(t),e):this[r]["on".concat(t)]=null:m(this[r],t,e,n,o,!1);return this}},{key:"is",value:function(t){if(st(t))return!1;for(var e=lt(t),n=this.length;n--;)if(this[n]===e[n])return!0;return!1}}]),i}();function m(t,e,n,o,r,i){function s(t){for(var e=t.target;e&&e!==this;)e.matches(n)&&o.call(e,t),e=e.parentNode}!0===i?document.addEventListener?t.addEventListener(e,s,r||{passive:!1}):document.attachEvent?t.attachEvent("on".concat(e),s):t["on".concat(e)]=s:document.removeEventListener?t.removeEventListener(e,s,r||{passive:!1}):document.detachEvent?t.detachEvent("on".concat(e),s):t["on".concat(e)]=null}function lt(t){return new p(t)}function ht(t,e){if(0===e)return t;var n=z(t,e);return n-t<e?n:void 0}function x(t,e){var n=1<arguments.length&&void 0!==e?e:6;return Number(t.toFixed(n))}function I(t){return t.getBoundingClientRect()}function T(t){return t.css("-webkit-transform")||t.css("-moz-transform")||t.css("-ms-transform")||t.css("-o-transform")||t.css("transform")||"none"}function D(t){var e=t.match(/[+\-]?(?:0|[1-9]\d*)(?:\.\d*)?(?:[eE][+\-]?\d+)?/g);return e?e.map(function(t){return parseFloat(t)}):[1,0,0,1,0,0]}function ft(e,t){if(t){if(e.classList){if(!(-1<t.indexOf(" ")))return e.classList.add(t);t.split(/\s+/).forEach(function(t){return e.classList.add(t)})}return e}}function q(e,t){if(t){if(e.classList){if(!(-1<t.indexOf(" ")))return e.classList.remove(t);t.split(/\s+/).forEach(function(t){return e.classList.remove(t)})}return e}}function M(t){var e="matrix(".concat(t.join(),")");return{transform:e,webkitTranform:e,mozTransform:e,msTransform:e,otransform:e}}function P(t,e){var n=t.x,o=t.y,r=_(e,6),i=r[0],s=r[1],a=r[2],c=r[3];return{x:i*n+a*o+r[4],y:s*n+c*o+r[5]}}function X(t){var e=[[t[0],t[2],t[4]],[t[1],t[3],t[5]],[0,0,1]];if(e.length===e[0].length){for(var n=e.length,o=[],r=[],i=0;i<n;i+=1){o[o.length]=[],r[r.length]=[];for(var s=0;s<n;s+=1)o[i][s]=i==s?1:0,r[i][s]=e[i][s]}for(var a=0;a<n;a+=1){var c=r[a][a];if(0===c){for(var u=a+1;u<n;u+=1)if(0!==r[u][a]){for(var l=0;l<n;l++)c=r[a][l],r[a][l]=r[u][l],r[u][l]=c,c=o[a][l],o[a][l]=o[u][l],o[u][l]=c;break}if(0===(c=r[a][a]))return}for(var h=0;h<n;h++)r[a][h]=r[a][h]/c,o[a][h]=o[a][h]/c;for(var f=0;f<n;f++)if(f!=a){c=r[f][a];for(var d=0;d<n;d++)r[f][d]-=c*r[a][d],o[f][d]-=c*o[a][d]}}return[o[0][0],o[1][0],o[0][1],o[1][1],o[0][2],o[1][2]]}}function Y(t,e){for(var n=_(t,6),o=n[0],r=n[1],i=n[2],s=n[3],a=n[4],c=n[5],u=_(e,6),l=u[0],h=u[1],f=u[2],d=u[3],v=[[o,i,a],[r,s,c],[0,0,1]],y=[[l,f,u[4]],[h,d,u[5]],[0,0,1]],p=[],m=0;m<y.length;m++){p[m]=[];for(var b=0;b<v[0].length;b++){for(var g=0,x=0;x<v.length;x++)g+=v[x][b]*y[m][x];p[m].push(g)}}return[p[0][0],p[1][0],p[0][1],p[1][1],p[0][2],p[1][2]]}function A(t,e,n,o,r,i,s,a,c){var u=parseFloat(n)/2,l=parseFloat(o)/2,h=t+u,f=e+l,d=t-h,v=e-f,y=Math.atan2(a?0:v,c?0:d)+r,p=Math.sqrt(Math.pow(c?0:u,2)+Math.pow(a?0:l,2)),m=Math.cos(y),b=Math.sin(y),g=f+p*(b=!0===s?-b:b);return{left:x(h+p*(m=!0===i?-m:m)),top:x(g)}}var g=function(){function t(){s(this,t),this.observers={}}return n(t,[{key:"subscribe",value:function(t,e){var n=this.observers;return st(n[t])&&Object.defineProperty(n,t,{value:[]}),n[t].push(e),this}},{key:"unsubscribe",value:function(t,e){var n=this.observers;if(ut(n[t])){var o=n[t].indexOf(e);n[t].splice(o,1)}return this}},{key:"notify",value:function(e,n,o){st(this.observers[e])||this.observers[e].forEach(function(t){if(n!==t)switch(e){case"onmove":t.notifyMove(o);break;case"onrotate":t.notifyRotate(o);break;case"onresize":t.notifyResize(o);break;case"onapply":t.notifyApply(o);break;case"ongetstate":t.notifyGetState(o)}})}}]),t}(),k=function(){function e(t){s(this,e),this.name=t,this.callbacks=[]}return n(e,[{key:"registerCallback",value:function(t){this.callbacks.push(t)}},{key:"removeCallback",value:function(t){var e=this.callbacks(t);this.callbacks.splice(e,1)}}]),e}(),E=function(){function t(){s(this,t),this.events={}}return n(t,[{key:"registerEvent",value:function(t){this.events[t]=new k(t)}},{key:"emit",value:function(e,t,n){this.events[t].callbacks.forEach(function(t){t.call(e,n)})}},{key:"addEventListener",value:function(t,e){this.events[t].registerCallback(e)}},{key:"removeEventListener",value:function(t,e){this.events[t].removeCallback(e)}}]),t}(),j=function(){function e(t){s(this,e),this.el=t,this.storage=null,this.proxyMethods=null,this.eventDispatcher=new E,this._onMouseDown=this._onMouseDown.bind(this),this._onTouchStart=this._onTouchStart.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this._onTouchMove=this._onTouchMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._onTouchEnd=this._onTouchEnd.bind(this),this._animate=this._animate.bind(this)}return n(e,[{key:"enable",value:function(t){this._processOptions(t),this._init(this.el),this.proxyMethods.onInit.call(this,this.el)}},{key:"disable",value:function(){O()}},{key:"_init",value:function(){O()}},{key:"_destroy",value:function(){O()}},{key:"_processOptions",value:function(){O()}},{key:"_start",value:function(){O()}},{key:"_moving",value:function(){O()}},{key:"_end",value:function(){O()}},{key:"_animate",value:function(){O()}},{key:"_drag",value:function(t){var e=t.dx,n=t.dy,o=d(t,["dx","dy"]),r=it({dx:e,dy:n,transform:this._processMove(e,n)},o);this.proxyMethods.onMove.call(this,r),this._emitEvent("drag",r)}},{key:"_draw",value:function(){this._animate()}},{key:"_onMouseDown",value:function(t){this._start(t),lt(document).on("mousemove",this._onMouseMove).on("mouseup",this._onMouseUp)}},{key:"_onTouchStart",value:function(t){this._start(t.touches[0]),lt(document).on("touchmove",this._onTouchMove).on("touchend",this._onTouchEnd)}},{key:"_onMouseMove",value:function(t){t.preventDefault&&t.preventDefault(),this._moving(t,this.el)}},{key:"_onTouchMove",value:function(t){t.preventDefault&&t.preventDefault(),this._moving(t.touches[0],this.el)}},{key:"_onMouseUp",value:function(t){lt(document).off("mousemove",this._onMouseMove).off("mouseup",this._onMouseUp),this._end(t,this.el)}},{key:"_onTouchEnd",value:function(t){lt(document).off("touchmove",this._onTouchMove).off("touchend",this._onTouchEnd),0===t.touches.length&&this._end(t.changedTouches[0],this.el)}},{key:"_emitEvent",value:function(){var t;(t=this.eventDispatcher).emit.apply(t,[this].concat(Array.prototype.slice.call(arguments)))}},{key:"on",value:function(t,e){return this.eventDispatcher.addEventListener(t,e),this}},{key:"off",value:function(t,e){return this.eventDispatcher.removeEventListener(t,e),this}}]),e}(),O=function(){throw Error("Method not implemented")},S=["dragStart","drag","dragEnd","resizeStart","resize","resizeEnd","rotateStart","rotate","rotateEnd","setPointStart","setPointEnd"],dt=Math.PI/180,z=function(t,e){return 0===e?t:Math.round(t/e)*e},R=function(){a(i,j);var r=u(i);function i(t,e,n){var o;if(s(this,i),(o=r.call(this,t)).constructor===i)throw new TypeError("Cannot construct Transformable instances directly");return o.observable=n,S.forEach(function(t){o.eventDispatcher.registerEvent(t)}),o.enable(e),o}return n(i,[{key:"_cursorPoint",value:function(){throw Error("'_cursorPoint()' method not implemented")}},{key:"_rotate",value:function(t){var e=t.radians,n=d(t,["radians"]),o=it({transform:this._processRotate(e),delta:e},n);this.proxyMethods.onRotate.call(this,o),this._emitEvent("rotate",o)}},{key:"_resize",value:function(t){var e=t.dx,n=t.dy,o=d(t,["dx","dy"]),r=it({},this._processResize(e,n),{dx:e,dy:n},o);this.proxyMethods.onResize.call(this,r),this._emitEvent("resize",r)}},{key:"_processOptions",value:function(t){var e=this.el;ft(e,"sjx-drag");var n={x:10,y:10,angle:10*dt},o={move:!1,resize:!1,rotate:!1},r=null,i=!1,s="xy",a="auto",c="auto",u="auto",l=!1,h=!0,f=!0,d=!0,v=null,y=50,p=!0,m=null,b=null,g=null,x=function(){},_=function(){},k=function(){},E=function(){},j=function(){},w=function(){},M=e.parentNode;if(ut(t)){var O=t.snap,S=t.each,z=t.axis,R=t.cursorMove,T=t.cursorResize,D=t.cursorRotate,P=t.rotationPoint,X=t.restrict,Y=t.draggable,A=t.resizable,C=t.rotatable,H=t.onInit,L=t.onDrop,N=t.onMove,F=t.onResize,W=t.onRotate,I=t.onDestroy,q=t.container,U=t.proportions,B=t.custom,V=t.rotatorAnchor,G=t.rotatorOffset,$=t.showNormal,J=t.resizeHandles,K=t.className;if(ut(O)){var Q=O.x,Z=O.y,tt=O.angle;n.x=st(Q)?10:Q,n.y=st(Z)?10:Z,n.angle=st(tt)?n.angle:tt*dt}if(ut(S)){var et=S.move,nt=S.resize,ot=S.rotate;o.move=et||!1,o.resize=nt||!1,o.rotate=ot||!1}ut(X)&&(r="parent"===X?e.parentNode:lt(X)[0]||document),a=R||"auto",c=T||"auto",u=D||"auto",s=z||"xy",M=ut(q)&&lt(q)[0]?lt(q)[0]:M,l=P||!1,i=U||!1,h=!ut(Y)||Y,f=!ut(A)||A,d=!ut(C)||C,m="object"===rt(B)&&B||null,v=V||null,y=G||50,p=!ut($)||$,b=ut(J)?J:null,g=ut(K)?K:null,x=at(H),j=at(L),_=at(N),E=at(F),k=at(W),w=at(I)}this.options={axis:s,cursorMove:a,cursorRotate:u,cursorResize:c,rotationPoint:l,restrict:r,container:M,snap:n,each:o,proportions:i,draggable:h,resizable:f,rotatable:d,custom:m,rotatorAnchor:v,rotatorOffset:y,showNormal:p,resizeHandles:b,className:g},this.proxyMethods={onInit:x,onDrop:j,onMove:_,onResize:E,onRotate:k,onDestroy:w},this.subscribe(o)}},{key:"_animate",value:function(){var t=this,e=t.observable,n=t.storage,o=t.options;if(!st(n)&&(n.frame=ct(t._animate),n.doDraw)){n.doDraw=!1;var r=n.dox,i=n.doy,s=n.clientX,a=n.clientY,c=n.doDrag,u=n.doResize,l=n.doRotate,h=n.doSetCenter,f=n.revX,d=n.revY,v=o.snap,y=o.each,p=y.move,m=y.resize,b=y.rotate,g=o.restrict,x=o.draggable,_=o.resizable,k=o.rotatable;if(u&&_){var E=n.transform,j=n.cx,w=n.cy,M=this._pointToElement({x:s,y:a}),O=M.x,S=M.y,z=r?ht(O-j,v.x/E.scX):0,R=i?ht(S-w,v.y/E.scY):0,T={dx:z=r?f?-z:z:0,dy:R=i?d?-R:R:0,clientX:s,clientY:a};t._resize(T),m&&e.notify("onresize",t,T)}if(c&&x){var D=n.restrictOffset,P=n.elementOffset,X=n.nx,Y=n.ny;if(ut(g)){var A=D.left,C=D.top,H=P.left,L=P.top,N=P.width,F=P.height,W=X-s,I=Y-a,q=g.clientWidth-N,U=g.clientHeight-F,B=L-C,V=H-A;B-I<0&&(a=Y-L+C),V-W<0&&(s=X-H+A),U<B-I&&(a=U+(Y-L+C)),q<V-W&&(s=q+(X-H+A))}var G={dx:r?ht(s-X,v.x):0,dy:i?ht(a-Y,v.y):0,clientX:s,clientY:a};t._drag(G),p&&e.notify("onmove",t,G)}if(l&&k){var $=n.pressang,J=n.center,K=Math.atan2(a-J.y,s-J.x)-$,Q={clientX:s,clientY:a};t._rotate(it({radians:ht(K,v.angle)},Q)),b&&e.notify("onrotate",t,it({radians:K},Q))}if(h&&k){var Z=n.bx,tt=n.by,et=this._pointToControls({x:s,y:a}),nt=et.x,ot=et.y;t._moveCenterHandle(nt-Z,ot-tt)}}}},{key:"_start",value:function(t){var e=this.observable,n=this.storage,o=this.options,r=o.axis,i=o.restrict,s=o.each,a=this.el,c=this._compute(t);Object.keys(c).forEach(function(t){n[t]=c[t]});var u=c.onRightEdge,l=c.onBottomEdge,h=c.onTopEdge,f=c.onLeftEdge,d=c.handle,v=c.factor,y=c.revX,p=c.revY,m=c.doW,b=c.doH,g=u||l||h||f,x=n.handles,_=x.rotator,k=x.center,E=x.radius;ut(E)&&q(E,"sjx-hidden");var j=d.is(_),w=!!ut(k)&&d.is(k),M=!(j||g||w),O=t.clientX,S=t.clientY,z=this._cursorPoint({clientX:O,clientY:S}),R=z.x,T=z.y,D=this._pointToElement({x:R,y:T}),P=D.x,X=D.y,Y=this._pointToControls({x:R,y:T}),A={clientX:O,clientY:S,nx:R,ny:T,cx:P,cy:X,bx:Y.x,by:Y.y,doResize:g,doDrag:M,doRotate:j,doSetCenter:w,onExecution:!0,cursor:null,elementOffset:I(a),restrictOffset:ut(i)?I(i):null,dox:/\x/.test(r)&&(!g||(d.is(x.ml)||d.is(x.mr)||d.is(x.tl)||d.is(x.tr)||d.is(x.bl)||d.is(x.br))),doy:/\y/.test(r)&&(!g||(d.is(x.br)||d.is(x.bl)||d.is(x.bc)||d.is(x.tr)||d.is(x.tl)||d.is(x.tc)))};this.storage=it({},n,{},A);var C={clientX:O,clientY:S};g?this._emitEvent("resizeStart",C):j?this._emitEvent("rotateStart",C):M&&this._emitEvent("dragStart",C);var H=s.move,L=s.resize,N=s.rotate,F=g?"resize":j?"rotate":"drag",W=g&&L||j&&N||M&&H;e.notify("ongetstate",this,{clientX:O,clientY:S,actionName:F,triggerEvent:W,factor:v,revX:y,revY:p,doW:m,doH:b}),this._draw()}},{key:"_moving",value:function(t){var e=this.storage,n=this.options,o=this._cursorPoint(t),r=o.x,i=o.y;e.e=t,e.clientX=r,e.clientY=i,e.doDraw=!0;var s=e.doRotate,a=e.doDrag,c=e.doResize,u=e.cursor,l=n.cursorMove,h=n.cursorResize,f=n.cursorRotate;st(u)&&(a?u=l:s?u=f:c&&(u=h),lt(document.body).css({cursor:u}))}},{key:"_end",value:function(t){var e=t.clientX,n=t.clientY,o=this.options.each,r=this.observable,i=this.storage,s=this.proxyMethods,a=i.doResize,c=i.doDrag,u=i.doRotate,l=i.frame,h=i.handles.radius,f=a?"resize":c?"drag":"rotate";i.doResize=!1,i.doDrag=!1,i.doRotate=!1,i.doSetCenter=!1,i.doDraw=!1,i.onExecution=!1,i.cursor=null,this._apply(f);var d={clientX:e,clientY:n};s.onDrop.call(this,d),a?this._emitEvent("resizeEnd",d):u?this._emitEvent("rotateEnd",d):c&&this._emitEvent("dragEnd",d);var v=o.move,y=o.resize,p=o.rotate,m=a&&y||u&&p||c&&v;r.notify("onapply",this,{clientX:e,clientY:n,actionName:f,triggerEvent:m}),b(l),lt(document.body).css({cursor:"auto"}),ut(h)&&ft(h,"sjx-hidden")}},{key:"_compute",value:function(t){var e=this.storage.handles,n=lt(t.target),o=this._checkHandles(n,e),r=o.revX,i=o.revY,s=o.doW,a=o.doH,c=d(o,["revX","revY","doW","doH"]),u=this._getState({revX:r,revY:i,doW:s,doH:a}),l=this._cursorPoint(t),h=l.x,f=l.y;return it({},u,{},c,{handle:n,pressang:Math.atan2(f-u.center.y,h-u.center.x)})}},{key:"_checkHandles",value:function(t,e){var n=e.tl,o=e.tc,r=e.tr,i=e.bl,s=e.br,a=e.bc,c=e.ml,u=e.mr,l=!!ut(n)&&t.is(n),h=!!ut(o)&&t.is(o),f=!!ut(r)&&t.is(r),d=!!ut(i)&&t.is(i),v=!!ut(a)&&t.is(a),y=!!ut(s)&&t.is(s),p=!!ut(c)&&t.is(c),m=!!ut(u)&&t.is(u);return{revX:l||p||d||h,revY:l||f||h||p,onTopEdge:h||f||l,onLeftEdge:l||p||d,onRightEdge:f||m||y,onBottomEdge:y||v||d,doW:p||m,doH:h||v}}},{key:"notifyMove",value:function(){this._drag.apply(this,arguments)}},{key:"notifyRotate",value:function(t){var e=t.radians,n=d(t,["radians"]),o=this.options.snap.angle;this._rotate(it({radians:ht(e,o)},n))}},{key:"notifyResize",value:function(){this._resize.apply(this,arguments)}},{key:"notifyApply",value:function(t){var e=t.clientX,n=t.clientY,o=t.actionName,r=t.triggerEvent;this.proxyMethods.onDrop.call(this,{clientX:e,clientY:n}),r&&(this._apply(o),this._emitEvent("".concat(o,"End"),{clientX:e,clientY:n}))}},{key:"notifyGetState",value:function(t){var e=t.clientX,n=t.clientY,o=t.actionName,r=t.triggerEvent,i=d(t,["clientX","clientY","actionName","triggerEvent"]);if(r){var s=this._getState(i);this.storage=it({},this.storage,{},s),this._emitEvent("".concat(o,"Start"),{clientX:e,clientY:n})}}},{key:"subscribe",value:function(t){var e=t.resize,n=t.move,o=t.rotate,r=this.observable;(n||e||o)&&r.subscribe("ongetstate",this).subscribe("onapply",this),n&&r.subscribe("onmove",this),e&&r.subscribe("onresize",this),o&&r.subscribe("onrotate",this)}},{key:"unsubscribe",value:function(){this.observable.unsubscribe("ongetstate",this).unsubscribe("onapply",this).unsubscribe("onmove",this).unsubscribe("onresize",this).unsubscribe("onrotate",this)}},{key:"disable",value:function(){var t=this.storage,e=this.proxyMethods,n=this.el;st(t)||(t.onExecution&&(this._end(),lt(document).off("mousemove",this._onMouseMove).off("mouseup",this._onMouseUp).off("touchmove",this._onTouchMove).off("touchend",this._onTouchEnd)),q(n,"sjx-drag"),this._destroy(),this.unsubscribe(),e.onDestroy.call(this,n),delete this.storage)}},{key:"exeDrag",value:function(t){var e=t.dx,n=t.dy;this.options.draggable&&(this.storage=it({},this.storage,{},this._getState({revX:!1,revY:!1,doW:!1,doH:!1})),this._drag({dx:e,dy:n}),this._apply("drag"))}},{key:"exeResize",value:function(t){var e=t.dx,n=t.dy,o=t.revX,r=t.revY,i=t.doW,s=t.doH;this.options.resizable&&(this.storage=it({},this.storage,{},this._getState({revX:o||!1,revY:r||!1,doW:i||!1,doH:s||!1})),this._resize({dx:e,dy:n}),this._apply("resize"))}},{key:"exeRotate",value:function(t){var e=t.delta;this.options.rotatable&&(this.storage=it({},this.storage,{},this._getState({revX:!1,revY:!1,doW:!1,doH:!1})),this._rotate({radians:e}),this._apply("rotate"))}}]),i}(),C=2,H=7,L=function(){a(e,R);var t=u(e);function e(){return s(this,e),t.apply(this,arguments)}return n(e,[{key:"_init",value:function(t){var e=this.options,n=e.rotationPoint,o=e.container,r=e.resizable,i=e.rotatable,s=e.showNormal,a=e.resizeHandles,c=e.className,u=t.style,l=u.left,h=u.top,f=u.width,d=u.height,v=document.createElement("div");ft(v,"sjx-wrapper"),ut(c)&&ft(v,c),o.appendChild(v);var y=lt(t),p=f||y.css("width"),m=d||y.css("height"),b={top:h||y.css("top"),left:l||y.css("left"),width:p,height:m,transform:T(y)},g=document.createElement("div");ft(g,"sjx-controls");var x=it({},i&&{normal:s?["sjx-normal"]:null,rotator:["sjx-hdl","sjx-hdl-m","sjx-rotator"]},{},r&&{tl:["sjx-hdl","sjx-hdl-t","sjx-hdl-l","sjx-hdl-tl"],tr:["sjx-hdl","sjx-hdl-t","sjx-hdl-r","sjx-hdl-tr"],br:["sjx-hdl","sjx-hdl-b","sjx-hdl-r","sjx-hdl-br"],bl:["sjx-hdl","sjx-hdl-b","sjx-hdl-l","sjx-hdl-bl"],tc:["sjx-hdl","sjx-hdl-t","sjx-hdl-c","sjx-hdl-tc"],bc:["sjx-hdl","sjx-hdl-b","sjx-hdl-c","sjx-hdl-bc"],ml:["sjx-hdl","sjx-hdl-m","sjx-hdl-l","sjx-hdl-ml"],mr:["sjx-hdl","sjx-hdl-m","sjx-hdl-r","sjx-hdl-mr"]},{center:n&&i?["sjx-hdl","sjx-hdl-m","sjx-hdl-c","sjx-hdl-mc"]:void 0});Object.keys(x).forEach(function(t){var e=a[t];if(!ut(e)||0!=e){var n=x[t];if(!st(n)){var o=N(n);x[t]=o,g.appendChild(o)}}}),ut(x.center)&&lt(x.center).css({left:"".concat(t.getAttribute("data-cx"),"px"),top:"".concat(t.getAttribute("data-cy"),"px")});v.appendChild(g);var _=lt(g);_.css(b),this.storage={controls:g,handles:x,radius:void 0,parent:t.parentNode},_.on("mousedown",this._onMouseDown).on("touchstart",this._onTouchStart)}},{key:"_destroy",value:function(){var t=this.storage.controls;lt(t).off("mousedown",this._onMouseDown).off("touchstart",this._onTouchStart);var e=t.parentNode;e.parentNode.removeChild(e)}},{key:"_pointToElement",value:function(t){var e=t.x,n=t.y,o=w(this.storage.transform.matrix);return o[4]=o[5]=0,this._applyMatrixToPoint(X(o),e,n)}},{key:"_pointToControls",value:function(t){return this._pointToElement(t)}},{key:"_applyMatrixToPoint",value:function(t,e,n){return P({x:e,y:n},t)}},{key:"_cursorPoint",value:function(t){var e=t.clientX,n=t.clientY,o=this.options.container,r=D(T(lt(o)));return P({x:e,y:n},X(r))}},{key:"_apply",value:function(){var t=this.el,e=this.storage,n=e.controls,o=e.handles,r=lt(n),i=parseFloat(r.css("width"))/2,s=parseFloat(r.css("height"))/2,a=o.center,c=ut(a),u=c?parseFloat(lt(a).css("left")):i,l=c?parseFloat(lt(a).css("top")):s;t.setAttribute("data-cx",u),t.setAttribute("data-cy",l),this.storage.cached=null}},{key:"_processResize",value:function(t,e){var n=this.el,o=this.storage,r=this.options.proportions,i=o.controls,s=o.coords,a=o.cw,c=o.ch,u=o.transform,l=o.refang,h=o.revX,f=o.revY,d=o.doW,v=o.doH,y=o.restrictOffset,p=o.handle,m=d||!d&&!v?(a+t)/a:(c+e)/c,b=r?a*m:a+t,g=r?c*m:c+e;if(!(b<=C||g<=C)){var x=w(u.matrix);ut(y)&&(0<t&&(-1<p[0].className.indexOf("sjx-hdl-l")?x[4]-t<0&&(b=a+x[4]):b+x[4]>y.width&&(b=y.width-x[4])),0<e&&(-1<p[0].className.indexOf("sjx-hdl-l")?x[5]-t<0&&(b=c+x[5]):g+x[5]>y.height&&(g=y.height-x[5])));var _=A(x[4],x[5],b,g,l,h,f,d,v),k=s.left-_.left,E=s.top-_.top;x[4]+=k,x[5]+=E;var j=M(x);return j.width="".concat(b,"px"),j.height="".concat(g,"px"),lt(i).css(j),lt(n).css(j),o.cached={dx:k,dy:E},{width:b,height:g,ox:k,oy:E}}}},{key:"_processMove",value:function(t,e){var n=this.el,o=this.storage,r=o.controls,i=o.transform,s=i.matrix,a=w(i.parentMatrix);a[4]=a[5]=0;var c=w(s);c[4]=s[4]+t,c[5]=s[5]+e;var u=M(c);return lt(r).css(u),lt(n).css(u),o.cached={dx:t,dy:e},c}},{key:"_processRotate",value:function(t){var e=this.el,n=this.storage,o=n.controls,r=n.transform,i=n.center,s=r.matrix,a=r.parentMatrix,c=x(Math.cos(t),4),u=x(Math.sin(t),4),l=[1,0,0,1,i.cx,i.cy],h=[c,u,-u,c,0,0],f=w(a);f[4]=f[5]=0;var d=Y(X(f),Y(h,f)),v=Y(Y(l,d),X(l)),y=Y(v,s),p=M(y);return lt(o).css(p),lt(e).css(p),y}},{key:"_getState",value:function(t){var e=t.revX,n=t.revY,o=t.doW,r=t.doH,i=e!==n?-1:1,s=this.el,a=this.storage,c=a.handles,u=a.controls,l=a.parent,h=this.options.container,f=c.center,d=lt(u),v=D(T(lt(h))),y=D(T(lt(u))),p=D(T(lt(l))),m=Math.atan2(y[1],y[0])*i,b=l!==h?Y(p,v):v,g={matrix:y,parentMatrix:b,scX:Math.sqrt(y[0]*y[0]+y[1]*y[1]),scY:Math.sqrt(y[2]*y[2]+y[3]*y[3])},x=parseFloat(d.css("width")),_=parseFloat(d.css("height")),k=A(y[4],y[5],x,_,m,e,n,o,r),E=x/2,j=_/2,w=I(s),M=ut(f),O=M?parseFloat(lt(f).css("left")):E,S=M?parseFloat(lt(f).css("top")):j,z=M?H:0,R=P({x:w.left,y:w.top},X(b));return{transform:g,cw:x,ch:_,coords:k,center:{x:R.x+O-z,y:R.y+S-z,cx:-O+E-z,cy:-S+j-z,hx:O,hy:S},factor:i,refang:m,revX:e,revY:n,doW:o,doH:r}}},{key:"_moveCenterHandle",value:function(t,e){var n=this.storage,o=n.handles.center,r=n.center,i=r.hx,s=r.hy,a="".concat(i+t,"px"),c="".concat(s+e,"px");lt(o).css({left:a,top:c})}},{key:"resetCenterPoint",value:function(){lt(this.storage.handles.center).css({left:null,top:null})}},{key:"fitControlsToSize",value:function(){}},{key:"controls",get:function(){return this.storage.controls}}]),e}(),N=function(t){var e=document.createElement("div");return t.forEach(function(t){ft(e,t)}),e};function F(n,t){if(this.length){var o=ut(t)&&t instanceof g?t:new g;return v.call(this,function(t,e){return t.push(new L(e,n,o)),t},[])}}var W=function(){a(e,p);var t=u(e);function e(){return s(this,e),t.apply(this,arguments)}return n(e,[{key:"drag",value:function(){return F.call.apply(F,[this].concat(Array.prototype.slice.call(arguments)))}}]),e}();function U(t){return new W(t)}return Object.defineProperty(U,"createObservable",{value:function(){return new g}}),Object.defineProperty(U,"Subjx",{value:W}),Object.defineProperty(U,"Observable",{value:g}),U});
