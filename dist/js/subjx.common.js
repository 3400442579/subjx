/*@license
* Drag/Rotate/Resize Library
* Released under the MIT license, 2018-2020
* Karen Sarksyan
* nichollascarter@gmail.com
*/
"use strict";const requestAnimFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||function(t){return setTimeout(t,1e3/60)},cancelAnimFrame=window.cancelAnimationFrame||window.mozCancelAnimationFrame||function(t){clearTimeout(t)},{forEach:forEach,slice:arrSlice,map:arrMap,reduce:arrReduce}=Array.prototype,{warn:warn}=console,isDef=t=>null!=t,isUndef=t=>null==t,isFunc=t=>"function"==typeof t,createMethod=t=>isFunc(t)?function(){t.call(this,...arguments)}:()=>{};class Helper{constructor(t){if("string"==typeof t){const e=document.querySelectorAll(t);this.length=e.length;for(let t=0;t<this.length;t++)this[t]=e[t]}else if("object"!=typeof t||1!==t.nodeType&&t!==document)if(t instanceof Helper){this.length=t.length;for(let e=0;e<this.length;e++)this[e]=t[e]}else{if(!isIterable(t))throw new Error("Passed parameter must be selector/element/elementArray");this.length=0;for(let e=0;e<this.length;e++)1===t.nodeType&&(this[e]=t[e],this.length++)}else this[0]=t,this.length=1}css(t){const e={setStyle(t){return((t,e)=>{let s=t.length;for(;s--;)for(const o in e)t[s].style[o]=e[o];return t.style})(this,t)},getStyle(){return(e=>{let s=e.length;for(;s--;)return e[s].currentStyle?e[s].currentStyle[t]:document.defaultView&&document.defaultView.getComputedStyle?document.defaultView.getComputedStyle(e[s],"")[t]:e[s].style[t]})(this)}};return"string"==typeof t?e.getStyle.apply(this,arrSlice.call(arguments,1)):"object"!=typeof t&&t?(warn(`Method ${t} does not exist`),!1):e.setStyle.apply(this,arguments)}on(){let t=this.length;for(;t--;)this[t].events||(this[t].events={},this[t].events[arguments[0]]=[]),"string"!=typeof arguments[1]?document.addEventListener?this[t].addEventListener(arguments[0],arguments[1],arguments[2]||{passive:!1}):document.attachEvent?this[t].attachEvent(`on${arguments[0]}`,arguments[1]):this[t][`on${arguments[0]}`]=arguments[1]:listenerDelegate(this[t],arguments[0],arguments[1],arguments[2],arguments[3],!0);return this}off(){let t=this.length;for(;t--;)this[t].events||(this[t].events={},this[t].events[arguments[0]]=[]),"string"!=typeof arguments[1]?document.removeEventListener?this[t].removeEventListener(arguments[0],arguments[1],arguments[2]):document.detachEvent?this[t].detachEvent(`on${arguments[0]}`,arguments[1]):this[t][`on${arguments[0]}`]=null:listenerDelegate(this[t],arguments[0],arguments[1],arguments[2],arguments[3],!1);return this}is(t){if(isUndef(t))return!1;const e=helper(t);let s=this.length;for(;s--;)if(this[s]===e[s])return!0;return!1}}function listenerDelegate(t,e,s,o,r,n){const i=function(t){let e=t.target;for(;e&&e!==this;)e.matches(s)&&o.call(e,t),e=e.parentNode};!0===n?document.addEventListener?t.addEventListener(e,i,r||{passive:!1}):document.attachEvent?t.attachEvent(`on${e}`,i):t[`on${e}`]=i:document.removeEventListener?t.removeEventListener(e,i,r||{passive:!1}):document.detachEvent?t.detachEvent(`on${e}`,i):t[`on${e}`]=null}function isIterable(t){return isDef(t)&&"object"==typeof t&&(Array.isArray(t)||isDef(window.Symbol)&&"function"==typeof t[window.Symbol.iterator]||isDef(t.forEach)||"number"==typeof t.length&&(0===t.length||t.length>0&&t.length-1 in t))}function helper(t){return new Helper(t)}class Observable{constructor(){this.observers={}}subscribe(t,e){const s=this.observers;return isUndef(s[t])&&Object.defineProperty(s,t,{value:[]}),s[t].push(e),this}unsubscribe(t,e){const s=this.observers;if(isDef(s[t])){const o=s[t].indexOf(e);s[t].splice(o,1)}return this}notify(t,e,s){isUndef(this.observers[t])||this.observers[t].forEach(o=>{if(e!==o)switch(t){case"onmove":o.notifyMove(s);break;case"onrotate":o.notifyRotate(s);break;case"onresize":o.notifyResize(s);break;case"onapply":o.notifyApply(s);break;case"ongetstate":o.notifyGetState(s)}})}}class Event{constructor(t){this.name=t,this.callbacks=[]}registerCallback(t){this.callbacks.push(t)}removeCallback(t){const e=this.callbacks(t);this.callbacks.splice(e,1)}}class EventDispatcher{constructor(){this.events={}}registerEvent(t){this.events[t]=new Event(t)}emit(t,e,s){this.events[e].callbacks.forEach(e=>{e.call(t,s)})}addEventListener(t,e){this.events[t].registerCallback(e)}removeEventListener(t,e){this.events[t].removeCallback(e)}}class SubjectModel{constructor(t){this.el=t,this.storage=null,this.proxyMethods=null,this.eventDispatcher=new EventDispatcher,this._onMouseDown=this._onMouseDown.bind(this),this._onTouchStart=this._onTouchStart.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this._onTouchMove=this._onTouchMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._onTouchEnd=this._onTouchEnd.bind(this),this._animate=this._animate.bind(this)}enable(t){this._processOptions(t),this._init(this.el),this.proxyMethods.onInit.call(this,this.el)}disable(){throwNotImplementedError()}_init(){throwNotImplementedError()}_destroy(){throwNotImplementedError()}_processOptions(){throwNotImplementedError()}_start(){throwNotImplementedError()}_moving(){throwNotImplementedError()}_end(){throwNotImplementedError()}_animate(){throwNotImplementedError()}_drag({dx:t,dy:e,...s}){const o={dx:t,dy:e,transform:this._processMove(t,e),...s};this.proxyMethods.onMove.call(this,o),this._emitEvent("drag",o)}_draw(){this._animate()}_onMouseDown(t){this._start(t),helper(document).on("mousemove",this._onMouseMove).on("mouseup",this._onMouseUp)}_onTouchStart(t){this._start(t.touches[0]),helper(document).on("touchmove",this._onTouchMove).on("touchend",this._onTouchEnd)}_onMouseMove(t){t.preventDefault&&t.preventDefault(),this._moving(t,this.el)}_onTouchMove(t){t.preventDefault&&t.preventDefault(),this._moving(t.touches[0],this.el)}_onMouseUp(t){helper(document).off("mousemove",this._onMouseMove).off("mouseup",this._onMouseUp),this._end(t,this.el)}_onTouchEnd(t){helper(document).off("touchmove",this._onTouchMove).off("touchend",this._onTouchEnd),0===t.touches.length&&this._end(t.changedTouches[0],this.el)}_emitEvent(){this.eventDispatcher.emit(this,...arguments)}on(t,e){return this.eventDispatcher.addEventListener(t,e),this}off(t,e){return this.eventDispatcher.removeEventListener(t,e),this}}const throwNotImplementedError=()=>{throw Error("Method not implemented")},EVENTS=["dragStart","drag","dragEnd","resizeStart","resize","resizeEnd","rotateStart","rotate","rotateEnd","setPointStart","setPointEnd"],RAD=Math.PI/180,snapToGrid=(t,e)=>{if(0===e)return t;{const s=snapCandidate(t,e);if(s-t<e)return s}},snapCandidate=(t,e)=>0===e?t:Math.round(t/e)*e,floatToFixed=(t,e=6)=>Number(t.toFixed(e)),getOffset=t=>t.getBoundingClientRect(),getTransform=t=>{return t.css("-webkit-transform")||t.css("-moz-transform")||t.css("-ms-transform")||t.css("-o-transform")||t.css("transform")||"none"},parseMatrix=t=>{const e=t.match(/[+\-]?(?:0|[1-9]\d*)(?:\.\d*)?(?:[eE][+\-]?\d+)?/g);return e?e.map(t=>parseFloat(t)):[1,0,0,1,0,0]},addClass=(t,e)=>{if(e){if(t.classList){if(!(e.indexOf(" ")>-1))return t.classList.add(e);e.split(/\s+/).forEach(e=>t.classList.add(e))}return t}},removeClass=(t,e)=>{if(e){if(t.classList){if(!(e.indexOf(" ")>-1))return t.classList.remove(e);e.split(/\s+/).forEach(e=>t.classList.remove(e))}return t}},matrixToCSS=t=>{const e=`matrix(${t.join()})`;return{transform:e,webkitTranform:e,mozTransform:e,msTransform:e,otransform:e}};class Transformable extends SubjectModel{constructor(t,e,s){if(super(t),this.constructor===Transformable)throw new TypeError("Cannot construct Transformable instances directly");this.observable=s,EVENTS.forEach(t=>{this.eventDispatcher.registerEvent(t)}),this.enable(e)}_cursorPoint(){throw Error("'_cursorPoint()' method not implemented")}_rotate({radians:t,...e}){const s={transform:this._processRotate(t),delta:t,...e};this.proxyMethods.onRotate.call(this,s),this._emitEvent("rotate",s)}_resize({dx:t,dy:e,...s}){const o={...this._processResize(t,e),dx:t,dy:e,...s};this.proxyMethods.onResize.call(this,o),this._emitEvent("resize",o)}_processOptions(t){const{el:e}=this;addClass(e,"sjx-drag");const s={x:10,y:10,angle:10*RAD},o={move:!1,resize:!1,rotate:!1};let r=null,n=!1,i="xy",a="auto",l="auto",h="auto",c=!1,d=!0,u=!0,f=!0,p=null,m=50,x=!0,v=null,g=null,b=null,y=()=>{},_=()=>{},E=()=>{},M=()=>{},w=()=>{},D=()=>{},T=e.parentNode;if(isDef(t)){const{snap:j,each:S,axis:z,cursorMove:R,cursorResize:C,cursorRotate:N,rotationPoint:X,restrict:Y,draggable:O,resizable:F,rotatable:A,onInit:I,onDrop:H,onMove:L,onResize:k,onRotate:P,onDestroy:$,container:U,proportions:W,custom:q,rotatorAnchor:G,rotatorOffset:V,showNormal:B,resizeHandles:Z,className:J}=t;if(isDef(j)){const{x:t,y:e,angle:o}=j;s.x=isUndef(t)?10:t,s.y=isUndef(e)?10:e,s.angle=isUndef(o)?s.angle:o*RAD}if(isDef(S)){const{move:t,resize:e,rotate:s}=S;o.move=t||!1,o.resize=e||!1,o.rotate=s||!1}isDef(Y)&&(r="parent"===Y?e.parentNode:helper(Y)[0]||document),a=R||"auto",l=C||"auto",h=N||"auto",i=z||"xy",T=isDef(U)&&helper(U)[0]?helper(U)[0]:T,c=X||!1,n=W||!1,d=!isDef(O)||O,u=!isDef(F)||F,f=!isDef(A)||A,v="object"==typeof q&&q||null,p=G||null,m=V||50,x=!isDef(B)||B,g=isDef(Z)?Z:null,b=isDef(J)?J:null,y=createMethod(I),w=createMethod(H),_=createMethod(L),M=createMethod(k),E=createMethod(P),D=createMethod($)}this.options={axis:i,cursorMove:a,cursorRotate:h,cursorResize:l,rotationPoint:c,restrict:r,container:T,snap:s,each:o,proportions:n,draggable:d,resizable:u,rotatable:f,custom:v,rotatorAnchor:p,rotatorOffset:m,showNormal:x,resizeHandles:g,className:b},this.proxyMethods={onInit:y,onDrop:w,onMove:_,onResize:M,onRotate:E,onDestroy:D},this.subscribe(o)}_animate(){const t=this,{observable:e,storage:s,options:o}=t;if(isUndef(s))return;if(s.frame=requestAnimFrame(t._animate),!s.doDraw)return;s.doDraw=!1;let{dox:r,doy:n,clientX:i,clientY:a,doDrag:l,doResize:h,doRotate:c,doSetCenter:d,revX:u,revY:f}=s;const{snap:p,each:{move:m,resize:x,rotate:v},restrict:g,draggable:b,resizable:y,rotatable:_}=o;if(h&&y){const{transform:o,cx:l,cy:h}=s,{x:c,y:d}=this._pointToElement({x:i,y:a});let m=r?snapToGrid(c-l,p.x/o.scX):0,v=n?snapToGrid(d-h,p.y/o.scY):0;const g={dx:m=r?u?-m:m:0,dy:v=n?f?-v:v:0,clientX:i,clientY:a};t._resize(g),x&&e.notify("onresize",t,g)}if(l&&b){const{restrictOffset:o,elementOffset:l,nx:h,ny:c}=s;if(isDef(g)){const{left:t,top:e}=o,{left:s,top:r,width:n,height:d}=l,u=h-i,f=c-a,p=g.clientWidth-n,m=g.clientHeight-d,x=r-e,v=s-t;x-f<0&&(a=c-r+e),v-u<0&&(i=h-s+t),x-f>m&&(a=m+(c-r+e)),v-u>p&&(i=p+(h-s+t))}const d={dx:r?snapToGrid(i-h,p.x):0,dy:n?snapToGrid(a-c,p.y):0,clientX:i,clientY:a};t._drag(d),m&&e.notify("onmove",t,d)}if(c&&_){const{pressang:o,center:r}=s,n=Math.atan2(a-r.y,i-r.x)-o,l={clientX:i,clientY:a};t._rotate({radians:snapToGrid(n,p.angle),...l}),v&&e.notify("onrotate",t,{radians:n,...l})}if(d&&_){const{bx:e,by:o}=s,{x:r,y:n}=this._pointToControls({x:i,y:a});t._moveCenterHandle(r-e,n-o)}}_start(t){const{observable:e,storage:s,options:{axis:o,restrict:r,each:n},el:i}=this,a=this._compute(t);Object.keys(a).forEach(t=>{s[t]=a[t]});const{onRightEdge:l,onBottomEdge:h,onTopEdge:c,onLeftEdge:d,handle:u,factor:f,revX:p,revY:m,doW:x,doH:v}=a,g=l||h||c||d,{handles:b}=s,{rotator:y,center:_,radius:E}=b;isDef(E)&&removeClass(E,"sjx-hidden");const M=u.is(y),w=!!isDef(_)&&u.is(_),D=!(M||g||w),{clientX:T,clientY:j}=t,{x:S,y:z}=this._cursorPoint({clientX:T,clientY:j}),{x:R,y:C}=this._pointToElement({x:S,y:z}),{x:N,y:X}=this._pointToControls({x:S,y:z}),Y={clientX:T,clientY:j,nx:S,ny:z,cx:R,cy:C,bx:N,by:X,doResize:g,doDrag:D,doRotate:M,doSetCenter:w,onExecution:!0,cursor:null,elementOffset:getOffset(i),restrictOffset:isDef(r)?getOffset(r):null,dox:/\x/.test(o)&&(!g||(u.is(b.ml)||u.is(b.mr)||u.is(b.tl)||u.is(b.tr)||u.is(b.bl)||u.is(b.br))),doy:/\y/.test(o)&&(!g||(u.is(b.br)||u.is(b.bl)||u.is(b.bc)||u.is(b.tr)||u.is(b.tl)||u.is(b.tc)))};this.storage={...s,...Y};const O={clientX:T,clientY:j};g?this._emitEvent("resizeStart",O):M?this._emitEvent("rotateStart",O):D&&this._emitEvent("dragStart",O);const{move:F,resize:A,rotate:I}=n,H=g?"resize":M?"rotate":"drag",L=g&&A||M&&I||D&&F;e.notify("ongetstate",this,{clientX:T,clientY:j,actionName:H,triggerEvent:L,factor:f,revX:p,revY:m,doW:x,doH:v}),this._draw()}_moving(t){const{storage:e,options:s}=this,{x:o,y:r}=this._cursorPoint(t);e.e=t,e.clientX=o,e.clientY=r,e.doDraw=!0;let{doRotate:n,doDrag:i,doResize:a,cursor:l}=e;const{cursorMove:h,cursorResize:c,cursorRotate:d}=s;isUndef(l)&&(i?l=h:n?l=d:a&&(l=c),helper(document.body).css({cursor:l}))}_end({clientX:t,clientY:e}){const{options:{each:s},observable:o,storage:r,proxyMethods:n}=this,{doResize:i,doDrag:a,doRotate:l,frame:h,handles:{radius:c}}=r,d=i?"resize":a?"drag":"rotate";r.doResize=!1,r.doDrag=!1,r.doRotate=!1,r.doSetCenter=!1,r.doDraw=!1,r.onExecution=!1,r.cursor=null,this._apply(d);const u={clientX:t,clientY:e};n.onDrop.call(this,u),i?this._emitEvent("resizeEnd",u):l?this._emitEvent("rotateEnd",u):a&&this._emitEvent("dragEnd",u);const{move:f,resize:p,rotate:m}=s,x=i&&p||l&&m||a&&f;o.notify("onapply",this,{clientX:t,clientY:e,actionName:d,triggerEvent:x}),cancelAnimFrame(h),helper(document.body).css({cursor:"auto"}),isDef(c)&&addClass(c,"sjx-hidden")}_compute(t){const{handles:e}=this.storage,s=helper(t.target),{revX:o,revY:r,doW:n,doH:i,...a}=this._checkHandles(s,e),l=this._getState({revX:o,revY:r,doW:n,doH:i}),{x:h,y:c}=this._cursorPoint(t),d=Math.atan2(c-l.center.y,h-l.center.x);return{...l,...a,handle:s,pressang:d}}_checkHandles(t,e){const{tl:s,tc:o,tr:r,bl:n,br:i,bc:a,ml:l,mr:h}=e,c=!!isDef(s)&&t.is(s),d=!!isDef(o)&&t.is(o),u=!!isDef(r)&&t.is(r),f=!!isDef(n)&&t.is(n),p=!!isDef(a)&&t.is(a),m=!!isDef(i)&&t.is(i),x=!!isDef(l)&&t.is(l),v=!!isDef(h)&&t.is(h);return{revX:c||x||f||d,revY:c||u||d||x,onTopEdge:d||u||c,onLeftEdge:c||x||f,onRightEdge:u||v||m,onBottomEdge:m||p||f,doW:x||v,doH:d||p}}notifyMove(){this._drag(...arguments)}notifyRotate({radians:t,...e}){const{snap:{angle:s}}=this.options;this._rotate({radians:snapToGrid(t,s),...e})}notifyResize(){this._resize(...arguments)}notifyApply({clientX:t,clientY:e,actionName:s,triggerEvent:o}){this.proxyMethods.onDrop.call(this,{clientX:t,clientY:e}),o&&(this._apply(s),this._emitEvent(`${s}End`,{clientX:t,clientY:e}))}notifyGetState({clientX:t,clientY:e,actionName:s,triggerEvent:o,...r}){if(o){const o=this._getState(r);this.storage={...this.storage,...o},this._emitEvent(`${s}Start`,{clientX:t,clientY:e})}}subscribe({resize:t,move:e,rotate:s}){const{observable:o}=this;(e||t||s)&&o.subscribe("ongetstate",this).subscribe("onapply",this),e&&o.subscribe("onmove",this),t&&o.subscribe("onresize",this),s&&o.subscribe("onrotate",this)}unsubscribe(){const{observable:t}=this;t.unsubscribe("ongetstate",this).unsubscribe("onapply",this).unsubscribe("onmove",this).unsubscribe("onresize",this).unsubscribe("onrotate",this)}disable(){const{storage:t,proxyMethods:e,el:s}=this;isUndef(t)||(t.onExecution&&(this._end(),helper(document).off("mousemove",this._onMouseMove).off("mouseup",this._onMouseUp).off("touchmove",this._onTouchMove).off("touchend",this._onTouchEnd)),removeClass(s,"sjx-drag"),this._destroy(),this.unsubscribe(),e.onDestroy.call(this,s),delete this.storage)}exeDrag({dx:t,dy:e}){const{draggable:s}=this.options;s&&(this.storage={...this.storage,...this._getState({revX:!1,revY:!1,doW:!1,doH:!1})},this._drag({dx:t,dy:e}),this._apply("drag"))}exeResize({dx:t,dy:e,revX:s,revY:o,doW:r,doH:n}){const{resizable:i}=this.options;i&&(this.storage={...this.storage,...this._getState({revX:s||!1,revY:o||!1,doW:r||!1,doH:n||!1})},this._resize({dx:t,dy:e}),this._apply("resize"))}exeRotate({delta:t}){const{rotatable:e}=this.options;e&&(this.storage={...this.storage,...this._getState({revX:!1,revY:!1,doW:!1,doH:!1})},this._rotate({radians:t}),this._apply("rotate"))}}const matrixTransform=({x:t,y:e},s)=>{const[o,r,n,i,a,l]=s;return{x:o*t+n*e+a,y:r*t+i*e+l}},matrixInvert=t=>{const e=[[t[0],t[2],t[4]],[t[1],t[3],t[5]],[0,0,1]];if(e.length!==e[0].length)return;const s=e.length,o=[],r=[];for(let t=0;t<s;t+=1){o[o.length]=[],r[r.length]=[];for(let n=0;n<s;n+=1)o[t][n]=t==n?1:0,r[t][n]=e[t][n]}for(let t=0;t<s;t+=1){let e=r[t][t];if(0===e){for(let n=t+1;n<s;n+=1)if(0!==r[n][t]){for(let i=0;i<s;i++)e=r[t][i],r[t][i]=r[n][i],r[n][i]=e,e=o[t][i],o[t][i]=o[n][i],o[n][i]=e;break}if(0===(e=r[t][t]))return}for(let n=0;n<s;n++)r[t][n]=r[t][n]/e,o[t][n]=o[t][n]/e;for(let n=0;n<s;n++)if(n!=t){e=r[n][t];for(let i=0;i<s;i++)r[n][i]-=e*r[t][i],o[n][i]-=e*o[t][i]}}return[o[0][0],o[1][0],o[0][1],o[1][1],o[0][2],o[1][2]]},multiplyMatrix=([t,e,s,o,r,n],[i,a,l,h,c,d])=>{const u=[[t,s,r],[e,o,n],[0,0,1]],f=[[i,l,c],[a,h,d],[0,0,1]],p=[];for(let t=0;t<f.length;t++){p[t]=[];for(let e=0;e<u[0].length;e++){let s=0;for(let o=0;o<u.length;o++)s+=u[o][e]*f[t][o];p[t].push(s)}}return[p[0][0],p[1][0],p[0][1],p[1][1],p[0][2],p[1][2]]},rotatedTopLeft=(t,e,s,o,r,n,i,a,l)=>{const h=parseFloat(s)/2,c=parseFloat(o)/2,d=t+h,u=e+c,f=t-d,p=e-u,m=Math.atan2(a?0:p,l?0:f)+r,x=Math.sqrt(Math.pow(l?0:h,2)+Math.pow(a?0:c,2));let v=Math.cos(m),g=Math.sin(m);const b=u+x*(g=!0===i?-g:g);return{left:floatToFixed(d+x*(v=!0===n?-v:v)),top:floatToFixed(b)}},MIN_SIZE=2,CENTER_DELTA=7;class Draggable extends Transformable{_init(t){const{rotationPoint:e,container:s,resizable:o,rotatable:r,showNormal:n,resizeHandles:i,className:a}=this.options,{left:l,top:h,width:c,height:d}=t.style,u=document.createElement("div");addClass(u,"sjx-wrapper"),isDef(a)&&addClass(u,a),s.appendChild(u);const f=helper(t),p=c||f.css("width"),m=d||f.css("height"),x={top:h||f.css("top"),left:l||f.css("left"),width:p,height:m,transform:getTransform(f)},v=document.createElement("div");addClass(v,"sjx-controls");const g={...r&&{normal:n?["sjx-normal"]:null,rotator:["sjx-hdl","sjx-hdl-m","sjx-rotator"]},...o&&{tl:["sjx-hdl","sjx-hdl-t","sjx-hdl-l","sjx-hdl-tl"],tr:["sjx-hdl","sjx-hdl-t","sjx-hdl-r","sjx-hdl-tr"],br:["sjx-hdl","sjx-hdl-b","sjx-hdl-r","sjx-hdl-br"],bl:["sjx-hdl","sjx-hdl-b","sjx-hdl-l","sjx-hdl-bl"],tc:["sjx-hdl","sjx-hdl-t","sjx-hdl-c","sjx-hdl-tc"],bc:["sjx-hdl","sjx-hdl-b","sjx-hdl-c","sjx-hdl-bc"],ml:["sjx-hdl","sjx-hdl-m","sjx-hdl-l","sjx-hdl-ml"],mr:["sjx-hdl","sjx-hdl-m","sjx-hdl-r","sjx-hdl-mr"]},center:e&&r?["sjx-hdl","sjx-hdl-m","sjx-hdl-c","sjx-hdl-mc"]:void 0};if(Object.keys(g).forEach(t=>{const e=i[t];if(isDef(e)&&0==e)return;const s=g[t];if(isUndef(s))return;const o=createHandler(s);g[t]=o,v.appendChild(o)}),isDef(g.center)){helper(g.center).css({left:`${t.getAttribute("data-cx")}px`,top:`${t.getAttribute("data-cy")}px`})}u.appendChild(v);const b=helper(v);b.css(x),this.storage={controls:v,handles:g,radius:void 0,parent:t.parentNode},b.on("mousedown",this._onMouseDown).on("touchstart",this._onTouchStart)}_destroy(){const{controls:t}=this.storage;helper(t).off("mousedown",this._onMouseDown).off("touchstart",this._onTouchStart);const e=t.parentNode;e.parentNode.removeChild(e)}_pointToElement({x:t,y:e}){const{transform:s}=this.storage,o=[...s.matrix];return o[4]=o[5]=0,this._applyMatrixToPoint(matrixInvert(o),t,e)}_pointToControls(t){return this._pointToElement(t)}_applyMatrixToPoint(t,e,s){return matrixTransform({x:e,y:s},t)}_cursorPoint({clientX:t,clientY:e}){const{container:s}=this.options,o=parseMatrix(getTransform(helper(s)));return matrixTransform({x:t,y:e},matrixInvert(o))}_apply(){const{el:t,storage:e}=this,{controls:s,handles:o}=e,r=helper(s),n=parseFloat(r.css("width"))/2,i=parseFloat(r.css("height"))/2,{center:a}=o,l=isDef(a),h=l?parseFloat(helper(a).css("left")):n,c=l?parseFloat(helper(a).css("top")):i;t.setAttribute("data-cx",h),t.setAttribute("data-cy",c),this.storage.cached=null}_processResize(t,e){const{el:s,storage:o,options:{proportions:r}}=this,{controls:n,coords:i,cw:a,ch:l,transform:h,refang:c,revX:d,revY:u,doW:f,doH:p,restrictOffset:m,handle:x}=o,v=f||!f&&!p?(a+t)/a:(l+e)/l;let g=r?a*v:a+t,b=r?l*v:l+e;if(g<=MIN_SIZE||b<=MIN_SIZE)return;const y=[...h.matrix];isDef(m)&&(t>0&&(x[0].className.indexOf("sjx-hdl-l")>-1?y[4]-t<0&&(g=a+y[4]):g+y[4]>m.width&&(g=m.width-y[4])),e>0&&(x[0].className.indexOf("sjx-hdl-l")>-1?y[5]-t<0&&(g=l+y[5]):b+y[5]>m.height&&(b=m.height-y[5])));const _=rotatedTopLeft(y[4],y[5],g,b,c,d,u,f,p),E=i.left-_.left,M=i.top-_.top;y[4]+=E,y[5]+=M;const w=matrixToCSS(y);return w.width=`${g}px`,w.height=`${b}px`,helper(n).css(w),helper(s).css(w),o.cached={dx:E,dy:M},{width:g,height:b,ox:E,oy:M}}_processMove(t,e){const{el:s,storage:o}=this,{controls:r,transform:{matrix:n,parentMatrix:i}}=o,a=[...i];a[4]=a[5]=0;const l=[...n];l[4]=n[4]+t,l[5]=n[5]+e;const h=matrixToCSS(l);return helper(r).css(h),helper(s).css(h),o.cached={dx:t,dy:e},l}_processRotate(t){const{el:e,storage:{controls:s,transform:o,center:r}}=this,{matrix:n,parentMatrix:i}=o,a=floatToFixed(Math.cos(t),4),l=floatToFixed(Math.sin(t),4),h=[1,0,0,1,r.cx,r.cy],c=[a,l,-l,a,0,0],d=[...i];d[4]=d[5]=0;const u=multiplyMatrix(matrixInvert(d),multiplyMatrix(c,d)),f=multiplyMatrix(multiplyMatrix(h,u),matrixInvert(h)),p=multiplyMatrix(f,n),m=matrixToCSS(p);return helper(s).css(m),helper(e).css(m),p}_getState(t){const{revX:e,revY:s,doW:o,doH:r}=t,n=e!==s?-1:1,{el:i,storage:{handles:a,controls:l,parent:h},options:{container:c}}=this,{center:d}=a,u=helper(l),f=parseMatrix(getTransform(helper(c))),p=parseMatrix(getTransform(helper(l))),m=parseMatrix(getTransform(helper(h))),x=Math.atan2(p[1],p[0])*n,v=h!==c?multiplyMatrix(m,f):f,g={matrix:p,parentMatrix:v,scX:Math.sqrt(p[0]*p[0]+p[1]*p[1]),scY:Math.sqrt(p[2]*p[2]+p[3]*p[3])},b=parseFloat(u.css("width")),y=parseFloat(u.css("height")),_=rotatedTopLeft(p[4],p[5],b,y,x,e,s,o,r),E=b/2,M=y/2,w=getOffset(i),D=isDef(d),T=D?parseFloat(helper(d).css("left")):E,j=D?parseFloat(helper(d).css("top")):M,S=D?CENTER_DELTA:0,{x:z,y:R}=matrixTransform({x:w.left,y:w.top},matrixInvert(v));return{transform:g,cw:b,ch:y,coords:_,center:{x:z+T-S,y:R+j-S,cx:-T+E-S,cy:-j+M-S,hx:T,hy:j},factor:n,refang:x,revX:e,revY:s,doW:o,doH:r}}_moveCenterHandle(t,e){const{handles:{center:s},center:{hx:o,hy:r}}=this.storage,n=`${o+t}px`,i=`${r+e}px`;helper(s).css({left:n,top:i})}resetCenterPoint(){const{handles:{center:t}}=this.storage;helper(t).css({left:null,top:null})}fitControlsToSize(){}get controls(){return this.storage.controls}}const createHandler=t=>{const e=document.createElement("div");return t.forEach(t=>{addClass(e,t)}),e};function drag(t,e){if(this.length){const s=isDef(e)&&e instanceof Observable?e:new Observable;return arrReduce.call(this,(e,o)=>(e.push(new Draggable(o,t,s)),e),[])}}class Subjx extends Helper{drag(){return drag.call(this,...arguments)}}function subjx(t){return new Subjx(t)}Object.defineProperty(subjx,"createObservable",{value:()=>new Observable}),Object.defineProperty(subjx,"Subjx",{value:Subjx}),Object.defineProperty(subjx,"Observable",{value:Observable}),module.exports=subjx;
